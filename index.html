<!DOCTYPE html>

<html data-theme="dark" lang="en">
<head>
<link href="favicon.png" rel="icon" type="image/png"/>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>ARK Trades ‚Äì Dashboard </title>
<style>

/* === v8.2 ‚Äî Sidebar nav come type-chip === */
.sidebar-nav{
  display:flex;
  flex-direction:column;
  gap:8px;
}

/* chip base */
.sidebar .nav-item{
  width:100%;
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 12px;
  border-radius:999px;
  border:1px solid transparent;
  background:radial-gradient(circle at 0% 0%,
    rgba(76,29,149,0.45),
    rgba(10,6,20,0.98));
  color:var(--muted);
  font-size:13px;
  cursor:pointer;
  text-align:left;
  box-shadow:0 0 0 1px rgba(15,23,42,0.9);
  transition:
    background .15s ease,
    border-color .15s ease,
    box-shadow .15s ease,
    transform .05s ease,
    color .15s ease;
}



/* vecchio pallino nascosto */
.sidebar .nav-item .nav-dot{
  display:none;
}

/* icona tipo .chip-icon */
.sidebar .nav-item .nav-icon{
  width:32px;
  height:32px;
  border-radius:14px;
  background:linear-gradient(
    135deg,
    rgba(88,28,135,0.95),
    rgba(129,140,248,0.9)
  );
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 0 6px rgba(129,140,248,0.45);
  flex-shrink:0;
}
.sidebar .nav-item .nav-icon img{
  width:18px;
  height:18px;
  display:block;
}

/* testo */
.sidebar .nav-item .nav-label{
  font-size:12px;
  font-weight:600;
}

/* hover */
.sidebar .nav-item:hover{
  border-color:rgba(198,138,255,0.7);
  box-shadow:0 0 14px rgba(198,138,255,0.45);
  color:var(--ink);
}

/* stato attivo: viola + icona arancione come le type-chip */
.sidebar .nav-item.active{
  background: linear-gradient(90deg, rgba(116, 0, 189, 0.69), #6f00c1, #2c0060);
  color:#ffffff;
  border-color:var(--accent);
  box-shadow:0 0 14px rgba(198,138,255,0.45);
  transform:translateY(-1px);
}
.sidebar .nav-item.active .nav-icon{
  background:linear-gradient(135deg,#ff8c00,#ff6700);
  box-shadow:0 0 18px rgba(255, 255, 255, 0.9);
}


/* === v9.2 ‚Äî TOTAL BUY SELLS qui modifichi colori e altro === */
.stat-new{
  background: radial-gradient(circle at 10% 10%, rgba(137, 0, 255, 0.1), rgb(5, 0, 10)),
              linear-gradient(160deg, rgba(45,15,70,0.9), rgba(10,5,20,0.95));
  border: 1px solid rgb(131, 0, 255, 0.55);
  box-shadow: 0 0 10px rgb(86, 5, 137), inset 0 0 18px rgba(120,60,200,0.15);
  border-radius: 18px;

  padding: 18px 24px;
  min-height:120px;

  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:16px;

  position:relative;      /* üëà serve per l‚Äôicona sullo sfondo */
  overflow:hidden;        /* taglia eventuali bordi dell‚Äôicona */
  cursor:default;

  backdrop-filter: blur(12px);
  transition:transform .15s ease, box-shadow .2s ease;
}



/* üëà questa √® l'icona nelle 3 chips */

.stat-new .icon{
  position:absolute;
  left:76px;
  top:50%;
  transform:translateY(-50%);
  width:96px;
  height:96px;
  border-radius:24px;
  background:rgba(0,0,0,0.0);   /* niente sfondo pieno, solo l‚ÄôSVG */
  box-shadow:0 0 22px rgba(0,0,0,0.4);
  display:flex;
  align-items:center;
  justify-content:right;
  opacity:0.14;                 /* üëà qui regoli quanto ‚Äúfantasma‚Äù vuoi l‚Äôicona */
  pointer-events:none;          /* non blocca i click sul contenuto */
}

.stat-ic img{
  width:215px;
  height:250px;
  opacity:1;
}

.stat-new .label{
  font-size:16px;
  opacity:100;
  font-weight:500;
}

.stat-new .sub{
  font-size:14px;
  opacity:.75;
}



/* Colonna destra: numero grosso, allineato a destra */
.stat-right{
  text-align:right;
  flex-shrink:0;
}

.stat-new .value{
  font-size:57px; /* DIMENSIONE FONT NUMERI */
  font-weight:800;
  letter-spacing:0px;
  line-height:1;
}


@media (prefers-color-scheme: dark) {
  input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); }
}

/* ===== Modern theme tokens ===== */
:root {
  --bg: #1100ab; /* SFONDO DARK PROFONDO */
  --bg-grad: radial-gradient(150vmax 80vmax at 0% 0%, rgb(77, 0, 212), transparent 100%),
             radial-gradient(120vmax 70vmax at 100% 90%, rgba(13, 0, 61, 0.6), transparent 100%),
             #000000;                                   /* GRADIENTE VIOLA ARK SCURO */
  --panel: rgba(14,11,22,0.94);                              /* PANNELLO VIOLA SCURO */
  --ink: #e8eaee;
  --muted: #b5bfd3;                                      /* TESTO SECONDARIO PI√ô CHIARO */
  --line: rgba(148,163,184,0.22);                          /* LINEA/CONFINI VIOLA SCURO */
  --accent: #7c3aed;                                          /* VIOLA ARK */
  --accent-ink: #0d0716;                                     /* TESTO SU VIOLA ARK */
  --green:#22c55e;
  --red:#f43f5e;
  --chip: #0f0a17;                                               /* CHIP VIOLA */
  --chip-on:#e8eaee;
  --chip-on-ink:#0b0d10;
  --pill-bg: #110b1b;                                            /* PILL BACKGROUND VIOLA */
  --shadow: 0 12px 32px rgba(0,0,0,.35);
  --radius: 16px;

  --accent-orange: #ff8a00;
}
[data-theme="light"] {
  --bg: #090812;                                          /* SFONDO DARK NEUTRO  */
  --bg-grad: radial-gradient(150vmax 80vmax at -10% -20%, rgba(85, 0, 231, 0.14), transparent 60%),
             radial-gradient(120vmax 70vmax at 110% -25%, rgba(88,28,135,0.10), transparent 65%),
             #090812;                                      /* GRADIENTE VIOLA ARK SCURO */
  --panel: rgba(14,11,22,0.94);                                 /* PANNELLO VIOLA SCURO */
  --ink:#0c1220;
  --muted: #b5bfd3;                                         /* TESTO SECONDARIO PI√ô CHIARO */
  --line: rgba(124,58,237,0.22);                              /* LINEA/CONFINI VIOLA */
  --accent:#111;
  --accent-ink:#fff;
  --chip: #0f0a17;                                                 /* CHIP VIOLA */
  --chip-on:#111;
  --chip-on-ink:#fff;
  --pill-bg: #110b1b;                                      /* PILL BACKGROUND VIOLA */
  --shadow: 0 10px 24px rgba(0,0,0,.08);
}

/* ===== Base ===== */
html,body{
  margin:0;
  padding:0;
  background:#000;
  background-image:url('background/bg.jpg');
  background-size:cover;
  background-position:center;
  background-attachment:fixed;
  color:var(--ink);
  font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
}
.container{
  max-width:none;
  width:95%;
  margin:0;
  padding:24px 32px;
}

h1{font-size:22px;margin:0 0 4px; letter-spacing:.2px}
p.note{color:var(--muted);font-size:13px;margin:6px 0 18px}

/* === v7: App shell with sidebar navigation === */
.app-shell{
  display:flex;
  min-height:100vh;

  /* FIX: spingi tutto il contenuto a destra della sidebar */
  padding-left:250px; /* 230px di sidebar + 10px di respiro */
}
.sidebar{
  width:230px;
  padding:20px 16px;
  display:flex;
  flex-direction:column;
  gap:8px;

  background:rgba(6,4,18,0.65);
  border-right:1px solid rgba(198,138,255,0.35);
  box-shadow:0 0 24px rgba(0,0,0,0.65);
  backdrop-filter:blur(18px);

  position:fixed;
  top:0;
  left:0;
  bottom:0;

  height:100vh;
  overflow-y:auto;
  z-index:50;
}

.main-area{
  flex:1;
  overflow-x:hidden;
}
.sidebar-header{
  position:relative;
  min-height:auto;
  padding:8px 0 16px 0;
  display:flex;
  align-items:flex-start;
}
.sidebar-header > div:last-child{
  position:relative;
  z-index:1;
  margin-left:0; /* titolo allineato a sinistra */
}
  
  /* QUA TROVI LE COSE RELATIVE ALLA SIDEBAR ‚öôÔ∏è */
  
.sidebar-title{
  font-size:19px;
  font-weight:700;
}
.sidebar-subtitle{
  font-size:14px;
  color:var(--muted);
  opacity:.9;
}
.sidebar-nav{
  display:flex;
  flex-direction:column;
  gap:6px;
}
.nav-item{
  display:flex;
  align-items:center;
  gap:10px;
  width:100%;
  padding:8px 10px;
  border-radius:999px;
  border:1px solid transparent;
  background:transparent;
  color:var(--muted);
  font-size:13px;
  cursor:pointer;
  text-align:left;
  transition:background .18s ease, color .18s ease, box-shadow .18s ease, border-color .18s ease, transform .05s ease;
}
.nav-item .nav-dot{
  width:8px;
  height:8px;
  border-radius:999px;
  background:rgba(148,163,184,0.7);
}
.nav-item span{
  pointer-events:none;
}
.nav-item:hover{
  background:rgba(148,163,184,0.1);
  color:var(--ink);
}
.nav-item.active{
  background:var(--accent);
  color:var(--accent-ink);
  border-color:rgba(250,250,255,0.45);
  box-shadow:0 0 0 1px rgba(198,138,255,0.45),0 0 18px rgba(198,138,255,0.75);
  transform:translateY(-0.5px);
}
.nav-item.active .nav-dot{
  background:#22c55e;
  box-shadow:0 0 10px rgba(34,197,94,0.75);
}

/* Sidebar footer (small status) */
.sidebar-footer{
  margin-top:auto;
  font-size:11px;
  color:var(--muted);
  opacity:.8;
}

/* Mobile: collapse sidebar on top */
@media (max-width: 960px){
  .app-shell{
    flex-direction:column;
  }
  .sidebar{
    width:100%;
    flex-direction:row;
    align-items:center;
    justify-content:space-between;
    position:static;
    border-right:none;
    border-bottom:1px solid rgba(198,138,255,0.35);
    margin-bottom:8px;
    padding:10px 16px;
  }
  .sidebar-header{
    flex-direction:row;
    align-items:center;
    gap:10px;
  }
  .sidebar-logo-dot{
    margin-bottom:0;
  }
  .sidebar-nav{
    flex-direction:row;
    justify-content:flex-end;
  }
  .nav-item{
    width:auto;
    padding:6px 10px;
  }
  .container{
    padding-top:16px;
  }
}


/* ===== Cards ===== */
.card{
  background:var(--panel);
  border:1px solid var(--line);
  border-radius:var(--radius);
  box-shadow: var(--shadow);
  backdrop-filter: blur(10px);
}
.card.pad{padding:16px}

/* ===== Grid ===== */
.grid{display:grid;gap:8px}
.grid.fit-240{grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
.grid.two-col{grid-template-columns:2fr 1fr}
@media (max-width:1100px){ .grid.two-col{grid-template-columns:1fr} }

/* ===== Labels / Inputs ===== */
label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}

input[type="date"],
input[type="text"] {
  width: 80%;
  padding: 12px 12px;
  border: 1px solid var(--line);
  border-radius: 12px;
  font-size: 14px;
  outline: none;
  background: rgba(124,58,237,0.08); /* subtle violet tint */
  color: var(--ink);
  transition: box-shadow .2s, border-color .2s;
}
input[type="date"]:focus, input[type="text"]:focus { border-color: rgba(139,92,246,0.6); box-shadow: 0 0 0 4px rgba(139,92,246,0.15); } /* FOCUS VIOLA ARK üü™ */
input::placeholder{color:var(--muted)}

/* üëá limiti confermati */
input[type="date"] { max-width: 235px; }
input[type="text"] { max-width: 235px; }

input[type="checkbox"]{transform:scale(1.05);margin-right:6px}

/* ===== Buttons ===== */
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.btn{
  background:transparent;
  border:1px solid var(--line);
  border-radius:999px;
  padding:10px 14px;
  font-size:14px;
  cursor:pointer;
  color:var(--ink);
  transition: border-color .2s, box-shadow .2s, transform .05s;
}
.btn:hover{box-shadow:0 6px 18px rgba(0,0,0,.25);border-color:#2a313a}
.btn:active{transform: translateY(1px)}
.btn.primary{
  background:var(--accent);
  border-color:var(--accent);
  color:var(--accent-ink);
   /* OMBRA BOTTONE VIOLA ARK LUMINOSO üü™ */
}


.btn-glow-ring{
  position: relative;
  overflow: hidden;
}
.btn-glow-ring::before{
  content:"";
  position:absolute;
  inset:-2px;
  border-radius:inherit;
  background: conic-gradient(
    from 0deg,
    rgba(236,72,153,0),
    rgba(236,72,153,0.9),
    rgba(56,189,248,0.9),
    rgba(129,140,248,0.9),
    rgba(236,72,153,0)
  );
  filter: blur(6px);
  opacity:0;
  transform: rotate(0deg);
  transition: opacity .35s ease-out;
  animation: btnNeonSpin 4s linear infinite;
  animation-play-state: paused;
  pointer-events:none;
  z-index:-1;
}
.btn-glow-ring:hover::before,
.btn-glow-ring:focus-visible::before{
  opacity:1;
  animation-play-state: running;
}
@keyframes btnNeonSpin{
  to{ transform: rotate(360deg); }
}



@property --angle{
  syntax: '<angle>';
  inherits: false;
  initial-value: 0deg;
}

@keyframes pillGlowSpin{
  to{ --angle: 360deg; }
}

.pill-glow-ring{
  position: relative;
  border-radius: 999px;
  overflow: visible;
  z-index: 0;
}

/* Neon ring: coincide col bordo pill + glow verso l'esterno */
.pill-glow-ring::before{
  content: "";
  position: absolute;
  inset: 0;                     /* stesso raggio del bordo reale */
  border-radius: inherit;
  padding: 2px;                 /* spessore dell'anello neon */
  --angle: 0deg;
  background: conic-gradient(
    from var(--angle),
    rgb(225, 0, 255),
    rgba(46, 0, 0, 0),      /* punta scura */
    rgba(46, 0, 0, 0),      /* punta scura */
    rgba(249,115,22,1.0),       /* arancione acceso */
    rgba(46, 0, 0, 0),      /* punta scura */
    rgba(46, 0, 0, 0),      /* punta scura */
    rgba(168,85,247,1.0),       /* viola medio saturo */
    rgb(255, 2, 255)
  );
  /* maschera: mantiene solo l'anello, centro trasparente */
  -webkit-mask:
    linear-gradient(#000 0 0) content-box,
    linear-gradient(#000 0 0);
  -webkit-mask-composite: xor;
          mask-composite: exclude;

  box-shadow:
    0 0 7px rgba(216,180,254,1.0),
    0 0 56px rgba(249,115,22,0.95);
  opacity: 0;                          /* pill spenta: neon invisibile */
  animation: pillGlowSpin 4s linear infinite;
  animation-play-state: paused;        /* ruota solo all'hover */
  pointer-events: none;
  z-index: 2;                           /* sopra il contenuto della pill */
}

.pill-glow-ring:hover::before,
.pill-glow-ring:focus-within::before{
  opacity: 1;                          /* pill attiva: neon pieno */
  animation-play-state: running;
}

/* === end neon glow ring === */

/* ===== Chips ===== */
.chips{display:flex;flex-wrap:nowrap;gap:8px;overflow-x:auto}
.chip{
  border:1px solid var(--line);
  border-radius:999px;
  padding:7px 12px;
  font-size:13px;
  background:var(--chip);
  color:var(--ink);
  cursor:pointer;
  transition: background .2s, color .2s, border-color .2s;
  white-space:nowrap;
}
.chip.on{
  background: var(--accent);
  color: #fff;
  border-color: transparent;
  position: relative;
  z-index: 1;
  background-clip: padding-box;
  /* glow pi√π naturale e non "stirato": blur con spread negativo */
  box-shadow:
    0 0 0 1px rgba(255,255,255,0.06) inset,
    0 8px 16px -6px rgba(124,58,237,0.55);
} /* CHIP ATTIVO VIOLA GLOW (TIGHT) üü™ */ /* CHIP ATTIVO VIOLA GLOW üü™ */ /* CHIP ATTIVO VIOLA üü™ */

/* ===== Table ===== */
table{border-collapse:collapse;width:100%;font-size:14px;table-layout:fixed}
thead{background:linear-gradient(180deg, rgba(124,58,237,.10), rgba(124,58,237,.03));
  border-bottom:1px solid var(--line)
}
[data-theme="light"] thead{background:linear-gradient(180deg, rgba(124,58,237,.10), rgba(124,58,237,.03));text-align:left;border-top:1px solid var(--line);vertical-align:middle}
td.num{text-align:right;padding-right:10px}
tr:hover{background:rgba(255,255,255,.03)}
.buy{color:var(--green);font-weight:700}
.sell{color:var(--red);font-weight:700}
.muted{color:var(--muted)}
.right{margin-left:auto}
.stat .label{font-size:12px;color:var(--muted)}
.stat .value{font-size:16px;font-weight:600}
.stat{max-width:160px;flex:1}

/* ===== Footer / misc ===== */
.footer{font-size:12px;color:var(--muted);margin-top:16px}
.stats-funds-grid{display:grid;grid-template-columns:auto auto 1fr;gap:12px}
.follow-btn{background:transparent;border:none;cursor:pointer;color:var(--muted);font-size:14px;margin-left:4px}
.follow-btn:hover{color:var(--accent)}
#suggestions div{padding:4px 8px;cursor:pointer}
#suggestions div:hover{background:var(--line)}

.controls .card{min-width:0}
.date-card{max-width:190px}
.search-card{max-width:none;position:relative;width:100%;min-width:0}

.ticker-pill{
  display:inline-block;padding:4px 10px;border-radius:999px;font-weight:700;letter-spacing:.2px;
  background:var(--pill-bg);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
}
.ticker-link{cursor:pointer;text-decoration:none}
.ticker-link:hover{opacity:.95}





.close{margin-left:auto}

.btn.on{background:var(--ink);color:var(--chip-on-ink);border-color:var(--ink)}
#suggestions{box-shadow:0 10px 30px rgba(0,0,0,.45)}

/* ===== Mobile polish (v2) ===== */
@media (max-width: 600px){
  .container{padding:12px}
  section{margin-bottom:14px}
  h1{font-size:18px;line-height:1.2}
  h2{font-size:16px;line-height:1.2}
  label{font-size:13px}
  .controls.grid{gap:10px}
  .controls.grid.fit-240{grid-template-columns:1fr}
  .card.pad{padding:12px}
  .date-card, .search-card{max-width:100%; width:100%}
  input[type="date"], input[type="text"], select, button{
    width:100%; max-width:100%; font-size:14px; box-sizing:border-box;
  }
  .chips{flex-wrap:wrap; overflow:visible; gap:8px}
}
@media (max-width: 600px){
  #table{table-layout:auto; font-size:13px}
  #table th, #table td{padding:8px 10px}
  #table colgroup col{width:auto !important}
  #table td a .muted, #table td, #table th{white-space:normal; word-break:break-word}
  .ticker-pill{font-size:11px; padding:4px 8px}
}
@media (max-width: 420px){
  .ticker-pill{font-size:10px; padding:3px 6px}
  #table{font-size:12px}
  .grid.fit-240{grid-template-columns:1fr}
  #table thead th:nth-child(2),
  #table tbody td:nth-child(2),
  #table thead th:nth-child(4),
  #table tbody td:nth-child(4){display:none}
}

/* Link icon beside ticker */
.ticker-pill.gf-open{cursor:pointer} .name-open{cursor:pointer}
.icon-link{
  display:inline-flex;align-items:center;justify-content:center;
  margin-left:6px;padding:2px 4px;border:none;background:transparent;cursor:pointer;
  color:var(--muted); opacity:.9;
  transition: opacity .2s, transform .05s;
}
.icon-link:hover{opacity:1; transform: translateY(-1px);}

/* === Patches v3.7 === */


/* Right-align Shares header */
th.num{ text-align:right !important; }
/* Slightly tighter table cell spacing */
th,td{ padding:10px 12px; }

/* === v3.8 patches === */


.buy .arrow { color: var(--green); }
.sell .arrow { color: var(--red); }

/* === v3.9 patches === */
/* Make the search card host the buttons nicely on one line when space allows */
@media (min-width: 721px){
  .search-card .row { justify-content: flex-start; }
}
/* Overlay table tighter and defined column widths */



.buy .arrow { color: var(--green); } .sell .arrow { color: var(--red); }

/* === v3.10 patches === */

 /* tighter */

/* === v3.11 patches === */
/* Merge UI: if any empty control cards remain, hide them */
.controls > .card.pad:empty { display:none; }
.search-card{ position:relative; z-index: 20; }
#suggestions{ position:absolute !important; z-index: 10000 !important; }

/* === v3.11b patches === */
/* Suggestions popup: solid background (no transparency/blur) and strong stacking */
#suggestions {
  background: #111418 !important;
  border: 1px solid var(--line) !important;
  backdrop-filter: none !important;
  z-index: 10000 !important;
}
.search-card { position: relative; z-index: 2000; }

/* Inline layout: search input + buttons on the same row */
.search-inline {
  display: flex;
  gap: 10px;
  align-items: center;
  flex-wrap: nowrap;
}
.search-inline input[type="text"] {
  flex: 1 1 auto;
  max-width: 100% !important;
}
@media (max-width: 800px){
  .search-inline { flex-wrap: wrap; }
  .search-inline button { width: auto; }
}


/* === Controls row fix (v3.11b ‚Üí v3.11b-fixed) === */
section.controls{
  display:grid !important;
  grid-template-columns: 250px 250px 1fr !important; /* From | To | Search */
  column-gap: 10px !important;
  row-gap: 0 !important;
}
@media (max-width: 900px){
  section.controls{ grid-template-columns: 1fr !important; row-gap: 10px !important; }
}

/* Keep search input + buttons inline and wide */
.search-inline{ display:flex; gap:8px; align-items:center; flex-wrap:nowrap; }
.search-inline input[type="text"]{ flex:1 1 auto !important; max-width:100% !important; width:100% !important; min-width:0 !important; }

/* Suggestions solid and on top */
#suggestions{ position:absolute !important; z-index: 30000 !important; background:#111418 !important; border:1px solid var(--line) !important; backdrop-filter:none !important; box-shadow:0 14px 40px rgba(0,0,0,.5); }

/* === v3.11b-fixed.1: tighten gaps + prevent right overflow === */
section.controls{
  box-sizing: border-box !important;
  width: 100% !important;
  display: grid !important;
  grid-template-columns: 250px 250px minmax(0, 1fr) !important; /* dates wider + search fills leftover safely */
  column-gap: 6px !important;  /* close the gap a bit more */
  row-gap: 0 !important;
  align-items: stretch !important;
}
.search-card{ max-width: none !important; width: 100% !important; min-width: 0 !important; overflow: hidden; }
.search-inline{ display:flex !important; gap:8px; align-items:center; flex-wrap:nowrap; min-width:0 !important; }
.search-inline input[type="text"]{ flex:1 1 auto !important; min-width:0 !important; width:100% !important; }
.search-inline .btn{ white-space:nowrap; }

/* Defensive: cards should not exceed grid cell */
section.controls > .card.pad{ overflow: hidden; }

/* === v3.11b-fixed.2: no-overflow & balanced columns === */
.wrap{ overflow-x: hidden; } /* safety net, but columns below should remove the need */

section.controls{
  display: grid !important;
  /* responsive, never overflow: two min widths for dates, search fills leftover */
  grid-template-columns: minmax(240px, 1fr) minmax(240px, 1fr) minmax(0, 1.6fr) !important;
  column-gap: 8px !important;
  row-gap: 0 !important;
  box-sizing: border-box !important;
  width: 100% !important;
}
/* remove any margins that could push the last card */
section.controls > .card.pad{ margin: 0 !important; max-width: 100% !important; overflow: hidden; }
.search-card{ max-width: 100% !important; width: 100% !important; min-width: 0 !important; }
.search-inline{ display:flex !important; gap:8px; align-items:center; flex-wrap:nowrap; min-width:0; }
.search-inline input[type="text"]{ flex:1 1 auto !important; width:100% !important; min-width:0 !important; }

/* === v3.11b-fixed.3: eliminate right overflow for search chip === */
section.controls {
  padding-right: 0 !important;
  margin-right: 0 !important;
  overflow: hidden !important;
}
.search-card {
  width: calc(100% - 8px) !important;
  box-sizing: border-box !important;
  overflow: hidden !important;
}

/* === BG FIX: persistent non-repeating gradient layer (v3.11b-fixed.4) === */
/* Evita duplicazioni quando la pagina √® corta e ‚Äúperdita‚Äù del gradiente quando √® lunga. */
html, body { background: none !important; } /* disattiva il background su html/body */
body::before{
  content:"";
  position: fixed;
  inset: 0;
  z-index: -1;
  pointer-events: none;
  background:#000;
  background-image:url('background/bg.jpg');
  background-repeat:no-repeat;
  background-attachment:fixed;
  background-position:center;
  /* v* units garantiscono copertura oltre i bordi anche su schermi ultrawide */
  background-size:cover;
}


/* === OVERLAY THEME + Z-INDEX FIX (v4 - unified with holdings card) === */
/* Pop-up risultati trades: stesso look & feel del popup holdings. */





/* Pulsanti nell'overlay: coerenti con tema ma riusiamo gli stili esistenti per GF / Follow */



/* Tabella nel pop-up: bordi e hover coerenti */




/* === SUGGESTIONS FIX (v3.11b-fixed.8) === */
.search-card{ overflow: visible !important; } /* evita che il menu suggerimenti venga clippato */
#suggestions{ z-index: 40000 !important; background: var(--panel) !important; border: 1px solid var(--line) !important; }
/* arrotonda e aggiunge leggera ombra per coerenza */
#suggestions{ border-radius: 12px; box-shadow: 0 14px 40px rgba(0,0,0,.5); }


/* === SUGGESTIONS CLIP FIX v2 === */
/* Alcuni container avevano overflow:hidden; forziamo visibilit√† solo per la search-card. */
section.controls > .card.pad.search-card{ overflow: visible !important; }
.search-card{ overflow: visible !important; }
#suggestions{ z-index: 40000 !important; border-radius: 12px; box-shadow: 0 14px 40px rgba(0,0,0,.5); }


/* === SUGGESTIONS BODY-LEVEL DROPDOWN === */
#suggestions{ z-index: 60000 !important; pointer-events: auto !important; }


/* === TESTO CHIARO E GRASSETTO PER CHIP + REFRESH === */
.btn.primary,
.chip.on {
  color: #ffffff !important;       /* testo bianco */
  font-weight: 600 !important;     /* grassetto medio-forte */
}


/* === v4.1 UI polish === */
#csvBtn strong,
#goGFBtn strong,
#followBtn strong,
#closeOverlay strong { font-weight: 600; }
#followBtn.on { color: #fff !important; }


/* === v4.2 UI polish ‚Äî ensure bold even when textContent changes === */
#csvBtn,
#goGFBtn,
#followBtn,
#closeOverlay { font-weight: 700 !important; }
#followBtn.on { color: #fff !important; }


/* === Checkbox styling ‚Äî Only my tickers === */
#onlyMine {
  transform: scale(1.6);
  accent-color: var(--accent);
  cursor: pointer;
  margin-right: 8px;
}
label[for="onlyMine"],
label:has(#onlyMine) {
  font-weight: 600;
  color: var(--ink);
}


/* === v4.4 visuals ‚Äî chip border pop + active field glow === */

/* Chips: brighter border, NO blur glow */
.chip {
  border-color: rgba(148,163,184,0.22) !important; /* vivid purple */
  box-shadow: none !important;
}
.chip:hover {
  border-color: #d5aaff !important;
  box-shadow: none !important;
}

/* Active chips: keep very subtle depth without blur */
.chip.on {
  box-shadow:
    0 0 0 1px rgba(255,255,255,0.06) inset,
    0 8px 16px -10px rgba(124,58,237,0.55);
}

/* Inputs (date/search) focus: brighter ring + soft glow (kept) */
 (date/search) focus: brighter ring + soft blur glow */
input[type="date"]:focus,
input[type="text"]:focus,
select:focus,
textarea:focus{
  border-color:#e1c0ff !important;
  box-shadow:
    0 0 0 2px rgba(198,138,255,0.40),
    0 0 22px rgba(198,138,255,0.55);
  backdrop-filter: blur(2px);
  outline:none;
  transition: box-shadow .2s ease, border-color .2s ease;
}


/* === v4.6 ‚Äî Restore neon effect for buttons (not chips) === */
.btn {
  position: relative;
}
.btn:hover,
.btn:focus,
.btn:focus-visible {
  border-color: #d5aaff !important;
  box-shadow:
    0 0 0 2px rgba(198,138,255,0.35),
    0 0 18px rgba(198,138,255,0.45) !important;
  outline: none;
}
/* Keep primary buttons readable with same neon ring */
.btn.primary:hover,
.btn.primary:focus,
.btn.primary:focus-visible {
  border-color: #d5aaff !important;
  box-shadow:
    0 0 0 2px rgba(198,138,255,0.40),
    0 0 22px rgba(198,138,255,0.55) !important;
}
/* Overlay buttons share the same interaction effect */

/* Explicitly ensure chips DO NOT inherit button neon */
.chip, .chip:hover, .chip:focus { box-shadow: none !important; }


/* Fund chips: add soft neon on hover/focus and stronger when active */
.chips .chip {
  transition: border-color .2s ease, box-shadow .2s ease, transform .06s ease;
}
.chips .chip:hover,
.chips .chip:focus {
  border-color: #d5aaff !important;
  box-shadow:
    0 0 0 2px rgba(198,138,255,0.30),
    0 0 18px rgba(198,138,255,0.38) !important;
}
.chips .chip.on {
  border-color: #e1c0ff !important;
  box-shadow:
    0 0 0 2px rgba(198,138,255,0.36),
    0 0 22px rgba(198,138,255,0.48) !important;
}

/* Inputs: restore/strengthen neon on focus (date + search) */
input[type="date"]:focus,
input[type="text"]:focus,
select:focus,
textarea:focus {
  border-color:#e6caff !important;
  box-shadow:
    0 0 0 2px rgba(198,138,255,0.42),
    0 0 26px rgba(198,138,255,0.58) !important;
  outline:none;
}


/* === v4.8 ‚Äî Fix fund chip glow (only on hover/focus; subtle when active) === */
.chips .chip{
  box-shadow: none !important;            /* default: NO glow */
  border-color: rgba(148,163,184,0.22) !important;       /* bright border */
  transition: border-color .2s ease, box-shadow .2s ease, transform .06s ease;
}
.chips .chip:hover,
.chips .chip:focus-visible{
  border-color: #e1c0ff !important;
  box-shadow:
    0 0 0 2px rgba(198,138,255,0.26),
    0 0 16px rgba(198,138,255,0.34) !important;
  outline: none;
}
/* Active chip: keep it clean (no outer glow), just a crisp ring */
.chips .chip.on{
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,0.06),
    0 0 0 1px rgba(198,138,255,0.30) !important;
  border-color: #e1c0ff !important;
}
/* Active + hover/focus: allow the full glow */
.chips .chip.on:hover,
.chips .chip.on:focus-visible{
  box-shadow:
    0 0 0 2px rgba(198,138,255,0.34),
    0 0 22px rgba(198,138,255,0.46) !important;
  outline: none;
}


/* === v4.9 ‚Äî Row-level click to open overlay (cursor hint) === */
#table tbody tr { cursor: pointer; }
#table tbody tr.day-break td{
  border-top: 1px solid rgba(163, 106, 255, 0.76);
}
#table tbody tr.day-break td:first-child{
  padding-top: 10px;
}

#table tbody tr .gf-open { cursor: pointer; } /* ticker chip keeps its behavior */


/* === v4.11 ‚Äî Fix chip glow clipping + arrow colors === */

/* Make sure the scroll row that contains #fundsChips does not clip shadows */
.row:has(#fundsChips){
  overflow: visible !important;
  padding-top: 4px;
  padding-bottom: 4px;
}

/* Give the chips wrapper a bit of breathing room */
#fundsChips{
  overflow: visible !important;
  padding: 2px 0;
}

/* Arrow colors aligned with Buy/Sell */
.buy .arrow { color: #68cf74 !important; }
.sell .arrow { color: #e94c2b !important; }


/* === v4.12 ‚Äî Ticker avatars (local + online fallback) === */
.avatar{
  width:28px;height:28px;min-width:28px;border-radius:50%;
  display:inline-flex;align-items:center;justify-content:center;
  overflow:hidden;background:rgba(124,58,237,.18);
  border:1px solid rgba(198,138,255,.45);
  box-shadow:0 0 0 2px rgba(124,58,237,.12),0 2px 8px rgba(0,0,0,.35);
  margin-right:8px;
}
.avatar img{width:100%;height:100%;object-fit:cover;display:block}
.avatar .mono{font-size:12px;font-weight:700;letter-spacing:.3px;color:#fff;opacity:.9;text-transform:uppercase}
.td-name{display:flex;align-items:center}
.td-name .ticker-wrap{display:inline-flex;align-items:center;gap:6px}


/* === v4.13 ‚Äî Header alignment & unified buy/sell colors === */

/* 1) Header alignment: left for text columns, right only for numeric */
#table thead th { text-align: left !important; }
#table thead th.num, #table tbody td.num { text-align: right !important; }

/* Popup table too */



/* 2) Unify BUY/SELL color: same for text and arrow */
td.num.buy, td.num.sell { font-weight: 700; }
td.num.buy  { color: #68cf74 !important; }  /* green (buy) */
td.num.sell { color: #e94c2b !important; }  /* red (sell) */
td.num .arrow { color: currentColor !important; } /* arrow matches text color */


/* === v4.14 ‚Äî Overlay polish (solid, compact, header info) === */

/* Solid panel (no transparency) + narrower width */



/* Header: align items and allow our badge row */


/* Compact table spacing + slightly smaller font */



/* Name row visuals inside header */
#focusTitle .td-name{ display:flex; align-items:center; gap:8px; }
#focusTitle .avatar{ width:28px; height:28px; min-width:28px; }
#focusTitle .ticker-pill{ font-size:12px; padding:4px 8px; }
#focusTitle .company{ color: var(--ink); opacity:.9; }


/* === V6-from-backup ‚Äî Popup header tweaks === */
/* Smaller Follow button */

/* Close as circular X */



/* === V8 ‚Äî Follow ‚Üí Bookmark icon toggle (updated to work with orange icon buttons) === */
#followBtn{
  width: 40px; height: 40px;
  padding: 0;
  display: inline-flex; align-items: center; justify-content: center;
  border-radius: 999px;
  line-height: 1;
}
#followBtn.on{
  box-shadow: 0 6px 16px rgba(0,0,0,0.7);
}
#followBtn:hover{
  opacity: 0.95;
}


/* === V9-fix ‚Äî External link icon button (before Save) === */
#openGFBtn{
  width: 36px; height: 36px;
  padding: 0 !important;
  display: inline-flex; align-items:center; justify-content:center;
  border-radius: 999px;
  line-height:1;
  margin-right: 4px; /* before the save button */
}
#openGFBtn svg{ width:18px; height:18px; display:block; }
#openGFBtn svg path{ stroke: currentColor; fill: currentColor; }
#openGFBtn:hover{
  border-color: #d5aaff !important;
  box-shadow:
    0 0 0 2px rgba(198,138,255,0.35),
    0 0 18px rgba(198,138,255,0.45) !important;
}


/* === V15 layout styles === */
.stat-card{ border:1px solid rgba(255,255,255,.08); }
.stat-card .big-num{ font-size:38px; font-weight:800; letter-spacing:.2px; }
.stat-card .badge{ background:rgba(255,255,255,.06); padding:8px 10px; border-radius:10px; }
#layoutTwoCol .card.pad label{ display:block; margin-bottom:4px; font-weight:600; }
@media (max-width: 980px){ #layoutTwoCol{ grid-template-columns: 1fr; } }


/* === V16 fixes === */
.results-head{ display:flex; align-items:center; justify-content:space-between; gap:8px; }
.results-actions{ display:flex; align-items:center; gap:8px; }

#toggleMineBtn{
  width: 36px; height: 36px;
  padding: 0 !important;
  display: inline-flex; align-items:center; justify-content:center;
  border-radius: 999px; line-height:1;
}
#toggleMineBtn svg{ width:18px; height:18px; display:block; }
#toggleMineBtn svg path{ stroke: currentColor; fill: none; stroke-width: 2; }
#toggleMineBtn.on{
  background: var(--accent) !important;
  border-color: var(--accent) !important;
  color: var(--accent-ink) !important;
}
#toggleMineBtn:hover{
  border-color: #d5aaff !important;
  box-shadow: 0 0 0 2px rgba(198,138,255,0.35), 0 0 18px rgba(198,138,255,0.45) !important;
}

/* wrap chips to multiple lines */
#fundsChips .chips, #slot-fundsChips .chips{ display:flex; flex-wrap:wrap; gap:8px; }


/* === V25: strict two-column layout === */
#twoCol {
  display: grid;
  grid-template-columns: 360px 1fr;
  gap: 16px;
  align-items: start;
  margin-top: 12px;
}
#leftCol > .card.pad { margin-bottom: 12px; }
#statsRow { display: grid; grid-template-columns: 1fr; gap: 12px; }
#statsRow .card.pad { box-shadow: inset 0 0 0 1px rgba(198,138,255,.35); border-radius: 16px; min-height: 96px; display: flex; }
#filterHeader{ min-height: 96px; padding: 6px 0; margin-bottom: 8px; display:flex; align-items:center; }
.stats-funds-grid{ display:none !important; } /* hide legacy summary */
#slot-fundsChips .chips, #fundsChips .chips { display:flex; flex-wrap:wrap; gap:8px; }

/* Results header actions (bookmark) */
/* Results icon white and slightly larger */
.muted svg {
  fill: #fff !important;
  width: 20px !important;
  height: 20px !important;
}
/* Icon color & alignment for Refresh / CSV buttons */
#fetchBtn svg,
#csvBtn svg {
  fill: #fff;
  vertical-align: middle;
  margin-top: -1px;
}

#csvBtn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}

#csvBtn strong {
  color: #fff;
}
/* Stat-cards as filter chips */
.stat-card{ cursor: pointer; transition: box-shadow .15s ease, border-color .15s ease, background .15s ease; }
.stat-card:hover{
  border-color: #d5aaff !important;
  box-shadow: 0 0 0 2px rgba(198,138,255,0.35), 0 0 18px rgba(198,138,255,0.45) !important;
}
.stat-card.active{
  background: rgba(198,138,255,0.12) !important;
  border-color: var(--accent) !important;
  box-shadow: 0 0 0 2px rgba(198,138,255,0.45), inset 0 0 0 1px rgba(198,138,255,0.35) !important;
}
/* Results header layout */
.results-head{ display:grid; grid-template-columns: 1fr auto 1fr; align-items:center; gap:8px; }
.results-left{ display:flex; align-items:center; gap:8px; }
.results-center{ display:flex; align-items:center; justify-content:center; gap:6px; } /* tighter gap */
.results-right{ display:flex; align-items:center; justify-content:flex-end; gap:8px; }

/* Compact pager buttons */
.pager-btn{
  width:22px;
  height:22px;
  border-radius:999px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:0;
  border:1px solid rgba(255,176,120,0.85);
  background: linear-gradient(135deg, #ffb347, #ff7a18);
  box-shadow:
    0 0 0 1px rgba(255,255,255,0.04) inset,
    0 8px 22px rgba(255,140,0,0.55);
}

/* Pager "chip" container */
.pager-chip{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:0;              /* niente pill: togliamo imbottitura extra */
  border-radius:0;        /* nessun bordo arrotondato intorno ai bottoni */
  background:transparent; /* nessuno sfondo viola */
  border:none;            /* nessun bordo visibile */
  box-shadow:none;        /* niente glow / ombra di contenitore */
  backdrop-filter:none;   /* niente blur di vetro */
}


.pager-label{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  line-height:1.1;
}

.pager-text{ display:none; }

.pager-numbers{
  font-weight:700;
  font-size:13px;
  letter-spacing:0.35em;
}

.pager-arrow .pager-icon{
  width:14px;
  height:14px;
  display:block;
  filter: drop-shadow(0 0 4px rgba(0,0,0,0.7));
}

.pager-prev .pager-icon{
  transform: rotate(-90deg);
}

.pager-next .pager-icon{
  transform: rotate(90deg);
}

.pager-btn:disabled{
  opacity:0.35;
  box-shadow:none;
}

@media (max-width: 720px){
  .pager-chip{
    padding:6px 10px;
    gap:8px;
  }
  .pager-label{
    align-items:flex-start;
  }
}

/* Pill-styled selects (uniform with theme) */
.pill-select, select#typeFilter{
  appearance:none; -webkit-appearance:none; -moz-appearance:none;
  background: var(--accent); color: #fff;
  border: 1px solid var(--line);
  border-radius: 999px;
  padding: 6px 12px;
  font-weight: 700;
  cursor: pointer;
}
.pill-select:hover, select#typeFilter:hover{
  border-color: #d5aaff !important;
  box-shadow: 0 0 0 2px rgba(198,138,255,0.35), 0 0 18px rgba(198,138,255,0.45) !important; /* neon glow */
}
.pill-select:focus, select#typeFilter:focus{
  outline: none;
  box-shadow: 0 0 0 2px rgba(198,138,255,0.35), 0 0 18px rgba(198,138,255,0.45) !important;
}
.results-head{ display:grid; grid-template-columns: 1fr auto 1fr; align-items:center; gap:8px; }
.results-left{ display:flex; align-items:center; gap:8px; }
.inline-size{ display:flex; align-items:center; gap:8px; }
.results-center{ display:flex; align-items:center; justify-content:center; gap:10px; }
.results-right{ display:flex; align-items:center; justify-content:flex-end; gap:8px; }

/* Pager buttons compact */
.pager-btn{
  width:20px;
  height:20px;
  border-radius:999px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:0;
  border:0px solid rgb(0, 0, 0);
  background:linear-gradient(135deg,#ff8c00,#ff6700);
  box-shadow:
    0 0px 4px rgba(255,140,0,0.55);
}

/* Pager "chip" container */

.pager-label{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  line-height:1.1;
}

.pager-text{ display:none; }

.pager-numbers{
  font-weight:700;
  font-size:13px;
  letter-spacing:0.35em;
}

.pager-arrow .pager-icon{
  width:14px;
  height:14px;
  display:block;
  filter: drop-shadow(0 0 4px rgba(0,0,0,0.7));
}

.pager-prev .pager-icon{
  transform: rotate(-90deg);
}

.pager-next .pager-icon{
  transform: rotate(90deg);
}

.pager-btn:disabled{
  opacity:0.35;
  box-shadow:none;
}

@media (max-width: 720px){
  .pager-chip{
    padding:6px 10px;
    gap:8px;
  }
  .pager-label{
    align-items:flex-start;
  }
}

/* Pill-styled selects (page size + trade type) */
.pill-select, select#typeFilter{
  appearance:none; -webkit-appearance:none; -moz-appearance:none;
  background: var(--accent); color: #fff;
  border: 1px solid var(--line);
  border-radius: 999px;
  padding: 6px 10px;
}
.pill-select:focus, select#typeFilter:focus{ outline: none; box-shadow: 0 0 0 2px rgba(198,138,255,0.35); }
.results-head{ display:flex; align-items:center; justify-content:space-between; gap:8px; }
.results-actions{ display:flex; align-items:center; gap:8px; }
#toggleMineBtn{
  width:22px; height:22px; padding:0 !important; display:inline-flex; align-items:center; justify-content:center;
  border-radius:999px; line-height:1;
}
#toggleMineBtn svg{ width:18px; height:18px; display:block; }
#toggleMineBtn svg path{ stroke: currentColor; fill: none; stroke-width: 2; }
#toggleMineBtn.on{ color:#fff !important; background: var(--accent) !important; border-color: var(--accent) !important; }

@media (max-width: 980px){
  #twoCol{ grid-template-columns: 1fr; }
}


/* === V26 fixes === */
/* Popup bookmark active: white icon/text */




/* Tighten Search Filters header vertical spacing */
#filterHeader{ padding-top:0px !important; padding-bottom:0px !important; margin-bottom:8px !important; align-items:center; }

/* Compatta l‚Äôheader dei filtri */
#filterHeader h3{
  margin: 0 !important;        /* elimina i 1em dell'user agent */
  line-height: 1.1;
}

/* facoltativo: ancora pi√π stretto sopra/sotto */
#filterHeader{
  padding-top: 0px !important;
  padding-bottom: 0px !important;
}

/* solo se vedi ancora aria: pu√≤ venire dal padding della card */
#filterCard > .row:first-child{
  margin-bottom: 0px !important;  /* da 10px a 6px o 4px */
}



/* === V27 ‚Äî Slim Search Filters: big chip header + flat fields === */
#filterCard{
  padding:14px 14px 16px;
  border-radius:24px;
  background:
    radial-gradient(circle at 0% 0%, rgba(124,58,237,0.35), transparent 55%),
    radial-gradient(circle at 100% 100%, rgba(15,23,42,0.9), rgba(10,6,20,0.98));
  border:1px solid rgba(148,163,184,0.28);
}
#filterHeader{
  background: rgba(124, 58, 237, 0.1);
  box-shadow: inset 0 0 0 1px rgba(198,138,255,.35);
  border-radius: 999px;
  padding: 10px 14px !important;
  margin-bottom: 12px !important;
  align-items: center;
}
#filterHeader h3{ margin:0 !important; line-height:1.15; }

/* Remove nested card look for inner blocks */
#filterCard > .row,
#filterCard > .card.pad{
  background: transparent !important;
  box-shadow: none !important;
  border: 0 !important;
  padding: 0 !important;
  margin: 10px 0 0 0 !important;
  border-radius: 0 !important;
}

/* Inner "field cards" in the two-column row (Start/End) */
#filterCard > .row > .card.pad{
  background: transparent !important;
  box-shadow: none !important;
  border: 0 !important;
  padding: 0 !important;
  margin: 0 !important;
}

/* Space between label and input */
#filterCard label{ display:block; margin: 0 0 6px 0; font-weight:600; }

/* Keep inputs full width */
#filterCard .input, #filterCard input[type="date"]{ width:100%; }

/* Funds chips area: keep wrapping and reduce extra margin */
#slot-fundsChips .chips{ display:flex; flex-wrap:wrap; gap:8px; }


/* === V28 ‚Äî Filters chip simplified, funds removed, stat icons larger === */

/* Filter card: compact padding */
#filterCard{ padding:12px 14px 14px !important; }
/* Header as a single "chip" */
#filterHeader{
  background: rgba(124,58,237,0.10);
  box-shadow: inset 0 0 0 1px rgba(198,138,255,.35);
  border-radius: 999px;
  padding: 8px 12px !important;
  margin: 4px 0 10px 0 !important;
  display:flex; align-items:center; gap:10px;
}
#filterHeader h3{ margin:0 !important; line-height:1.1; font-weight:700; }
#filterHeader .icon svg{ width:18px; height:18px; stroke:currentColor; fill:none; stroke-width:2; }

/* Flatten inner groups: remove nested "card" look entirely */
#filterCard > .row, #filterCard > .card.pad{ background:transparent !important; border:0 !important; box-shadow:none !important; padding:0 !important; margin:10px 0 0 0 !important; border-radius:0 !important; }
#filterCard > .row > .card.pad{ margin:0 !important; }
#filterCard label{ display:block; margin:0 0 6px 0; font-weight:600; }
#filterCard .input, #filterCard input[type="date"]{ width:100%; }

/* Hide the Funds chips area entirely (UI) */
#slot-fundsChips, #fundsChips{ display:none !important; }
#filterCard .funds-block, #filterCard label[for="funds"]{ display:none !important; }

/* Stat cards: larger icon button on the right */
.stat-card{ position:relative; }
.stat-card .badge{
  margin-left:auto;
  width:22px; height:22px; border-radius:10px;
  display:flex; align-items:center; justify-content:center;
  font-size:18px;
}


/* === V29: remove Search Filters title + reposition stat icons === */

/* Remove header block of filters */
/* removed display none for filterHeader */

/* Stat icons pinned to right edge */
.stat-card {
  position: relative;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.stat-card .badge {
  position: absolute;
  right: 18px;
  top: 50%;
  transform: translateY(-50%);
  width: 40px;
  height: 40px;
  font-size: 20px;
  border-radius: 12px;
  background: rgba(124,58,237,0.15);
  color: #a882ff;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 0 6px rgba(167,139,250,0.5);
}


/* === V30: stat icons padding + color swap, re-add compact Search Filters title === */

/* Stat icons to the right with more padding and color swap */
.stat-card .badge {
  right: 28px; /* more spacing from border */
  background: #a882ff; /* violet background */
  color: #1b0f3f; /* dark violet icon */
  box-shadow: 0 0 6px rgba(167,139,250,0.5);
}

/* Compact Search Filters title above inputs */
#filterTitle {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
  color: #fff;
  font-weight: 700;
  font-size: 1.1rem;
}
#filterTitle svg {
  width: 18px;
  height: 18px;
  stroke: currentColor;
  fill: none;
  stroke-width: 2;
}


/* === V31: stat chips hover glow + white text + thick mono icons === */
.stat-card{
  color: #ffffff;
  transition: box-shadow .2s ease, transform .2s ease;
}
.stat-card:hover{
  box-shadow: 0 0 0 2px rgba(168,130,255,0.25), 0 0 24px rgba(168,130,255,0.35);
  transform: translateY(-1px);
}
.stat-card .badge{
  right: 28px;
  background: #a882ff;   /* neon violet bg */
  color: #1b0f3f;        /* dark violet icon */
  box-shadow: 0 0 6px rgba(167,139,250,0.5);
}
/* Keep titles/subtexts readable on dark */
.stat-card .muted{ color: rgba(255,255,255,0.7); }


/* === V32: force white filled icons in stat badges === */
.stat-card .badge{
  right: 28px;
  width: 42px; height: 42px;
  border-radius: 12px;
  background: #a882ff; /* neon violet */
  box-shadow: 0 0 6px rgba(167,139,250,0.5);
}
.stat-card .badge svg{ width:24px; height:24px; display:block; }
.stat-card .badge svg path,
.stat-card .badge svg rect,
.stat-card .badge svg polygon{
  fill: #fff !important;
  stroke: none !important;
}


/* === V34: white filled SVGs in stat badges === */
.stat-card .badge {
  position: absolute;
  right: 28px;
  top: 50%;
  transform: translateY(-50%);
  width: 42px;
  height: 42px;
  border-radius: 12px;
  background: #a882ff;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 0 6px rgba(167,139,250,0.5);
}
.stat-card .badge svg *{
  fill: #fff !important;
  stroke: none !important;
}


/* === V35: centered vertical arrows white-filled === */
.stat-card .badge svg * { fill: #fff !important; stroke: none !important; }


/* === icons pipeline: load external SVGs from /icons === */
.stat-card .badge{
  position: absolute;
  right: 28px; top: 50%; transform: translateY(-50%);
  width: 42px; height: 42px; border-radius: 12px;
  background: #a882ff; display:flex; align-items:center; justify-content:center;
  box-shadow: 0 0 6px rgba(167,139,250,0.5);
}
.stat-card .badge .stat-icon{ width:24px; height:24px; display:block; }


/* === v5: uniform search width (Search Ticker/Fund = 235px like dates) === */
#slot-search input[type="text"]{ /* reset by v4.21 */ }
#slot-search{
  display: inline-flex;
  justify-content: flex-start;
}


/* === v5.1: exact equal widths for filters (dates + search) === */
#filterCard input[type="date"]{
  width: 235px !important;
  max-width: 235px !important;
  box-sizing: border-box !important;
  padding: 12px 12px !important;
  border-width: 1px !important;
}
#filterCard #slot-search input[type="text"]{ /* reset by v4.21 */ }
/* Center the three inputs inside their slots so outer edges align */
#slot-search{
  display: flex !important;
  justify-content: center !important;
}


/* === v5.2: left-align filter inputs (no centering) === */
#slot-search{
  display: flex !important;
  justify-content: flex-start !important;  /* align to the left */
}
#slot-search input[type="text"]{
  margin: 0 !important;   /* remove auto-centering */
}


/* === v6: slimmer filter column (260px) === */
#layoutTwoCol {
  grid-template-columns: 260px 1fr !important;
}
#filterCard {
  max-width: 260px !important;
}


/* v6.4: violet neon button link for Source note */
.api-status-btn {
  display:inline-block;
  background:#7c3aed;
  color:#0d0716 !important;
  font-weight:600;
  border-radius:999px;
  padding:2px 10px;
  text-decoration:none;
  box-shadow:0 0 12px rgba(124,58,237,.6);
  transition:all .2s ease;
  border:1px solid rgba(167,139,250,.35);
}
.api-status-btn:hover {
  box-shadow:0 0 18px rgba(167,139,250,.9);
  transform:translateY(-1px);
}


/* v6.5: violet neon style + larger text for title and source */
.api-status-btn {
  background:#3f3160;
  color:#fff !important;
  font-weight:700;
  border-radius:999px;
  padding:2px 16px;
  text-decoration:none;
  box-shadow:0 0 8px rgba(223, 95, 255, 0.6);
  transition:all .2s ease;
  border:1px solid #a882ff;
  font-size:12px;
}
.api-status-btn:hover {
  box-shadow:0 0 5px violet;
  transform:translateY(-1px);
}

/* Larger Source note */
p.note {
  font-size:11px !important;
  font-weight:600;
}

/* Larger ARK Trades title */
h1, #mainTitle, #titleARK {
  font-size:34px !important;
  letter-spacing:0px;
}


/* === v4.15 ‚Äî Popup scrollbar violet + sticky header === */


/* Sticky header (ticker/title + buttons remain visible while scrolling) */


/* WebKit scrollbars (Panel + inner body) */





/* Firefox scrollbar colors */



/* === v4.16 ‚Äî Compact ticker search width + inline controls === */
#slot-search{
  display:inline-flex !important;
  align-items:center !important;
  gap:8px !important;
  flex-wrap:nowrap !important;
}
#slot-search .btn{ padding:10px 12px; } /* tighter fit */
#slot-search #clearBtn{ line-height:1; }


/* === v4.18 ‚Äî Search inline order + spacing === */
#slot-search{ display:inline-flex !important; align-items:center !important; gap:10px !important; }
#slot-search #searchBox{ min-width: 240px; }
#slot-search #fetchBtn, #slot-search #clearBtn{ flex: 0 0 auto; }


/* === v4.19 ‚Äî Clear 'X' inside search input + Export align === */
.search-wrap{
  position: relative;
  display: inline-block;
}
.search-wrap #searchBox{
  padding-right: 36px !important; /* room for the X */
}
.clear-inside{
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  width: 26px; height: 26px;
  padding: 0 !important;
  border-radius: 999px;
  display: inline-flex; align-items: center; justify-content: center;
  opacity: .9;
}
.clear-inside:hover{ opacity: 1; }
#slot-csvBtn{
  display:flex !important; justify-content:flex-start !important; align-items:center !important; }
#slot-csvBtn .btn{ margin-left: 0 !important; }


/* === v4.19.1 ‚Äî Fix clear button motion and glow === */
.clear-inside,
.clear-inside:hover,
.clear-inside:focus,
.clear-inside:focus-visible{
  box-shadow: none !important;
  border-color: transparent !important;
  outline: none !important;
}
.clear-inside:active{
  transform: translateY(-50%) !important; /* lock position */
}


/* === v4.19.2 ‚Äî Circular clear button with neon (no movement) === */
.clear-inside{
  position:absolute; right:8px; top:50%;
  transform: translateY(-50%); /* lock vertical center */
  width: 26px; height: 26px;
  padding: 0 !important;
  border-radius: 999px;
  border: 1px solid rgba(198,138,255,0.55);
  background: rgba(124,58,237,0.10);
  box-shadow: 0 0 0 1px rgba(255,255,255,0.06) inset;
  display: inline-flex; align-items:center; justify-content:center;
  transition: box-shadow .15s ease, border-color .15s ease, opacity .15s ease;
}
.clear-inside svg{ width:14px; height:14px; display:block; }
.clear-inside:hover,
.clear-inside:focus,
.clear-inside:focus-visible{
  border-color:#d5aaff;
  box-shadow:
    0 0 0 2px rgba(198,138,255,0.32),
    0 0 16px rgba(198,138,255,0.40);
  outline:none;
  opacity:1;
}
/* Keep it fixed in place even on :active */
.clear-inside:active{ transform: translateY(-50%); }


/* Hide Export CSV button/slot */
#csvBtn{ display:none !important; }
#slot-csvBtn{ display:none !important; }


/* === v4.21 ‚Äî Clean reset: make Search fill available width === */
#filterCard #slot-search{
  display: flex !important;
  align-items: center !important;
  gap: 10px !important;
  min-width: 0 !important;
}
#filterCard #slot-search .search-inline{ display:flex !important; gap:10px !important; align-items:center !important; flex:1 1 auto !important; min-width:0 !important; }
#filterCard #slot-search .search-wrap{ position:relative; flex:1 1 auto !important; min-width:0 !important; display:block !important; }
#filterCard #slot-search input[type="text"]{
  width: 100% !important;
  max-width: none !important;
  min-width: 0 !important;
  flex: 1 1 auto !important;
}
#filterCard #slot-search .btn{ flex: 0 0 auto !important; }


/* === v4.22 ‚Äî Search layout: prevent overlap with Enter === */
#filterCard #slot-search{
  display: flex !important;
  align-items: center !important;
  gap: 10px !important;
}
#filterCard #slot-search .search-inline{
  display: flex !important;
  align-items: center !important;
  gap: 10px !important;
  flex: 1 1 auto !important;
  min-width: 0 !important;
}
#filterCard #slot-search .search-wrap{
  position: relative;
  flex: 1 1 auto !important;
  min-width: 0 !important;
}
#filterCard #slot-search #searchBox{
  width: 100% !important;
  max-width: 100% !important;
  min-width: 0 !important;
  flex: 1 1 auto !important;
  padding-right: 40px !important; /* room for inner X */
}
#filterCard #slot-search #fetchBtn{
  width: 40px !important;
  height: 40px !important;
  padding: 0 !important;
  border-radius: 999px !important;
  flex: 0 0 40px !important; /* fixed size to avoid overlap */
}


/* === v4.22.1 ‚Äî Prevent search input from extending under Enter === */
#filterCard #slot-search{ display:flex !important; align-items:center !important; gap:10px !important; }
#filterCard #slot-search .search-inline{ display:flex !important; align-items:center !important; gap:10px !important; flex-wrap:nowrap !important; width:100% !important; min-width:0 !important; }
#filterCard #slot-search .search-wrap{ position:relative; flex:1 1 auto !important; min-width:0 !important; }
#filterCard #slot-search #fetchBtn{ width:40px !important; height:40px !important; flex:0 0 40px !important; padding:0 !important; border-radius:999px !important; }
#filterCard #slot-search #searchBox{
  flex: 0 1 auto !important;
  width: calc(100% - 50px) !important; /* 40px button + 10px gap */
  max-width: calc(100% - 50px) !important;
  min-width: 0 !important;
  padding-right: 40px !important;  /* room for inner X */
}



/* === v7.1 ‚Äî Filters docked inside sidebar === */


/* Sidebar filter card: single source of truth */
#filterCard{
  margin-top:10px;
  background: radial-gradient(
      circle at 0% 0%,
      rgba(124,58,237,0.40) 0%,
      rgba(22,14,46,0.98) 45%,
      rgba(3,2,8,1) 100%
  ) !important;
  border-radius:20px !important;
  border:1px solid rgba(131, 0, 255, 0.55) !important;
  box-shadow:0 0 12px rgba(65, 0, 131, 0.41) !important;
}




#filterCard .card.pad{
  background:transparent !important;
  border:none !important;
  box-shadow:none !important;
  padding:0 !important;
  margin:8px 0 0 0 !important;
  border-radius:0 !important;
}
#filterCard label{
  font-size:12px;
}
#filterCard #filterTitle{
  display:flex;
  align-items:center;
  gap:8px;
  margin-bottom:6px;
}
#filterCard #filterTitle span{
  font-size:13px;
}

/* Results layout: single wide column when filters are in sidebar */
#layoutTwoCol{
  grid-template-columns:1fr !important;
}


/* Sidebar trade type chips */


.sidebar-chips{
  margin-top:18px;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.sidebar-chips-label{
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:0.08em;
  color:var(--muted);
  opacity:.9;
  margin-bottom:2px;
}

.type-chip{
  width:100%;
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 12px;
  border-radius:999px;
  border:1px solid transparent;
  background:radial-gradient(circle at 0% 0%,
    rgba(76,29,149,0.45),
    rgba(10,6,20,0.98));
  font-size:13px;
  color:var(--ink);
  cursor:pointer;
  transition:background .15s ease, border-color .15s ease,
             box-shadow .15s ease, transform .05s ease;
  box-shadow:0 0 0 1px rgba(15,23,42,0.9);
}

/* Date range pill (filters) */
#dateRangePill{ display:block; width:100%; }

.date-range-pill{
  position:relative;
  width:100%;
  display:flex;
  align-items:center;
  justify-content:flex-start;
  gap:10px;
  padding:12px 16px;           /* pi√π alta e un filo pi√π larga, come la search */
  min-height:36px;             /* forza un'altezza simile alla pill di ricerca */
  border-radius:999px;
  border:1px solid rgba(184, 114, 252, 0.68);
  background:radial-gradient(circle at 0% 0%,
    rgba(76,29,149,0.45),
    rgba(10,6,20,0.98));
  cursor:pointer;
  box-sizing:border-box;
}
);
  background:radial-gradient(circle at 0% 0%,
    rgba(76,29,149,0.45),
    rgba(10,6,20,0.98));
  cursor:pointer;
  box-sizing:border-box;
}
.date-range-text{
  display:flex;
  flex-direction:column;
  gap:2px;
}
.date-range-caption{
  display:none;
}
.date-range-value{
  font-size:11px;
  font-weight:600;
  color:#ffffff;
}
.date-range-pill-icon{
  position:absolute;
  right:10px;
  top:50%;
  transform:translateY(-50%);
  width:30px;
  height:30px;
  border-radius:999px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(135deg,#ff8c00,#ff6700);
  box-shadow:0 0 18px rgba(255,140,0,0.6);
}
.date-range-pill-icon svg{
  width:16px;
  height:16px;
}
.date-range-pill-icon svg rect,
.date-range-pill-icon svg path{
  fill:none;
  stroke:#ffffff;
  stroke-width:2;
}

.type-chip:hover{
  border-color:rgba(198,138,255,0.6);
  box-shadow:0 0 10px rgba(198,138,255,0.30);
}

.chip-icon{
  width:32px;
  height:32px;
  border-radius:14px;
  background:linear-gradient(135deg, rgba(88,28,135,0.95), rgba(129,140,248,0.9));
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 0 6px rgba(129,140,248,0.45);
  flex-shrink:0;
}
.chip-icon img{
  width:18px;
  height:18px;
}

.chip-text{
  display:flex;
  flex-direction:column;
  align-items:flex-start;
  gap:2px;
}
.chip-title{
  font-size:12px;
  font-weight:600;
}
.chip-sub{
  font-size:11px;
  opacity:.75;
}

/* Active state */
.type-chip.active{
  background: linear-gradient(90deg, rgba(116, 0, 189, 0.69), #6f00c1, #2c0060);
  color:#ffffff !important;
  border-color:var(--accent);
  box-shadow:0 0 77px rgb(84, 0, 183);
  transform:translateY(-1px);
}
.type-chip.active .chip-title,
.type-chip.active .chip-sub{
  color:#ffffff !important;
}
.type-chip.active .chip-icon{
  background:linear-gradient(135deg, #ff8c00, #ff6700);
  box-shadow:0 0 24px rgb(186, 0, 255);

}

/* === v8.1 ‚Äî Fix date width inside sidebar filter card === */
#filterCard input[type="date"],
#filterCard input[type="text"] {
  width: 100% !important;
  max-width: 100% !important;
}

/* --- Source API: testo + bottone sulla stessa riga --- */
.note{
  display:flex;
  align-items:center;
  gap:8px;       /* distanza tra testo e bottone */
  margin:0;
}

/* bottone stile pillola, inline */
.api-status-btn{
  display:inline-flex;
  align-items:center;
  padding:4px 12px;
  border-radius:999px;
  font-size:9px;
  font-weight:600;
  background:rgba(120,60,255,0.18);
  color:#ebe3ff;
  text-decoration:none;


  margin:0;      /* IMPORTANTISSIMO per evitare che scenda sotto */
}



/* Added Lemon LOGO image style üçã */
.sidebar-logo-img{
  position:absolute;
  left:50%;
  bottom:40px;            /* alzata rispetto al bordo */
  transform:translateX(-50%);
  width:220px;
  height:220px;
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0.95;
  pointer-events:none;
}
.sidebar-logo-img img{
  transform: scaleX(-1);

  width:130%;
  height:auto;
  display:block;
  object-fit:cover;
}


/* === Custom: Sidebar ticker search pill + date pills === */

/* Search pill container */
#filterCard #slot-search{
  position: relative;
  display: flex !important;
  align-items: center;
  gap: 8px;
  padding: 3px 3px;
  border-radius: 999px;
  background:
    radial-gradient(circle at 0% 0%, rgba(124,58,237,0.35), rgba(15,10,30,0.96));
  border: 1px solid rgba(198,138,255,0.75);
  box-shadow:0 0 10px rgba(124,58,237,0.25);
  width: 100%;
}

/* wrapper inside slot-search (where input lives) */
#filterCard #slot-search .search-wrap{
  flex: 1 1 auto;
}

/* text input inside pill */
#filterCard #slot-search #searchBox{
  width: 100% !important;
  max-width: none !important;
  min-width: 0 !important;
  border: none !important;
  background: transparent !important;
  box-shadow: none !important;
  padding: 8px 40px 8px 14px !important; /* spazio per la X (anche se nascosta) */
  font-size: 13px;
  color: var(--ink);
}
#filterCard #slot-search #searchBox:focus{
  outline: none !important;
  box-shadow: none !important;
}

/* hide clear X */
#filterCard #slot-search .clear-inside{
  display:none !important;
}

/* orange circular search button */
#filterCard #slot-search #fetchBtn{
  width: 36px !important;
  height: 36px !important;
  flex: 0 0 36px !important;
  padding: 0 !important;
  border-radius: 999px !important;
  border: 1px solid rgba(255,163,80,0.95) !important;
  background: linear-gradient(135deg,#ffb347,#ff7a18) !important;
  box-shadow: 0 0 18px rgba(255,163,80,0.9) !important;
  display: flex;
  align-items: center;
  justify-content: center;
}
#filterCard #slot-search #fetchBtn img,
#filterCard #slot-search #fetchBtn svg{
  width: 16px;
  height: 16px;
}
#filterCard #slot-search #fetchBtn:hover,
#filterCard #slot-search #fetchBtn:focus{
  border-color: rgba(255,196,130,1) !important;
  box-shadow: 0 0 22px rgba(255,180,100,1) !important;
}

/* Date inputs as full-width violet pills */
#filterCard input[type="date"]{
  width: 100% !important;
  max-width: none !important;
  box-sizing: border-box !important;
  background: radial-gradient(circle at 0% 0%, rgba(124,58,237,0.25), rgba(15,10,30,0.92)) !important;
  border: 1px solid rgba(85, 0, 185, 0.75) !important;
  border-radius: 999px !important;
  padding: 8px 14px !important;
  color: var(--ink) !important;
  box-shadow:0 0 6px rgba(124,58,237,0.25);
}
#filterCard input[type="date"]:focus{
  outline:none !important;
  box-shadow:0 0 18px rgba(124,58,237,0.55) !important;
}

/* Equal vertical spacing between dates row and search block */
#filterCard > .card.pad:first-of-type{
  margin-top: 12px !important;
}


/* spacing between date fields matching search */
#filterCard .row .card.pad {
  margin-bottom: 16px !important;
}

/* gradient header */
#filterHeader{
  background: radial-gradient(circle at 0% 0%, rgba(124,58,237,0.35), rgba(24,18,44,0.95)) !important;
  border: 1px solid rgba(198,138,255,0.4) !important;
  box-shadow:
      inset 0 0 0 1px rgba(255,255,255,0.05),
      0 0 22px rgba(124,58,237,0.45) !important;
}


/* === FIX: Restore and modernize Search Filters chip === */
#filterHeader{
  display:flex !important;
  align-items:center;
  gap:10px;

  background: linear-gradient(
      135deg,
      rgba(65,32,112,0.65) 0%,
      rgba(20,14,38,0.85) 100%
  ) !important;

  border: 1px solid rgba(180,120,255,0.35) !important;
  border-radius: 18px !important;

  padding: 10px 16px !important;
  margin: 6px 0 12px 0 !important;

  box-shadow:
      inset 0 0 0 1px rgba(255,255,255,0.04),
      0 0 26px rgba(120,60,255,0.40) !important;
}

#filterHeader h3{
  margin:0 !important;
  font-size:14px !important;
  font-weight:700 !important;
}


/* === FIX v2: hide legacy title, keep only gradient chip === */
#filterTitle{
  display:none !important;
}

/* override spacing + style for gradient chip */
#filterHeader{
  display:flex !important;
  align-items:center;
  gap:10px;

  background: linear-gradient(
      135deg,
      rgba(65,32,112,0.65) 0%,
      rgba(20,14,38,0.85) 100%
  ) !important;

  border: 1px solid rgba(180,120,255,0.35) !important;
  border-radius: 18px !important;

  padding: 10px 16px !important;
  margin: 2px 0 12px 0 !important;

  box-shadow:
      inset 0 0 0 1px rgba(255,255,255,0.04),
      0 0 26px rgba(120,60,255,0.40) !important;
}


/* === FIX v3: gradient chip on #filterTitle, hide #filterHeader === */
#filterHeader{
  display:none !important;
}

#filterTitle{
  display:flex !important;
  align-items:center;
  gap:10px;

  background: linear-gradient(
      135deg,
      rgba(65,32,112,0.65) 0%,
      rgba(20,14,38,0.9) 100%
  ) !important;

  border: 1px solid rgba(180,120,255,0.35) !important;
  border-radius: 18px !important;

  padding: 10px 16px !important;
  margin: 4px 0 12px 0 !important;

  box-shadow:
      inset 0 0 0 1px rgba(255,255,255,0.04),
      0 0 26px rgba(120,60,255,0.40) !important;

  color:#fff;
}
#filterTitle span{
  font-size:14px !important;
  font-weight:700 !important;
}


/* === FIX v4: gradient on whole filter card, clean title row === */

/* duplicate #filterCard removed */


/* Title row: icon + text, no pill background */
#filterTitle{
  display:flex !important;
  align-items:center;
  gap:8px;
  margin:0 0 10px 0 !important;
  padding:0 !important;
  background:transparent !important;
  border:none !important;
  box-shadow:none !important;
}
#filterTitle span{
  font-size:14px !important;
  font-weight:700 !important;
}

/* Ensure old header chip stays hidden */
#filterHeader{ display:none !important; }


/* === RADIALE SEARCH FILTER LO MODIFICHI DA QUI */
#filterCard{
  background: radial-gradient(
      circle at 0% 0%,
      rgba(83, 63, 189, 0.32) 0%,
      rgba(47, 14, 90, 0.96) 20%,
      rgb(8, 2, 28) 55%,
      rgba(5,3,12,1) 100%
  ) !important;
}

/* Date pills: no extra glow rectangle */
#filterCard input[type="date"]{
  background: #120a24 !important;
  box-shadow: none !important;
}

/* Search pill: softer glow only around the orange button, not the whole row */
#filterCard #slot-search{
  box-shadow: none !important;
}


/* === Filters: compact spacing between Start/End date === */
#filterCard > .row{
  gap:4px !important;
}


/* Make entire date pill clickable */
#slot-fromDate, #slot-toDate{
  cursor: pointer;
}

/* inside date range pill: keep inputs invisibile ma presenti per showPicker */
#dateRangePill #slot-fromDate,
#dateRangePill #slot-toDate{
  position:absolute;
  inset:0;
  opacity:0;
  pointer-events:none;
}

#slot-fromDate input[type="date"],
#slot-toDate input[type="date"]{
  pointer-events: none;
}


.chip-count{
  margin-left: auto;
  padding-left: 10px;
  font-size: 18px;
  font-weight: 600;
  line-height: 1.05;
  letter-spacing: 0;
  font-variant-numeric: tabular-nums;
  display: flex;
  align-items: center;
}


/* === V42 ‚Äî Results card radial background === */
.results-card{
  position:relative;
  overflow:hidden;
  background:rgba(9, 0, 36, 0.74);
  backdrop-filter:blur(27px);
  -webkit-backdrop-filter:blur(24px);
}

.results-card::before{content:none;}



/* === v8.x: align search pill style with date range === */
#filterCard #slot-search{
  display:block !important;
  width:100% !important;
}
#filterCard #slot-search .pill-glow-ring::before{}

/* Search input inside pill: no inner border, transparent bg */
#filterCard #slot-search input[type="text"]{
  width:100% !important;
  padding:12px 16px !important;
  border:none !important;
  background:transparent !important;
  border-radius:999px !important;
}


/* v9.1: force search pill same shell as date range */
#filterCard #slot-search{
  display:block !important;
  width:100% !important;
}
#filterCard #slot-search .search-inline{
  width:100% !important;
}
#filterCard #slot-search input[type="text"]{
  width:100% !important;
  padding:12px 16px !important;
  border:none !important;
  background:transparent !important;
  border-radius:999px !important;
}


/* v9.2 ‚Äî Search ticker pill in sidebar: allineata alla Date range */
#filterCard #slot-search{
  display:block !important;
  width:100% !important;
}
#filterCard #slot-search .search-inline{
  width:100% !important;
  display:flex !important;
  align-items:center !important;
  justify-content:space-between !important;
  gap:10px !important;
}
#filterCard #slot-search input[type="text"]{
  width:100% !important;
  padding:12px 16px !important;
  border:none !important;
  background:transparent !important;
  border-radius:999px !important;
}

/* Icona search: stesso stile della pill Date range */
#filterCard #slot-search #fetchBtn{
  width:30px !important;
  height:30px !important;
  flex:0 0 30px !important;
  padding:0 !important;
  margin-right:10px !important;
  border-radius:999px !important;
  border:none !important;
  background:linear-gradient(135deg,#ff8c00,#ff6700) !important;
  box-shadow:0 0 18px rgba(255,140,0,0.6) !important;
  display:flex;
  align-items:center;
  justify-content:center;
}
#filterCard #slot-search #fetchBtn svg{
  width:16px !important;
  height:16px !important;
}


/* v10 ‚Äî Clean rebuild of Search Ticker pill in sidebar filters */
#filterCard #slot-search{
  display:flex !important;
  align-items:center !important;
  justify-content:space-between !important;
  width:100% !important;
  border-radius:999px;
  padding:0;
}
#filterCard #slot-search .search-inline{
  width:100% !important;
  display:flex !important;
  align-items:center !important;
  justify-content:space-between !important;
  gap:10px !important;
}
#filterCard #slot-search .search-wrap{
  flex:1 1 auto !important;
}
#filterCard #slot-search #searchBox{
  width:100% !important;
  padding:12px 16px !important;
  border:none !important;
  background:transparent !important;
  border-radius:999px !important;
  color:var(--muted);
}
#filterCard #slot-search #fetchBtn{
  width:30px !important;
  height:30px !important;
  flex:0 0 30px !important;
  padding:0 !important;
  margin-right:10px !important;
  border-radius:999px !important;
  border:none !important;
  background:linear-gradient(135deg,#ff8c00,#ff6700) !important;
  box-shadow:0 0 18px rgba(255,140,0,0.6) !important;
  display:flex;
  align-items:center;
  justify-content:center;
}
#filterCard #slot-search #fetchBtn svg{
  width:16px !important;
  height:16px !important;
}

/* v10.1 ‚Äî remove extra light border from inner filter cards (date range, search, funds) */
#filterCard > .card.pad{
  border: 1px solid transparent !important;
  box-shadow: none !important;
  background: transparent !important;
}

  /* === ARK ETF News card === */
  .news-card{
    margin-top: 0;
    margin-bottom: 12px;
    border-radius: 24px;
    background:
      radial-gradient(circle at 0% 0%, rgba(124,58,237,0.30), transparent 55%),
      radial-gradient(circle at 100% 100%, rgba(15,23,42,0.9), rgba(10,6,20,0.98));
    border: 1px solid rgba(148,163,184,0.28);
    box-shadow:
      0 0 0 1px rgba(15,23,42,0.95),
      0 18px 40px rgba(0,0,0,0.85);
    padding: 14px 18px;
  }
  .news-head-icon{
    width:16px; height:16px; margin-right:6px; opacity:.95;
    filter: none;
  }
  .news-item{ border: 1px solid rgba(148,163,184,0.20); background:
      radial-gradient(circle at 0 0, rgba(124,58,237,0.22), transparent 55%),
      rgba(10, 6, 20, 0.92); }
  .news-item-title a{ color:#e9ddff; }
  .news-item-title a:hover{ color:#ffffff; text-decoration:underline; }
  .news-dot{ background: linear-gradient(135deg, #ff9a1f, #ffca38); box-shadow: 0 0 0 1px rgba(0,0,0,.5); }
  .news-thumb{ border:1px solid #5d00bc; background: rgba(12, 11, 20, .9); }

  .news-head{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:8px;
    margin-bottom:6px;
  }
  .news-head svg{
    width:16px;
    height:16px;
    margin-right:6px;
    opacity:.9;
  }
  .news-head span{
    font-size:12px;
    text-transform:uppercase;
    letter-spacing:0.06em;
  }
  .news-head-right{
    font-size:11px;
    opacity:.7;
    text-align:right;
  }
  .news-body{
    margin-top:4px;
  }
  
.news-list{
    list-style:none;
    margin:0;
    padding:0;
    display:flex;
    flex-direction:column;
    gap:8px;
  }
  .news-item{
    position:relative;
    display:flex;
    align-items:flex-start;
    gap:10px;
    font-size:12px;
    padding:10px 12px 9px;
    border-radius:18px;
    background:
      radial-gradient(circle at 0 0, rgba(255,255,255,0.04), transparent 55%),
      rgba(8,7,18,0.96);
    border:1px solid rgba(255,255,255,0.06);
    min-height:88px;
  }

  .news-thumb{
    margin-left:auto;
    width:416px;
    height:193px;
    border-radius:16px;
    overflow:hidden;
    flex-shrink:0;
    background:#2a0095;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .news-thumb img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }

  .news-dot{
    width:6px;
    height:6px;
    border-radius:999px;
    margin-top:5px;
    background:linear-gradient(135deg,#ffb347,#ffcc33);
    box-shadow:0 0 0 1px rgba(0,0,0,0.6);
    flex-shrink:0;
  }
  .news-item-title{
    font-size:27px;
    line-height:1.3;
  }
  .news-item-title a{
    color:#f6e9ff;
    text-decoration:none;
  }
  .news-item-title a:hover{
    text-decoration:underline;
  }
  .news-item-meta{
    font-size:10px;
    color:rgba(255,255,255,0.65);
    margin-top:2px;
  }
  .news-item-summary{
    font-size:19px;
    color:var(--muted);
    margin-top:4px;
    line-height:1.35;
  }
  
@media (max-width: 900px){
    .news-card{
      margin-bottom:8px;
    }
  }

/* === ARK Global Top 10 === */
.ark-top10-card{
  margin-top:16px;
  margin-bottom:14px;
  border-radius:24px;
  background:
    radial-gradient(circle at 0% 0%, rgba(124,58,237,0.35), transparent 55%),
    radial-gradient(circle at 100% 100%, rgba(15,23,42,0.9), rgba(10,6,20,0.98));
  border:1px solid rgb(84, 0, 164),
  padding:14px 16px;
}
.ark-top10-list > li:first-child .ark-top10-mv a,
.ark-top10-list > li:first-child .ark-top10-mv{ color: var(--accent-orange) !important; }


.ark-top10-list > li:first-child .ticker-pill{
  background: var(--accent-orange);
  color: #ffffff;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.18);
}
.ark-top10-list > li:first-child .ark-top10-mv{
  color: var(--accent-orange);
}
.ark-top10-list{
  list-style:none;
  margin:0;
  margin-top:8px;
  padding:0;
  display:flex;
  flex-direction:column;
  gap:6px;
  font-size:12px;
}

.ark-top10-head{
  display:flex;
  align-items:flex-start;
  justify-content:flex-start;
}
.ark-top10-title{
  display:flex;
  flex-direction:column;
  gap:2px;
}
.ark-top10-title-row{
  display:flex;
  align-items:center;
  gap:6px;
}
.ark-top10-icon{
  width:14px;
  height:14px;
  opacity:.9;
  color:#f9fafb;
}
.ark-top10-label{
  font-size:12px;
  font-weight:700;
  letter-spacing:0.08em;
  text-transform:uppercase;
  color:#ffffff;
}
.ark-top10-sub{
  font-size:10px;
  opacity:.7;
  color:rgba(248,250,252,0.85);
}
.ark-top10-item{
  list-style:none;
}
.ark-top10-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
}
.ark-top10-left{
  display:flex;
  align-items:center;
  gap:6px;
  min-width:0;
}
.ark-top10-rank{
  font-size:11px;
  opacity:.7;
  width:18px;
  flex-shrink:0;
}
.ark-top10-name{
  font-size:11px;
  color:var(--muted);
  max-width:120px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.ark-top10-mv{
  font-size:12px;
  font-weight:600;
  font-variant-numeric:tabular-nums;
  margin-left:auto;
}
.ark-top10-card .ticker-pill{
  font-size:11px;
  padding:3px 8px;
  background: rgb(94, 0, 255); /* violet */
  box-shadow: inset 0 0 0 1px rgba(248,250,252,0.06);
  color:#f9f5ff;
}


/* === Full Holdings tab === */
/* === Full Holdings tab === */
.holdings-main .avatar{
  width:56px;
  height:56px;
  min-width:56px;
  border-radius:50%;
  overflow:hidden;
  background:transparent;
  border:none;
  box-shadow:none;
  margin-right:10px;
}

.holdings-card{
  margin-top:12px;
  background:rgba(9, 0, 36, 0.74);
  backdrop-filter:blur(24px);
  -webkit-backdrop-filter:blur(24px);
}

.card.pad.holdings-card{padding:12px 16px 16px 0;}



.holdings-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
  margin-bottom:6px;
  padding:0 8px 0 8px;
}
.holdings-head-left span{
  font-size:12px;
  text-transform:uppercase;
  letter-spacing:0.06em;
}
.holdings-head-icon{
  width:16px;
  height:16px;
  margin-right:6px;
  opacity:.95;
}
.holdings-head-right{
  font-size:11px;
  opacity:.7;
  text-align:right;
}
.holdings-count-sep{
  display:inline-block;
  margin:0 4px;
}




.holdings-row{cursor:pointer;}
.holdings-table-wrap{
  margin-top:8px;
  max-height:none;
  overflow:visible;
}

.holdings-card .num{ text-align:center !important; padding-right:0; }

.holdings-table{
  width:100%;
  margin-left:0;
  border-collapse:collapse;
  font-size:12px;
}

.holdings-table thead th{
  font-size:10px;
  text-transform:uppercase;
  letter-spacing:0.06em;
  opacity:.7;
  padding:4px 6px 6px;
  border-bottom:1px solid rgba(148,163,184,0.35);
}

.holdings-table tbody td{
  padding:6px 6px;
  border-bottom:1px solid rgba(15,23,42,0.9);
  vertical-align:middle;
}
.holdings-table thead th:first-child,
.holdings-table tbody td:first-child{
  padding-left:4px;
}

.holdings-main{
  display:flex;
  align-items:center;
  gap:6px;
}

.holdings-main .ticker-pill{
  font-size:11px;
  padding:3px 8px;
}

.holdings-name{
  font-size:11px;
  color:var(--muted);
  white-space:normal;
  overflow:visible;
  text-overflow:unset;
}

.holdings-table th.holding-col{
  text-align:left;
  padding-left:8px;
  padding-right:0;
}

.holdings-rank{
  width:28px;
}

.holdings-value,
.holdings-shares,
.holdings-weight,
.holdings-last{
  font-variant-numeric:tabular-nums;
  text-align:right;
  font-size:15px;
  font-weight:700;
}

.holdings-weight{
  color:#ffffff;
}

/* ticker pills style inside holdings table */
.holdings-card .ticker-pill{
  background:var(--accent);
  color:#ffffff;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.10);
}

/* first 10 rows highlight like TOP 10 card */
.holdings-table tbody tr:nth-child(-n+10) .ticker-pill{
  background:var(--accent-orange);
  color:#ffffff;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.18);
}

/* stronger value column + neutral weight color */
.holdings-value{
  font-weight:600;
}



/* tighter first column and give more room to holding name */
.holdings-table th:first-child,
.holdings-table td:first-child{
  padding-left:0;
  width:40px;
  text-align:left;
}

/* Last close $ */
.holdings-table th:nth-child(3),
.holdings-table td:nth-child(3){
  width:110px;
}

/* Total value */
.holdings-table th:nth-child(4),
.holdings-table td:nth-child(4){
  width:120px;
}

/* Total shares */
.holdings-table th:nth-child(5),
.holdings-table td:nth-child(5){
  width:140px;
}

/* Weight % */
.holdings-table th:nth-child(6),
.holdings-table td:nth-child(6){
  width:80px;
}

#holdingsStatus{
  font-size:11px;
  margin-top:4px;
}
html[data-view="news"] #resultsCard{
  display:none;
}
html[data-view="news"] #newsCard{
  display:block;
}
html[data-view="news"] #holdingsCard{
  display:none;
}

html[data-view="holdings"] #resultsCard,
html[data-view="holdings"] #newsCard{
  display:none;
}
html[data-view="holdings"] #holdingsCard{
  display:block;
}

html[data-view="home"] #newsCard,
html[data-view="favorites"] #newsCard,
html[data-view="home"] #holdingsCard,
html[data-view="favorites"] #holdingsCard{
  display:none;
}




/* === Holdings detail popup ‚Äî clean v2 (ALL HOLDINGS) === */
#holdingOverlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.78);
  z-index: 52000;
  padding: 20px;
  box-sizing: border-box;
  align-items: center;
  justify-content: center;
}

#holdingOverlay .holding-card {
  max-width: 820px;
  width: 100%;
  border-radius: 26px;
  background:
    radial-gradient(circle at 0% 0%, rgba(76,29,149,0.55), transparent 55%),
    radial-gradient(circle at 100% 120%, rgba(15,23,42,0.95), rgba(10,6,20,0.98));
  border: 1px solid rgba(148,163,184,0.45);
  box-shadow: 0 26px 60px rgba(0,0,0,0.80);
  padding: 20px 22px 18px;
  color: var(--ink);
  display: flex;
  flex-direction: column;
  gap: 14px;
}

/* header */
#holdingOverlay .holding-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  padding-bottom: 12px;
  border-bottom: 1px solid rgba(15,23,42,0.88);
}

#holdingOverlay .holding-main {
  display: flex;
  align-items: center;
  gap: 14px;
  min-width: 0;
}

#holdingOverlay .avatar-focus {
  width: 64px;
  height: 64px;
  min-width: 64px;
  border-radius: 50%;
  overflow: hidden;
  background: #020617;
  border: 1px solid rgba(15,23,42,0.9);
  box-shadow: 0 10px 24px rgba(0,0,0,0.65);
}

#holdingOverlay .avatar-focus .mono {
  font-size: 18px;
  font-weight: 700;
  letter-spacing: .14em;
}

#holdingOverlay .holding-text {
  display: flex;
  flex-direction: column;
  gap: 4px;
  min-width: 0;
}

#holdingOverlay #holdingFocusTicker {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 4px 18px;
  border-radius: 999px;
  border: 1px solid rgba(192,132,252,0.85);
  background: linear-gradient(135deg, #7c3aed, #a855f7);
  font-size: 11px;
  font-weight: 600;
  letter-spacing: .16em;
  align-self: flex-start;
  max-width: max-content;
}

#holdingOverlay #holdingFocusName {
  font-size: 18px;
  font-weight: 700;
  letter-spacing: .04em;
  text-transform: uppercase;
  color: #e5e7eb;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

#holdingOverlay .holding-actions {
  display: flex;
  align-items: center;
  gap: 10px;
}

#holdingOverlay .holding-icon-btn {
  width: 40px;
  height: 40px;
  border-radius: 999px;
  border: none;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  background: linear-gradient(135deg, #241238, #0b0618);
  /* glow rimosso: ombra pi√π corta e neutra */
  box-shadow: 0 4px 10px rgba(0,0,0,0.55);
  transition: transform .08s ease, box-shadow .12s ease, opacity .15s ease;
  color: #fff;
}
#holdingOverlay .holding-icon-btn img {
  width: 18px;
  height: 18px;
  display: block;
}
#holdingOverlay .holding-icon-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 6px 14px rgba(0,0,0,0.65);
}
#holdingOverlay .holding-icon-btn:active {
  transform: translateY(0);
  box-shadow: 0 3px 8px rgba(0,0,0,0.6);
}
#holdingOverlay .holding-icon-btn.close {
  font-size: 18px;
  font-weight: 700;
  line-height: 1;
}


#holdingOverlay .holding-icon-btn.active{
  background: linear-gradient(135deg, #ff8c00, #ff6700);
}
#holdingOverlay .holding-icon-btn.close{
  background: linear-gradient(135deg, #ff8c00, #ff6700);
}

/* body */
#holdingOverlay .holding-body {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

#holdingOverlay .holding-company-info {
  font-size: 12px;
  color: var(--muted);
  max-height: 120px;
  overflow: auto;
}

#holdingOverlay .holding-company-info strong {
  color: #e5e7eb;
}

/* metrics row */
#holdingOverlay .holding-metrics-row {
  display: grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 10px;
}

#holdingOverlay .holding-metric {
  background: radial-gradient(circle at 0% 0%, rgba(15,23,42,0.90), rgba(15,23,42,0.96));
  border-radius: 18px;
  border: 1px solid rgba(31,41,55,0.95);
  box-shadow:
    0 0 0 1px rgba(148,163,184,0.25),
    0 12px 28px rgba(0,0,0,0.75);
  padding: 10px 14px;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  justify-content: center;
  gap: 4px;
}

#holdingOverlay .holding-metric-label {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: .18em;
  color: rgba(148,163,184,0.85);
}

#holdingOverlay .holding-metric-value {
  font-size: 18px;
  font-weight: 700;
  color: #f9fafb;
}

/* weight emphasis */
#holdingOverlay #holdingMetricWeight.heat-low {
  color: #facc15;
}
#holdingOverlay #holdingMetricWeight.heat-mid {
  color: #fb923c;
}
#holdingOverlay #holdingMetricWeight.heat-high {
  color: #ef4444;
}

/* make holdings rows obviously clickable */
.holdings-row {
  cursor: pointer;
}

@media (max-width: 720px) {
  #holdingOverlay .holding-card {
    padding: 16px 14px 14px;
    border-radius: 22px;
  }
  #holdingOverlay .holding-header {
    align-items: flex-start;
  }
  #holdingOverlay .holding-metrics-row {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
}



/* === Trades detail overlay (results popup) ‚Äî clean v2 === */
#overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.78);
  z-index: 50000;
  padding: 20px;
  box-sizing: border-box;
  align-items: center;
  justify-content: center;
}

#overlay .panel {
  max-width: 820px;
  width: 100%;
  border-radius: 26px;
  background:
    radial-gradient(circle at 0% 0%, rgba(76,29,149,0.5), transparent 55%),
    radial-gradient(circle at 100% 120%, rgba(15,23,42,0.95), rgba(10,6,20,0.98));
  border: 1px solid rgba(148,163,184,0.45);
  box-shadow: 0 26px 60px rgba(0,0,0,0.85);
  color: var(--ink);
  display: flex;
  flex-direction: column;
  gap: 10px;
}

#overlay .hdr {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  padding: 10px 18px 10px 18px;
  border-bottom: 1px solid rgba(15,23,42,0.90);
}

#overlay .body {
  padding: 6px 18px 12px 18px;
}

/* Title area (avatar + chip + company) reuse existing .td-name styles, just space properly */
#overlay #focusTitle .td-name {
  display: flex;
  align-items: center;
  gap: 10px;
}

/* Buttons in trades overlay: match holdings popup orange icon buttons */
#overlay .hdr .overlay-actions{
  display:flex;
  align-items:center;
  gap:10px;
}
#overlay .overlay-icon-btn{
  width:40px;
  height:40px;
  border-radius:999px;
  border:none;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  background:linear-gradient(135deg,#241238,#0b0618);
  box-shadow:0 4px 10px rgba(0,0,0,0.55);
  transition:transform .08s ease, box-shadow .12s ease, opacity .15s ease;
  color:#fff;
}
#overlay .overlay-icon-btn img{
  width:18px;
  height:18px;
  display:block;
}
#overlay .overlay-icon-btn:hover{
  transform:translateY(-1px);
  box-shadow:0 6px 14px rgba(0,0,0,0.65);
}
#overlay .overlay-icon-btn:active{
  transform:translateY(0);
  box-shadow:0 3px 8px rgba(0,0,0,0.6);
}
#overlay .overlay-icon-btn.close{
  font-size:18px;
  font-weight:700;
  line-height:1;
}


#overlay .overlay-icon-btn.on,
#overlay .overlay-icon-btn.close{
  background: linear-gradient(135deg,#ff8c00,#ff6700);
}


/* Results popup header: avatar + ticker pill + name stacked like holdings */
#overlay .focus-main{
  display:flex;
  align-items:center;
  gap:14px;
  min-width:0;
}
#overlay .avatar-focus{
  width:64px;
  height:64px;
  min-width:64px;
  border-radius:50%;
  overflow:hidden;
  background:#020617;
  border:1px solid rgba(15,23,42,0.9);
  box-shadow:0 10px 24px rgba(0,0,0,0.65);
}
#overlay .avatar-focus .mono{
  font-size:18px;
  font-weight:700;
  letter-spacing:.14em;
}
#overlay .focus-text{
  display:flex;
  flex-direction:column;
  gap:4px;
  min-width:0;
}
#overlay .focus-ticker-pill{
  padding:4px 18px;
  border-radius:999px;
  border:1px solid rgba(192,132,252,0.85);
  font-size:11px;
  font-weight:600;
  letter-spacing:.16em;
  align-self:flex-start;
  max-width:max-content;
}
#overlay .focus-name{
  font-size:18px;
  font-weight:700;
  letter-spacing:.04em;
  text-transform:uppercase;
  color:#e5e7eb;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
/* Table inside overlay */

#overlay table th{
  text-align:left;
}
#overlay table td{
  text-align:left;
}
#overlay table th.num,
#overlay table td.num{
  text-align:right;
}
#overlay table {
  width: 100%;
  border-collapse: collapse;
}

#overlay table thead {
  background: linear-gradient(180deg, rgba(124,58,237,.10), rgba(124,58,237,.03));
  border-bottom: 1px solid var(--line);
}

#overlay table th,
#overlay table td {
  padding: 8px 10px;
  border-top: 1px solid var(--line);
}

#overlay table th.num,
#overlay table td.num {
  text-align: right;
}



  /* --- News layout fix override --- */
  .news-item{
    display:flex;
    align-items:flex-start;
  }
  .news-item .news-thumb{
    margin:0;
    margin-right:12px;
    flex-shrink:0;
  }
  .news-item .news-text{
    flex:1;
    min-width:0;
  }
</style>
<link crossorigin="True" href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
<style id="news-more-style">
.news-more-wrap{display:flex;justify-content:center;margin-top:12px}
.news-more-btn{
  appearance:none;border:1px solid rgba(148,163,184,.35);
  border-radius:999px;padding:8px 14px;font-size:12px;
  background:radial-gradient(120% 120% at 0% 0%, rgba(124,58,237,.35) 0%, rgba(19,17,28,.95) 42%);
  color:#fff;cursor:pointer;box-shadow:0 8px 24px rgba(0,0,0,.45), inset 0 0 12px rgba(124,58,237,.25);
}
.news-more-btn:hover{box-shadow:0 10px 28px rgba(0,0,0,.55), inset 0 0 14px rgba(124,58,237,.35)}
</style>

</head>
<body>
<div class="app-shell">
  <aside class="sidebar">
    <div class="sidebar-header">
      <div>
        <div class="sidebar-title">Lemon Trades</div>
        <div class="sidebar-subtitle">ARK Dashboard</div>
      </div>

    </div>
    <nav class="sidebar-nav">
  <button class="nav-item active pill-glow-ring" data-view-target="home">
    <span class="nav-icon">
      <img src="icons/Overview.svg" alt="Overview">
    </span>
    <span class="nav-label">Overview</span>
  </button>

  <button class="nav-item pill-glow-ring" data-view-target="favorites">
    <span class="nav-icon">
      <img src="icons/Favorites.svg" alt="Favorites">
    </span>
    <span class="nav-label">Saved Tickers</span>
  </button>

  <button class="nav-item pill-glow-ring" data-view-target="news">
    <span class="nav-icon">
      <img src="icons/News.svg" alt="News">
    </span>
    <span class="nav-label">News</span>
  </button>

  <button class="nav-item pill-glow-ring" data-view-target="holdings">
    <span class="nav-icon">
      <img src="icons/Holdings.svg" alt="Holdings">
    </span>
    <span class="nav-label">Holdings</span>
  </button>
</nav>



    <div class="sidebar-chips">
  <div class="sidebar-chips-label">Trade type</div>

  <button class="type-chip active pill-glow-ring" data-type-chip="ALL">
    <span class="chip-icon">
      <img src="icons/total_bars.svg" alt="All"/>
    </span>
    <span class="chip-text">
      <span class="chip-title">All operations</span>
      <span class="chip-sub">All ARK trades</span>
    </span>
    <span class="chip-count chip-total" id="statTotalN">0</span>
  </button>

  <button class="type-chip pill-glow-ring" data-type-chip="BUY">
    <span class="chip-icon">
      <img src="icons/buy_stairs.svg" alt="Buys"/>
    </span>
    <span class="chip-text">
      <span class="chip-title">Buys only</span>
      <span class="chip-sub">Accumulation / entries</span>
    </span>
    <span class="chip-count chip-buy" id="statBuyN">0</span>
  </button>

  <button class="type-chip pill-glow-ring" data-type-chip="SELL">
    <span class="chip-icon">
      <img src="icons/sell_stairs.svg" alt="Sells"/>
    </span>
    <span class="chip-text">
      <span class="chip-title">Sells only</span>
      <span class="chip-sub">Trims / exits</span>
    </span>
    <span class="chip-count chip-sell" id="statSellN">0</span>
  </button>
</div>

    <div id="sidebarFiltersMount"></div>
<section class="card pad ark-top10-card" id="arkTop10Card">
  <div class="ark-top10-head">
    <div class="ark-top10-title">
      <div class="ark-top10-title-row">
        <span class="ark-top10-label">TOP 10 HOLDINGS</span>
      </div>
      <div class="ark-top10-sub" id="arkTop10Updated"></div>
    </div>
  </div>
  <div id="arkTop10Status" class="muted">Loading ARK aggregated holdings‚Ä¶</div>
  <ul id="arkTop10List" class="ark-top10-list"></ul>
</section>

  

    
    <div class="sidebar-logo-img">
      <img src="icons/Lemon.svg" alt="Lemon Trades Logo">
    </div>
<div class="sidebar-footer">
<div class="sidebar-source-note">
  <p class="note">
  Source: Unofficial API
  <a href="https://status.arkfunds.io/status/arkfunds"
     target="_blank"
     rel="noopener"
     class="api-status-btn">
    arkfunds.io ‚Üó
  </a>
</p>
</div>

      
    </div>
  </aside>
  <main class="main-area">
    <div class="container">
<div class="row" style="justify-content:space-between;gap:12px">



  
</div>
<section class="controls grid fit-240" style="display:none!important">
<div class="card pad date-card pill-glow-ring">
<label>From</label>
<input id="fromDate" type="date"/>
</div>
<div class="card pad date-card pill-glow-ring">
<label>To</label>
<input id="toDate" type="date"/>
</div>
<div class="card pad search-card">
<label>Search (ticker or fund)</label><div class="search-inline"><div class="search-wrap"><input id="searchBox" placeholder="e.g. NVDA" type="text"/><button class="btn icon clear-inside" id="clearBtn" title="Clear Search" aria-label="Clear Search"><svg viewBox="0 0 24 24" width="14" height="14" aria-hidden="true"><path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></button></div><button class="btn primary btn-glow-ring" id="fetchBtn" title="Search / Enter">
    <img src="icons/Enter.svg" width="18" height="18" />
</button><button class="btn" id="csvBtn" title="Export CSV" aria-label="Export CSV"><svg viewBox="0 0 24 24" aria-hidden="true" style="width:16px;height:16px;margin-right:6px"><path d="M6 2h9l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm8 1.5V8h4.5"/></svg><strong>Export CSV</strong></button><button class="btn" id="clearBtn" title="Clear Search" aria-label="Clear Search"><svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true"><path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></button></div><div class="card pad" id="suggestions" style="position:absolute;z-index:1000;display:none;max-height:240px;overflow:auto;font-size:13px;pointer-events:auto"></div>

</div>
</section>

<section class="stats-funds-grid" style="margin-top:12px;margin-bottom:12px">
<div class="card pad stat">
<div class="label">Transactions displayed</div>
<div class="value" id="countBox">0</div>
</div>
<div class="card pad stat">
<div class="label">Funds selected</div>
<div class="value" id="fundCount">0</div>
</div>
<div class="card pad">
<div class="row" style="gap:8px;align-items:center;justify-content:space-between;flex-wrap:nowrap">
<div class="row" style="gap:8px;flex:1 1 auto;overflow-x:auto;white-space:nowrap">
<span class="muted">Funds:</span>
<div class="chips" id="fundsChips"></div>
</div>
<label><input id="onlyMine" type="checkbox"/> Only my tickers</label>
</div>
</div>
</section>


<!-- Full-width results table -->


<section id="layoutTwoCol" class="grid" style="grid-template-columns: 320px 1fr; gap:16px; align-items:start; margin-top:12px;">
  <div id="filterCard" class="card pad">
  <div id="filterTitle">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M3 5h18l-7 8v5l-4 2v-7L3 5z"/>
    </svg>
    <span>Search Filters</span>
  </div>

    <div id="filterHeader" class="row" style="align-items:center;gap:10px;margin-bottom:10px">
      <div class="icon" style="opacity:.85"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 5h18l-7 8v5l-4 2v-7L3 5z" stroke="currentColor" fill="none" stroke-width="2"/></svg></div>
      <h3 style="margin:0">Search Filters</h3>
    </div>
    <div class="card pad" style="margin-top:8px">
      <div id="dateRangePill" class="pill-glow-ring">
        <div class="date-range-pill">
          <div class="date-range-text">
            <div class="date-range-caption">Range</div>
            <div id="dateRangeValue" class="date-range-value">Last 2 days</div>
          </div>
          <div class="date-range-pill-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <rect x="3" y="5" width="18" height="16" rx="3" ry="3"></rect>
              <path d="M8 3v4"></path>
              <path d="M16 3v4"></path>
              <path d="M3 11h18"></path>
            </svg>
          </div>
        </div>
        <!-- hidden slots for the real date inputs -->
        <div id="slot-fromDate"></div>
        <div id="slot-toDate"></div>
      </div>
    </div>
    <div class="card pad" style="margin-top:12px">
      <div id="slot-search" class="pill-glow-ring"></div>
    </div>
    <div class="card pad" style="margin-top:12px">
      <label>ARK Funds</label>
      <div id="slot-fundsChips"></div>
      
    </div>
    <div class="card pad" style="display:none" style="margin-top:12px">
      <label>Trade Type</label>
      <select id="typeFilterLeft" class="pill-select">
        <option value="ALL" selected>All (Buy + Sell)</option>
        <option value="BUY">Buys only</option>
        <option value="SELL">Sells only</option>
      </select>
    </div>
    <div class="row" style="gap:10px;margin-top:12px">
      <div id="slot-fetchBtn"></div>
      <div id="slot-csvBtn"></div>
    </div>
  </div>

  <div id="resultsSlot">


</div>
</section>

<section class="card pad results-card" id="resultsCard">
<div class="results-head">
  <div class="results-left">
    <div class="muted" style="display:inline-flex;align-items:center"><svg viewBox="0 0 24 24" aria-hidden="true" style="width:16px;height:16px;margin-right:6px;opacity:.85"><path d="M3 5h18v2H3zm0 6h18v2H3zm0 6h12v2H3z"/></svg><span>Results</span></div>
  </div>

  <div class="results-center">
    <!-- Trade select removed per UX: controlled by stat-cards -->
    <select id="typeFilter" class="pill-select" style="display:none">
      <option value="ALL" selected>All (Buy + Sell)</option>
      <option value="BUY">Buys only</option>
      <option value="SELL">Sells only</option>
    </select>

    <div class="pager-chip">
      <button class="btn pager-btn pager-arrow pager-prev" id="prevPage" title="Previous page">
        <img src="icons/arrow.svg" alt="" class="pager-icon" />
      </button>
      <div class="pager-label">
        <span class="pager-text">PAGE</span>
        <span id="pageInfo" class="pager-numbers">‚óè</span>
      </div>
      <button class="btn pager-btn pager-arrow pager-next" id="nextPage" title="Next page">
        <img src="icons/arrow.svg" alt="" class="pager-icon" />
      </button>
    </div>
  </div>

  <div class="results-right">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6 4h12a1 1 0 0 1 1 1v15l-7-4-7 4V5a1 1 0 0 1 1-1z"/></svg>
    </button>
  </div>
</div><div class="muted" id="status" style="display:none">Ready.</div>
<div style="margin-top:12px;overflow:auto;">
<table id="table">
<colgroup>
<col style="width:48px"/>
<col style="width:39px"/>
<col style="width:300px"/>
<col style="width:112px"/>
</colgroup>
<thead>
<tr>
<th>Date</th>
<th>Fund</th>
<th>Ticker / Name</th>
<th class="num">Shares | %</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
  <div class="results-foot inside">
    <div class="results-center">
      <div class="pager-chip pager-chip-bottom">
        <button class="btn pager-btn pager-arrow pager-prev" id="prevPageBottom" title="Previous page">
          <img src="icons/arrow.svg" alt="" class="pager-icon" />
        </button>
        <div class="pager-label">
          <span class="pager-text">PAGE</span>
          <span id="pageInfoBottom" class="pager-numbers">‚óè</span>
        </div>
        <button class="btn pager-btn pager-arrow pager-next" id="nextPageBottom" title="Next page">
          <img src="icons/arrow.svg" alt="" class="pager-icon" />
        </button>
      </div>
    </div>
  </div>
</div>
</section>


<section class="card pad news-card" id="newsCard">
    <div class="news-head">
      <div class="news-head-left muted" style="display:inline-flex;align-items:center">
        <img src="icons/News.svg" alt="News" class="news-head-icon"/>
        <span>ARK ETF news</span>
      </div>
      <div class="news-head-right muted" id="newsUpdated"></div>
    </div>
    <div class="news-body" id="newsBody">
      <div class="muted" id="newsStatus">Loading latest headlines‚Ä¶</div>
      <ul class="news-list" id="newsList"></ul>
    </div>
  </section>


<section class="card pad holdings-card" id="holdingsCard">
  <div class="holdings-head">
    <div class="holdings-head-left muted" style="display:inline-flex;align-items:center">
      <img src="icons/Holdings.svg" alt="Holdings" class="holdings-head-icon"/>
      <span>ALL HOLDINGS</span>
    </div>
    <div class="holdings-head-right muted">
      <span id="holdingsUpdated"></span>
      <span class="holdings-count-sep">‚Ä¢</span>
      <span><span id="holdingsCount">0</span> tickers</span>
    </div>
  </div>

  <div class="muted" id="holdingsStatus">Loading aggregated holdings‚Ä¶</div>

  <div class="holdings-table-wrap">
    <table class="holdings-table">
      <thead>
        <tr>
          <th class="num">#</th>
          <th class="holding-col">Holding</th>
          <th class="num">Last close $</th>
          <th class="num">Total value</th>
          <th class="num">Total shares</th>
          <th class="num">Weight %</th>
        </tr>
      </thead>
      <tbody id="holdingsBody"></tbody>
    </table>
  </div>
</section>


</div>
  </main>
</div>


<div class="overlay" id="holdingOverlay">
  <div class="holding-card">
    <div class="holding-header">
      <div class="holding-main">
        <span class="avatar avatar-focus" id="holdingFocusAvatar" data-ticker="">
          <span class="mono"></span>
        </span>
        <div class="holding-text">
          <span id="holdingFocusTicker">TSLA</span>
          <div id="holdingFocusName">TESLA INC</div>
        </div>
      </div>
      <div class="holding-actions">
        <button class="holding-icon-btn close" id="holdingCloseBtn" title="Close">√ó</button>
      </div>
    </div>
    <div class="holding-body">
      <div class="holding-company-info" id="holdingCompanyInfo">
        Loading company info...
      </div>
      <div class="holding-metrics-row">
        <div class="holding-metric">
          <div class="holding-metric-label">LAST CLOSE</div>
          <div class="holding-metric-value" id="holdingMetricLast">‚Äî</div>
        </div>
        <div class="holding-metric">
          <div class="holding-metric-label">TOTAL VALUE</div>
          <div class="holding-metric-value" id="holdingMetricValue">‚Äî</div>
        </div>
        <div class="holding-metric">
          <div class="holding-metric-label">TOTAL SHARES</div>
          <div class="holding-metric-value" id="holdingMetricShares">‚Äî</div>
        </div>
        <div class="holding-metric">
          <div class="holding-metric-label">WEIGHT %</div>
          <div class="holding-metric-value" id="holdingMetricWeight">‚Äî</div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="overlay" id="overlay">
<div class="panel">
<div class="hdr">
  <div id="focusTitle" style="font-weight:700">Ticker</div>
  <div class="overlay-actions">
    <button class="overlay-icon-btn" id="followBtn" title="Save / unsave">
      <img src="icons/Favorites.svg" alt="Favorite"/>
    </button>
    <button class="overlay-icon-btn close" id="closeOverlay" title="Close">√ó</button>
  </div>
</div>
<div class="body">
<div class="muted" id="focusInfo" style="margin-bottom:8px"></div>
<div style="overflow:auto">
<table>
<colgroup>
<col style="width:100px"/>
<col style="width:80px"/>
<col style="width:130px"/>
</colgroup>
<thead><tr>
<th style="width:120px">Date</th>
<th style="width:90px">Fund</th>
<th class="num" style="width:140px">Shares | %</th>
</tr></thead>
<tbody id="focusBody"></tbody>
</table>
</div>
</div>
</div>
</div>
<script>
(function(){
  const FUNDS = ["ARKK","ARKG","ARKQ","ARKF","ARKX","ARKW"];
  function escapeHTML(str){
    return String(str ?? '').replace(/[&<>"']/g, s => ({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'
    }[s] || s));
  }

  async function fetchStockProfile(symbol){
    try{
      const u = new URL('https://arkfunds.io/api/v2/stock/profile');
      u.searchParams.set('symbol', symbol);
      const res = await fetch(u.toString());
      if(!res.ok) throw new Error('HTTP ' + res.status);
      const data = await res.json();
      return data && data.profile ? data.profile : null;
    }catch(e){
      console.error('stock/profile failed', e);
      return null;
    }
  }

  function renderCompanyInfo(info){
    if(!info) return '<div class="company-meta">No company profile available.</div>';
    const name   = info.company || info.name || info.security_name || '';
    const sector = info.sector || '';
    const industry = info.industry || '';
    const desc   = info.description || info.business_summary || '';
    const website = info.website || info.homepage || '';

    const parts = [];
    if(sector || industry){
      parts.push('<div class="company-meta">' + escapeHTML([sector, industry].filter(Boolean).join(' ‚Ä¢ ')) + '</div>');
    }
    if(desc){
      parts.push('<div class="company-desc">' + escapeHTML(desc) + '</div>');
    }
    if(website){
      const url = escapeHTML(website);
      parts.push('<div class="company-link"><a href="' + url + '" target="_blank" rel="noopener">Website</a></div>');
    }
    if(!parts.length){
      parts.push('<div class="company-meta">No extra company details available from API.</div>');
    }
    return parts.join('');
  }

  function getMyTickers(){try{return JSON.parse(localStorage.getItem("MY_TICKERS")||"[]");}catch(e){return []}}
function setMyTickers(arr){localStorage.setItem("MY_TICKERS",JSON.stringify(arr))}


const NAME_MAP = {
  "TXG":"10x Genomics, Inc.",
  "HO":"Thales",
  "2618":"JD Logistics Inc.",
  "4689":"LY Corp. (Yahoo Japan Corp.)",
  "6301":"Komatsu Ltd.",
  "AACT":"Ares Acquisition Corporation II",
  "ABNB":"Airbnb, Inc.",
  "ABSI":"Absci Corporation",
  "ACHR":"Archer Aviation Inc.",
  "ADPT":"Adaptive Biotechnologies Corp.",
  "AMD":"Advanced Micro Devices",
  "AMGN":"Amgen Inc.",
  "AMZN":"Amazon.com, Inc.",
  "ANSS":"Ansys Inc.",
  "ARCT":"Arcturus Therapeutics Holdings, Inc.",
  "ARKB":"ARK 21Shares Bitcoin ETF",
  "ATAI":"Atai Life Sciences, Inc.",
  "AUR":"Aurora Innovation, Inc.",
  "AVAV":"AeroVironment, Inc.",
  "AVDX":"AvidXchange Holdings Inc.",
  "BABA":"Alibaba Group Holding",
  "BBAI":"BigBear.ai Holdings, Inc.",
  "BEAM":"Beam Therapeutics, Inc.",
  "BIDU":"Baidu Inc.",
  "BILL":"Bill Holdings, Inc.",
  "BLDE":"Blade Air Mobility, Inc.",
  "BLSH":"Bullish Holdings, Inc.",
  "BMNR":"Bitmine Immersion Technologies",
  "BREA":"Brea Holdings PLC",
  "BWXT":"BWX Technologies Inc.",
  "BYDDY":"BYD Company Limited",
  "CAI":"Caris Life Sciences Inc",
  "CAT":"Caterpillar Inc.",
  "CCJ":"Cameco Corporation",
  "CDNA":"CareDx, Inc.",
  "CMPS":"COMPASS Pathways plc",
  "COIN":"Coinbase Global, Inc.",
  "CRCL":"Circle Internet Group Inc.",
  "CRM":"Salesforce.com",
  "CRISPR":"CRISPR Therapeutics",
  "CRSP":"CRISPR Therapeutics",
  "CRWD":"CrowdStrike Holdings, Inc.",
  "CRWV":"CoreWeave Inc",
  "DDD":"3D Systems Corporation",
  "DASH":"DoorDash, Inc.",
  "DDOG":"Datadog, Inc.",
  "DE":"Deere & Company",
  "DKNG":"DraftKings Inc.",
  "DSY":"Dassault Syst√®mes SE",
  "ENI":"Eni SpA",
  "ESLT":"Elbit Systems Ltd.",
  "ETOR":"eToro Group Ltd.",
  "ETHQ.U":"Etho Capital Quantum ETF (Unit)",
  "EXAS":"Exact Sciences Corporation",
  "FIG":"Figma Inc.",
  "FUTU":"Futu Holdings Limited",
  "GENI":"Genius Sports Limited",
  "GH":"Guardant Health, Inc.",
  "GOOG":"Alphabet Inc. (Class C)",
  "GOOGL":"Alphabet Inc. (Class A)",
  "GRMN":"Garmin",
  "GTLB":"GitLab Inc.",
  "HIVE":"Hive Digital Technologies",
  "HON":"Honeywell International Inc.",
  "HOOD":"Robinhood Markets, Inc.",
  "IBTA":"Ibotta, Inc.",
  "ILMN":"Illumina, Inc.",
  "INTC":"Intel Corporation",
  "INTU":"Intuit Inc.",
  "IONIS":"Ionis Pharmaceuticals, Inc.",
  "IONS":"Ionis Pharmaceuticals Inc.",
  "IRDM":"Iridium Communications Inc.",
  "ISRG":"Intuitive Surgical Inc.",
  "ISP":"Intesa Sanpaolo",
  "JOBY":"Joby Aviation, Inc.",
  "KDK":"Kodiak AI, Inc.",
  "KIND":"Nextdoor Holdings Inc.",
  "KLAR":"Klarna",
  "KMTUY":"Komatsu Ltd. (ADR)",
  "KSPI":"Kaspien Holdings Inc.",
  "KTOS":"Kratos Defense & Security",
  "LHX":"L3Harris Technologies",
  "LMT":"Lockheed Martin Corporation",
  "LUNR":"Intuitive Machines, Inc.",
  "MASS":"908 Devices, Inc.",
  "MELI":"MercadoLibre Inc.",
  "META":"Meta Platforms",
  "MGA":"Magna International Inc.",
  "MSFT":"Microsoft Corporation",
  "NFLX":"Netflix, Inc.",
  "NET":"Cloudflare, Inc.",
  "NRIX":"Nurix Therapeutics, Inc.",
  "NTLA":"Intellia Therapeutics",
  "NTRA":"Natera, Inc.",
  "NU":"Nu Holdings Ltd.",
  "NVDA":"NVIDIA Corporation",
  "OKLO":"Oklo Inc.",
  "ORCL":"Oracle Corporation",
  "PACB":"Pacific Biosciences of California, Inc.",
  "PATH":"UiPath Inc.",
  "PD":"PagerDuty, Inc.",
  "PINS":"Pinterest, Inc.",
  "PLTR":"Palantir Technologies Inc.",
  "PLUG":"Plug Power Inc.",
  "PONY":"Pony.ai, Inc.",
  "PRME":"Prime Medicine, Inc.",
  "PRNT":"ARK 3D Printing ETF (PRNT)",
  "PSNL":"Personalis, Inc.",
  "PSTG":"Pure Storage Inc.",
  "PYPL":"PayPal Holdings, Inc.",
  "QCOM":"Qualcomm Incorporated",
  "QSI":"Quantum-Si Incorporated",
  "REGN":"Regeneron Pharmaceuticals",
  "RBLX":"Roblox Corporation",
  "RBRK":"Rubrik, Inc.",
  "RDDT":"Reddit, Inc.",
  "REKR":"Rekor Systems Inc.",
  "RKLB":"Rocket Lab USA, Inc.",
  "ROKU":"Roku Inc.",
  "RPTX":"Repare Therapeutics Inc.",
  "RXRX":"Recursion Pharmaceuticals, Inc.",
  "SDGR":"Schr√∂dinger, Inc.",
  "SHOP":"Shopify Inc.",
  "SLMT":"Brea Holdings PLC",
  "SOFI":"SoFi Technologies, Inc.",
  "SOLQ.U":"Solidion Technology Inc. (Unit)",
  "SOLS":"Solstice Advanced Materials Inc",
  "SNPS":"Synopsys Inc.",
  "SPOT":"Spotify Technology S.A.",
  "SYM":"Symbotic Inc.",
  "TDY":"Teledyne Technologies Inc.",
  "TEM":"Tempus AI Inc.",
  "TER":"Teradyne, Inc.",
  "TOST":"Toast, Inc.",
  "TRMB":"Trimble Inc.",
  "TSLA":"Tesla Inc.",
  "TSM":"Taiwan Semiconductor Manufacturing Co. Ltd.",
  "TTD":"The Trade Desk, Inc.",
  "TWST":"Twist Bioscience Corporation",
  "U":"Unity Software Inc.",
  "UNH":"UnitedHealth Group",
  "VCYT":"Veracyte Inc.",
  "VEEV":"Veeva Systems Inc.",
  "VRTX":"Vertex Pharmaceuticals Inc.",
  "WGS":"GeneDx Holdings Corp",
  "WRD":"WeRide Inc.",
  "XYZ":"XYZ Reality Ltd.",
  "Z":"Zillow Group, Inc."
};

  // Theme
  /* Tema fisso dark: rimosso toggle */

  // DOM refs
  const fromDate = document.getElementById('fromDate');
  const toDate = document.getElementById('toDate');
  const searchBox = document.getElementById('searchBox');
  const fetchBtn = document.getElementById('fetchBtn');
  const csvBtn = document.getElementById('csvBtn');
  const fundsChips = document.getElementById('fundsChips');
  const onlyMine = document.getElementById('onlyMine');
  const status = document.getElementById('status');
  const tbody = document.getElementById('tbody');
  const countBox = document.getElementById('countBox');
  const fundCount = document.getElementById('fundCount');
  const overlay = document.getElementById('overlay');
  const closeOverlay = document.getElementById('closeOverlay');
  const followBtn = document.getElementById('followBtn');
  const holdingOverlay      = document.getElementById('holdingOverlay');
  const holdingCloseBtn     = document.getElementById('holdingCloseBtn');
  const holdingFavBtn       = null;
  const holdingFocusName    = document.getElementById('holdingFocusName');
  const holdingFocusTicker  = document.getElementById('holdingFocusTicker');
  const holdingFocusAvatar  = document.getElementById('holdingFocusAvatar');
  const holdingCompanyInfo  = document.getElementById('holdingCompanyInfo');
  const holdingMetricLast   = document.getElementById('holdingMetricLast');
  const holdingMetricValue  = document.getElementById('holdingMetricValue');
  const holdingMetricShares = document.getElementById('holdingMetricShares');
  const holdingMetricWeight = document.getElementById('holdingMetricWeight');
  const holdingHeat         = document.getElementById('holdingHeat');
  let focusTicker = '';
  let holdingOverlayTicker  = '';
try{ refreshFollowBtn(); }catch(e){}
 // --- Google Finance: exchange mapping (corretto al 23 Oct 2025) ---
const EXCHANGE_MAP = {
  // NASDAQ
  "ABNB":"NASDAQ","ABSI":"NASDAQ","ACHR":"NASDAQ","ADPT":"NASDAQ","AMGN":"NASDAQ",
  "AMD":"NASDAQ","AMZN":"NASDAQ","CMPS":"NASDAQ","CDNA":"NASDAQ","COIN":"NASDAQ",
  "CRSP":"NASDAQ","DDOG":"NASDAQ","EXAS":"NASDAQ","GOOG":"NASDAQ","GOOGL":"NASDAQ",
  "HIVE":"NASDAQ","ILMN":"NASDAQ","INTC":"NASDAQ","IONS":"NASDAQ","IRDM":"NASDAQ",
  "ISRG":"NASDAQ","MASS":"NASDAQ","META":"NASDAQ","MSFT":"NASDAQ","NFLX":"NASDAQ",
  "NVDA":"NASDAQ","PACB":"NASDAQ","PLTR":"NASDAQ",   // dal 26 Nov 2024 √® su Nasdaq
  "PLUG":"NASDAQ","QCOM":"NASDAQ","QSI":"NASDAQ","RKLB":"NASDAQ","REKR":"NASDAQ",
  "SNPS":"NASDAQ","SYM":"NASDAQ","TRMB":"NASDAQ","TSLA":"NASDAQ","TTD":"NASDAQ",
  "TXG":"NASDAQ","U":"NYSE",   // Unity √® NYSE (vedi sotto, lasciato qui come memo)
  "VCYT":"NASDAQ","VRTX":"NASDAQ","SOLS":"NASDAQ",

  // NYSE
  "ARCT":"NASDAQ","AVAV":"NYSE","AVDX":"NASDAQ", // AvidXchange √® NASDAQ
  "BABA":"NYSE","BLDE":"NYSE","BWXT":"NYSE","CCJ":"NYSE","DE":"NYSE",
  "DASH":"NASDAQ","ENI":"NYSE","GENI":"NYSE","HON":"NASDAQ","JOBY":"NYSE",
  "KIND":"NYSE","LHX":"NYSE","MELI":"NASDAQ", // MELI √® NASDAQ (memo)
  "OKLO":"NYSE","ORCL":"NYSE","PATH":"NYSE","PD":"NYSE","PINS":"NYSE",
  "PSTG":"NYSE","RBLX":"NYSE","RBRK":"NYSE","ROKU":"NASDAQ",
  "SHOP":"NASDAQ",   // trasferita da NYSE a NASDAQ (Mar 2025)
  "TDY":"NYSE","UNH":"NYSE","VEEV":"NYSE","CRM":"NYSE","BILL":"NYSE",

  // ETF / altri USA
  "ARKB":"BATS",     // Cboe BZX (Google Finance usa ‚ÄúBATS‚Äù)
  "ARKB.US":"BATS",

 // --- ADR / OTC US (Google Finance usa "OTCMKTS")
"BYDDY":"OTCMKTS",
"KMTUY":"OTCMKTS",
"BMNR":"OTCMKTS",

// --- Estero (codici Google Finance)
"2618":"HKG",   // JD Logistics (Hong Kong)
"6301":"TYO",   // Komatsu (Tokyo)
"4689":"TYO",   // LY / Yahoo Japan (Tokyo)
"HO":"EPA",     // Thales (Euronext Paris)

// --- Italia (se vuoi la nativa di Borsa Italiana per ISP)
"ISP":"BIT",

  // NB: per ticker non mappati resta il fallback alla ricerca GF
};

  function googleFinanceURL(ticker){
    if(!ticker) return 'https://www.google.com/finance';
    const sym = String(ticker).trim().toUpperCase();
    const ex  = EXCHANGE_MAP[sym];
    if (ex){ return `https://www.google.com/finance/quote/${encodeURIComponent(sym)}:${encodeURIComponent(ex)}`; }
    // Default to NASDAQ if unknown
    return `https://www.google.com/finance?q=${encodeURIComponent(sym)}`;
  }
  const goGFBtn = document.getElementById('goGFBtn');
  if (goGFBtn){
    goGFBtn.onclick = (e)=>{
      if(!focusTicker) return;
      const sym = String(focusTicker).trim().toUpperCase();
      const mapEx = EXCHANGE_MAP[sym];
      const urlPrimary = mapEx ? `https://www.google.com/finance/quote/${encodeURIComponent(sym)}:${encodeURIComponent(mapEx)}`
                               : null;
      const urlAlt = (mapEx === 'NASDAQ') ? `https://www.google.com/finance/quote/${encodeURIComponent(sym)}:NYSE`
                    : (mapEx === 'NYSE') ? `https://www.google.com/finance/quote/${encodeURIComponent(sym)}:NASDAQ`
                    : `https://www.google.com/finance/quote/${encodeURIComponent(sym)}:NASDAQ`;
      const urlSearch = `https://www.google.com/finance?q=${encodeURIComponent(sym)}`;
      
      // Shift-click: apri entrambe (power user); Alt-click: forza exchange opposto
      if (e && e.shiftKey){
        if (urlPrimary) window.open(urlPrimary, '_blank', 'noopener');
        window.open(urlAlt, '_blank', 'noopener');
        return;
      }
      if (e && e.altKey){
        window.open(urlAlt, '_blank', 'noopener');
        return;
      }
      // Normale: se abbiamo exchange mappato, usa quello; altrimenti vai su ricerca
      if (urlPrimary){
        window.open(urlPrimary, '_blank', 'noopener');
      } else {
        window.open(urlSearch, '_blank', 'noopener');
      }
    };
  }

  const focusTitle = document.getElementById('focusTitle');
  const focusInfo  = document.getElementById('focusInfo');
  const focusBody  = document.getElementById('focusBody');
  closeOverlay.onclick = ()=> overlay.style.display='none';
  if(holdingCloseBtn && holdingOverlay){ holdingCloseBtn.onclick = ()=> holdingOverlay.style.display='none'; }
  
  followBtn.onclick = ()=>{
    if(!focusTicker) return;
    let mine = getMyTickers();
    if(mine.includes(focusTicker)){
      mine = mine.filter(t=>t!==focusTicker);
    } else {
      mine.push(focusTicker);
    }
    setMyTickers(mine);
    refreshFollowBtn();
    render();
  };

  function updateHoldingFavBtn(){
    // no-op: holdings popup no longer has a favorites toggle button
  }

  searchBox.addEventListener('keydown', (e)=>{
    if(e.key==='Escape'){ searchBox.value=''; hideSuggestions(); render(); return; }
    if(e.key==='Enter'){
      const qraw = (searchBox.value||'');
      const q = qraw.toLowerCase().trim();
      if(!q){ hideSuggestions(); render(); return; }
      const exactTicker = Object.keys(NAME_MAP).find(t => t.toLowerCase() === q);
      const exactName = Object.entries(NAME_MAP).find(([t,n]) => (n||'').toLowerCase() === q);
      if (exactTicker){ applySuggestion(exactTicker); e.preventDefault(); return; }
      if (exactName){ applySuggestion(exactName[0]); e.preventDefault(); return; }
      const suggestions = Object.entries(NAME_MAP)
        .filter(([t,n]) => t.toLowerCase().startsWith(q) || ((n||'').toLowerCase().startsWith(q)))
        .slice(0,10);
      if (suggestions.length){ applySuggestion(suggestions[0][0]); e.preventDefault(); return; }
      hideSuggestions(); render();
    }
  });


  // Default range: ultimi 7 giorni fino ad oggi
  (function setDefaultDates(){
  const today = new Date();
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth()+1).padStart(2,'0');
  const dd = String(today.getDate()).padStart(2,'0');
  toDate.value = `${yyyy}-${mm}-${dd}`;

  const d2 = new Date(today);
  d2.setDate(d2.getDate() - 7);

  const yyyy2 = d2.getFullYear();
  const mm2 = String(d2.getMonth()+1).padStart(2,'0');
  const dd2 = String(d2.getDate()).padStart(2,'0');
  fromDate.value = `${yyyy2}-${mm2}-${dd2}`;

// === Export CSV Fix ===
function escapeCSV(v){
  if (v == null) return '';
  const s = String(v).replace(/"/g, '""');
  return /[",\n;]/.test(s) ? `"${s}"` : s;
}
function downloadCSV(){
  const rows = getFiltered ? getFiltered() : [];
  const header = ['Date','Fund','Ticker','Name','Direction','Shares','Weight %'];
  const lines = [header.join(',')];
  rows.forEach(r => {
    const name = NAME_MAP[r.ticker] || '';
    const direction = String(r.direction||'').toUpperCase();
    const shares = (r.shares==null ? '' : String(r.shares));
    const weight = (r.etf_percent==null ? '' : String(r.etf_percent));
    lines.push([r.date, r.fund, r.ticker, name, direction, shares, weight].map(escapeCSV).join(','));
  });
  const csv = '\ufeff' + lines.join('\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'ark_trades.csv';
  document.body.appendChild(a);
  a.click();
  setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); }, 0);
}
if (typeof csvBtn !== 'undefined' && csvBtn) csvBtn.onclick = downloadCSV;


  // Clear search button logic
  (function(){
    const clr = document.getElementById("clearBtn");
    if (clr) {
      clr.addEventListener("click", () => {
        const s = document.getElementById("searchBox");
        if (s) {
          s.value = "";
          s.focus();
        }
        // optionally hide suggestions if visible
        const sug = document.getElementById("suggestions");
        if (sug) sug.style.display = "none";
      });
    }
  })();

})();

  // Chips fondi (sempre visibili, indipendenti dal fetch)
  const selected = new Set(FUNDS);
  function renderChips(){
    fundsChips.innerHTML = "";
    FUNDS.forEach(f => {
      const chip = document.createElement('button');
      chip.className = 'chip ' + (selected.has(f) ? 'on' : '');
      chip.textContent = f;
      chip.onclick = () => { selected.has(f) ? selected.delete(f) : selected.add(f); renderChips(); updateFundCount(); fetchAll(); };
      fundsChips.appendChild(chip);
    });
  }
  function updateFundCount(){ fundCount.textContent = selected.size; }
  renderChips(); updateFundCount();

  function fmtNum(n){ if(n==null || isNaN(n)) return ""; return Number(n).toLocaleString('it-IT'); }
function fmtPct(n){ if(n==null || n===undefined || isNaN(n)) return ""; return Number(n).toFixed(4).replace(/\.0+$/,''); }
function fmtSignShares(dir, n){ if(n==null || isNaN(n)) return ""; var s = fmtNum(Math.abs(Number(n))); return (String(dir).toUpperCase()==='BUY' ? '+' : '-') + s; }
function fmtDateDMY(ymd){ // expects 'YYYY-MM-DD' -> 'DD/MM/YY'
  if(!ymd) return '';
  var p = String(ymd).split('-'); if(p.length!==3) return ymd;
  var yy = p[0].slice(2); return p[2] + '/' + p[1] + '/' + yy;
}

  function coerceArray(json){
    if (Array.isArray(json)) return json;
    if (!json || typeof json !== 'object') return [];
    if (Array.isArray(json.data)) return json.data;
    if (Array.isArray(json.results)) return json.results;
    if (Array.isArray(json.items)) return json.items;
    if (Array.isArray(json.trades)) return json.trades;
    return [];
  }

  async function fetchFund(fund, from, to){
    const url = new URL('https://arkfunds.io/api/v2/etf/trades');
    url.searchParams.set('symbol', fund);
    url.searchParams.set('date_from', from);
    url.searchParams.set('date_to', to);
    url.searchParams.set('limit', '2000');
    const res = await fetch(url);
    if(!res.ok){ throw new Error(`Data not available (${res.status}) per ${fund}`); }
    const arr = coerceArray(await res.json());
    return arr.map(x => ({...x, fund}));
  }function hashHue(str){ let h=0; for (let i=0;i<str.length;i++){ h=(h*31 + str.charCodeAt(i))%360; } return h; }
  function tickerStyles(t){ const h=hashHue(t||''); return {bg:`hsl(${h},60%,20%)`, fg:`hsl(${h},85%,85%)`}; }


  
  // === Weight enrichment via /v2/stock/trades ===
  const weightMap = new Map(); // key: date|fund|ticker -> etf_percent

  function wkey(r){ return [r.date||'', r.fund||'', r.ticker||''].join('|'); }

  async function fetchWeightsForTicker(ticker, from, to){
    if(!ticker) return;
    try{
      const url = new URL('https://arkfunds.io/api/v2/stock/trades');
      url.searchParams.set('symbol', ticker);
      if(from) url.searchParams.set('date_from', from);
      if(to) url.searchParams.set('date_to', to);
      url.searchParams.set('limit', '2000');
      const res = await fetch(url);
      if(!res.ok) return;
      const data = await res.json();
      const trades = (data && (data.trades || data.data || data.results || data.items)) || [];
      for(const t of trades){
        const key = [t.date||'', t.fund||'', (t.symbol||t.ticker||ticker)].join('|');
        if(t.etf_percent!=null) weightMap.set(key, Number(t.etf_percent));
      }
    }catch(e){ /* silent */ }
  }

  function mergeWeights(rows){
    for(const r of rows){
      const pct = weightMap.get(wkey(r));
      if(pct!=null){ r.etf_percent = pct; }
    }
  }


  // --- Yahoo Finance price fetch helpers ---
  function chunk(arr, size){ const out=[]; for(let i=0;i<arr.length;i+=size){ out.push(arr.slice(i,i+size)); } return out; }

  async function fetchPricesYahoo(tickers){
    const priceMap = {};
    const batches = chunk(tickers, 50); // avoid URL too long
    for (const part of batches){
      const url = 'https://query1.finance.yahoo.com/v7/finance/quote?symbols=' + encodeURIComponent(part.join(','));
      try{
        const res = await fetch(url, {mode:'cors'});
        if(!res.ok) continue;
        const data = await res.json();
        const list = (data && data.quoteResponse && Array.isArray(data.quoteResponse.result)) ? data.quoteResponse.result : [];
        for (const q of list){
          const sym = q.symbol;
          const px  = Number(q.regularMarketPrice || q.postMarketPrice || q.bid || 0) || 0;
          if (sym && px>0) priceMap[sym] = px;
        }
      }catch(e){
        // ignore this batch
      }
    }
    return priceMap;
  }

  let allRows=[];

  
  async function fetchAll(){
    try{
      status.textContent = 'Loading‚Ä¶'; tbody.innerHTML=''; allRows=[];
      const from = fromDate.value, to = toDate.value, funds = Array.from(selected);
      const errors=[];
      for (const f of funds){
        try{ const part = await fetchFund(f, from, to); allRows.push(...part); }
        catch(e){ errors.push(e.message||String(e)); }
      }
      // If search is an exact TICKER, enrich with weights
      const qraw = (searchBox.value||'').trim();
      const q = qraw.toUpperCase();
      const exactTicker = q && /^[A-Z0-9\.\-]+$/.test(q) ? q : null;
      if (exactTicker){
        await fetchWeightsForTicker(exactTicker, from, to);
        mergeWeights(allRows);
      }
      render();
      status.textContent = errors.length ? ('Partial: ' + errors.join(' | ')) : `Loaded ${allRows.length} operations.`;
    }catch(e){ console.error(e); status.textContent='Error: '+(e.message||e); }
  }


  function getFiltered(){
    const q=(searchBox.value||'').trim().toLowerCase(); const mine=onlyMine.checked;
    return allRows.filter(r=>{
      if (mine && !getMyTickers().includes(r.ticker)) return false;
      if (q && !(String(r.ticker).toLowerCase().includes(q) || String(r.fund).toLowerCase().includes(q))) return false;
      return true;
    }).sort((a,b)=>{
      if (a.date === b.date){
        const at = String(a.ticker || '').toUpperCase();
        const bt = String(b.ticker || '').toUpperCase();
        if (at < bt) return -1;
        if (at > bt) return 1;
        return 0;
      }
      return a.date < b.date ? 1 : -1;
    });
  }

  function render(){
    const filtered = getFiltered();
    tbody.innerHTML='';
    if (!filtered.length){
      const tr=document.createElement('tr'); const td=document.createElement('td'); td.colSpan=4; td.className='muted'; td.textContent='No results for current filters.'; tr.appendChild(td); tbody.appendChild(tr);
    } else {
      let prevDay = null;
      for (const r of filtered){
        const dir=String(r.direction||'').toUpperCase();
        const name=NAME_MAP[r.ticker]||'';
        const s=tickerStyles(r.ticker||'');
        const tr=document.createElement('tr');
        const dayKey = fmtDateDMY(r.date||'');
        if (prevDay && dayKey!==prevDay) tr.classList.add('day-break');
        prevDay = dayKey;
        tr.setAttribute("data-ticker", r.ticker||"");
        tr.innerHTML = `
<td>${fmtDateDMY(r.date||'')}</td>
<td>${r.fund||''}</td>
<td>
  <span class="ticker-pill gf-open" data-ticker="${r.ticker||''}" style="background:${s.bg};color:${s.fg}">${r.ticker||''}</span>
  ${name?`<a class="name-open muted" data-ticker="${r.ticker||''}" style="font-size:12px;margin-left:6px;cursor:pointer">${name}</a>`:''}
</td>
<td class="num ${dir==='BUY'?'buy':'sell'}">${fmtNum(r.shares)} | ${fmtPct(r.etf_percent)} <span class="arrow">${dir==='BUY'?'‚ñ≤':'‚ñº'}</span></td>
`;
        tbody.appendChild(tr);
      }
    }
    countBox.textContent = filtered.length.toLocaleString('it-IT');
    // Attach fresh listeners after render

// Row-level open: click anywhere on the row opens the overlay, except on the ticker chip (gf-open)
tbody.addEventListener('click', (e)=>{
  if (e.target.closest('.gf-open')) return; // let the ticker chip open Google Finance
  const tr = e.target.closest('tr');
  const t = tr && tr.getAttribute('data-ticker');
  if (!t) return;
  openFocus(t);
}, false);

document.querySelectorAll('.name-open').forEach(el=>{
  el.addEventListener('click', (e)=>{
    e.preventDefault(); e.stopPropagation();
    openFocus(el.getAttribute('data-ticker')||'');
  });
});
document.querySelectorAll('.gf-open').forEach(el=>{
  el.addEventListener('click', (e)=>{
    e.preventDefault(); e.stopPropagation();
    const t = el.getAttribute('data-ticker')||'';
    const url = googleFinanceURL ? googleFinanceURL(t) : `https://www.google.com/finance/quote/${t}:NASDAQ`;
    window.open(url, '_blank', 'noopener');
  });
});
  }

  
  function isFollowed(t){ return getMyTickers().includes(t); }
  function refreshFollowBtn(){
  if(!focusTicker) return;
  const on = isFollowed(focusTicker);
  // Use the same Favorites bookmark icon as holdings popup
  followBtn.innerHTML = '<img src="icons/Favorites.svg" alt="Favorite"/>';
  followBtn.setAttribute('aria-pressed', on ? 'true' : 'false');
  followBtn.title = on ? 'Saved' : 'Save';
  followBtn.classList.toggle('on', on);
}

  async function openFocus(ticker){
    // ensure weights for this ticker
    await fetchWeightsForTicker(ticker, fromDate.value, toDate.value);
    mergeWeights(allRows);
    const rows = getFiltered().filter(r=>r.ticker===ticker);
    focusTicker = ticker; window.focusTicker = ticker;
    
    focusTitle.innerHTML = (function(){
  var nm = (NAME_MAP && NAME_MAP[ticker]) ? NAME_MAP[ticker] : '';
  var s  = tickerStyles(ticker||'');
  var T  = (ticker||'').toUpperCase();
  var initials = T.slice(0,2);
  return `
    <div class="focus-main">
      <span class="avatar avatar-focus" data-ticker="${T}"><span class="mono">${initials}</span></span>
      <div class="focus-text">
        <span class="focus-ticker-pill ticker-pill gf-open" data-ticker="${T}" style="background:${s.bg};color:${s.fg}">${T}</span>
        ${nm ? `<div class="focus-name">${nm}</div>` : ''}
      </div>
    </div>`;
})();
    refreshFollowBtn();
    focusInfo.textContent = `${rows.length} transactions displayed for ${ticker}.`;
    focusBody.innerHTML='';
    rows.forEach(r=>{
      const dir=String(r.direction||'').toUpperCase();
      const tr=document.createElement('tr');
      tr.innerHTML = `
          <td>${fmtDateDMY(r.date||'')}</td>
          <td>${r.fund||''}</td>
        <td class="num ${dir==='BUY'?'buy':'sell'}">${fmtNum(r.shares)} | ${fmtPct(r.etf_percent)} <span class="arrow">${dir==='BUY'?'‚ñ≤':'‚ñº'}</span></td>
      `;
      focusBody.appendChild(tr);
    });
    overlay.style.display='flex';
    try{
      __logoResolver.hydrateAvatar('.hdr .avatar[data-ticker="'+ticker.toUpperCase()+'"]', ticker);
      setTimeout(()=>__logoResolver.hydrateAvatar('.hdr .avatar[data-ticker="'+ticker.toUpperCase()+'"]', ticker), 250);
      setTimeout(()=>__logoResolver.hydrateAvatar('.hdr .avatar[data-ticker="'+ticker.toUpperCase()+'"]', ticker), 800);
    }catch(e){}

  }

  
  function toggleMyTicker(ticker){
    let mine = getMyTickers();
    if(mine.includes(ticker)){
      mine = mine.filter(t=>t!==ticker);
    } else {
      mine.push(ticker);
    }
    setMyTickers(mine);
    render();
  }

  // Event handlers
  fetchBtn.onclick = fetchAll;
  
  const suggestionsBox = document.getElementById('suggestions');
  function hideSuggestions(){ suggestionsBox.style.display='none'; }
  function renderSuggestions(list){
    if(!list.length){ suggestionsBox.style.display='none'; return; }
    suggestionsBox.innerHTML = list.map(function(pair){
      var t = pair[0], n = pair[1] || '';
      var s = tickerStyles(t||'');
      return '<div class="sg" data-ticker="'+t+'">'
           +   '<span class="ticker-pill" style="background:'+s.bg+';color:'+s.fg+'">'+t+'</span>'
           +   '<span class="muted">'+n+'</span>'
           + '</div>';
    }).join('');
    // Attach to body to avoid any parent overflow clipping
    if (suggestionsBox.parentElement !== document.body){
      document.body.appendChild(suggestionsBox);
    }
    var r = searchBox.getBoundingClientRect();
    var BUTTON_SPACE = 56; // spazio riservato al tasto Enter (40px) + gap
    suggestionsBox.style.position = 'fixed';
    suggestionsBox.style.left = r.left + 'px';
    suggestionsBox.style.top = (r.bottom + 6) + 'px';
    suggestionsBox.style.minWidth = Math.max(0, r.width - BUTTON_SPACE) + 'px';
    suggestionsBox.style.display='block';
  }

  function applySuggestion(t){
    searchBox.value = t;
    hideSuggestions();
    render();
  }
  // input handler
  searchBox.oninput = ()=>{
    const q = (searchBox.value||'').toLowerCase();
    if(!q){ hideSuggestions(); render(); return; }
    const suggestions = Object.entries(NAME_MAP)
      .filter(([t,n])=> t.toLowerCase().startsWith(q) || (n && n.toLowerCase().startsWith(q)))
      .slice(0,10);
    renderSuggestions(suggestions);
    render();
  };
  searchBox.addEventListener('keydown', (e)=>{
    if(e.key==='Escape'){ searchBox.value=''; hideSuggestions(); render(); return; }
    if(e.key==='Enter'){
      const qraw = (searchBox.value||'');
      const q = qraw.toLowerCase().trim();
      if(!q){ hideSuggestions(); render(); return; }
      const exactTicker = Object.keys(NAME_MAP).find(t => t.toLowerCase() === q);
      const exactName = Object.entries(NAME_MAP).find(([t,n]) => (n||'').toLowerCase() === q);
      if (exactTicker){ applySuggestion(exactTicker); e.preventDefault(); return; }
      if (exactName){ applySuggestion(exactName[0]); e.preventDefault(); return; }
      const suggestions = Object.entries(NAME_MAP)
        .filter(([t,n]) => t.toLowerCase().startsWith(q) || ((n||'').toLowerCase().startsWith(q)))
        .slice(0,10);
      if (suggestions.length){ applySuggestion(suggestions[0][0]); e.preventDefault(); return; }
      hideSuggestions(); render();
    }
  });
  // hide on Escape
  searchBox.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ searchBox.value=''; hideSuggestions(); render(); } });
  // hide on blur (with small delay to allow click on suggestion)
  searchBox.addEventListener('blur', ()=> setTimeout(hideSuggestions, 250));
  // hide on outside click
  suggestionsBox.addEventListener('mousedown', (e)=>{ var el = e.target.closest('[data-ticker]'); if(el){ applySuggestion(el.dataset.ticker); }});
  
  // === Suggestions: reposition on scroll/resize & robust close ===
  function repositionSuggestions(){
    if (!suggestionsBox || suggestionsBox.style.display === 'none') return;
    try{
      var r = searchBox.getBoundingClientRect();
      var BUTTON_SPACE = 56; // spazio riservato al tasto Enter (40px) + gap
      suggestionsBox.style.left = r.left + 'px';
      suggestionsBox.style.top = (r.bottom + 6) + 'px';
      suggestionsBox.style.minWidth = Math.max(0, r.width - BUTTON_SPACE) + 'px';
    }catch(e){}
  }

  window.addEventListener('scroll', repositionSuggestions, true);
  window.addEventListener('resize', repositionSuggestions);
  document.addEventListener('keydown', function(e){ if(e.key==='Escape') hideSuggestions(); });
  // Click outside to close
  document.addEventListener('mousedown', function(e){
    if (suggestionsBox && suggestionsBox.style.display !== 'none'){
      const inside = e.target === suggestionsBox || suggestionsBox.contains(e.target) || e.target === searchBox;
      if(!inside) hideSuggestions();
    }
  });

  document.addEventListener('click', (e)=>{
    const sc = searchBox.closest('.search-card');
    if (!sc.contains(e.target)) hideSuggestions();
  });


  onlyMine.onchange = ()=>render();
  document.addEventListener('keydown', e=>{ if(e.key==='Escape'){ overlay.style.display='none'; if(holdingOverlay) holdingOverlay.style.display='none'; } });

  
// Delegated handler: open Google Finance when clicking any .gf-open (including in popup header)
document.addEventListener('click', function(e){
  var el = e.target.closest && e.target.closest('.gf-open');
  if(!el) return;
  var t = el.getAttribute('data-ticker') || el.textContent || '';
  if(!t) return;
  e.preventDefault(); e.stopPropagation();
  var url = (typeof googleFinanceURL==='function') ? googleFinanceURL(t) : ('https://www.google.com/finance/quote/'+t+':NASDAQ');
  window.open(url, '_blank', 'noopener');
}, true);


async function hydrateLogoInHeader(ticker){
  try{
    const T = (ticker||'').toUpperCase();
    const slot = document.querySelector('.hdr .avatar[data-ticker="'+T+'"]');
    if(!slot) return;
    const sources = [
      'logos/'+T+'.png',
      'https://static.finnhub.io/logo/'+T+'.png',
      'https://storage.googleapis.com/iex/api/logos/'+T+'.png'
    ];
    for (const src of sources){
      const ok = await new Promise((resolve)=>{ const img=new Image(); img.onload=()=>resolve(img.width>0); img.onerror=()=>resolve(false); img.src=src; });
      if (ok){ const imgEl=document.createElement('img'); imgEl.src=src; imgEl.alt=T; imgEl.style.width='100%'; imgEl.style.height='100%'; imgEl.style.objectFit='cover'; slot.innerHTML=''; slot.appendChild(imgEl); return; }
    }
  }catch(_){}
}


// === V7 ‚Äî Shared logo resolver (home + popup) ===
(function(){
  const DOMAIN_MAP = {
    // Known tricky ones
    TEM: 'tempus.com',
    RBLX: 'roblox.com',
    SHOP: 'shopify.com',
    PLUG: 'plugpower.com',
    NVDA: 'nvidia.com',
    AMD: 'amd.com',
    TSLA: 'tesla.com',
    META: 'about.facebook.com',
    GOOGL: 'abc.xyz',
    GOOG: 'abc.xyz',
    MSFT: 'microsoft.com',
    ENI: 'eni.com'
  };

  const logoCache = new Map(); // TICKER -> resolved URL or null if none

  function fileCandidates(t){
    const T = (t||'').toUpperCase();
    const l = (t||'').toLowerCase();
    return [
      `logos/${T}.png`, `logos/${T}.svg`,
      `logos/${l}.png`, `logos/${l}.svg`
    ];
  }

  function cdnCandidates(t){
    const T = (t||'').toUpperCase();
    return [
      `https://static.finnhub.io/logo/${T}.png`,
      `https://storage.googleapis.com/iex/api/logos/${T}.png`
    ];
  }

  function faviconCandidates(t){
    const T = (t||'').toUpperCase();
    const dom = DOMAIN_MAP[T];
    if (!dom) return [];
    // Google s2 favicons (fast, reliable)
    return [
      `https://www.google.com/s2/favicons?domain=${dom}&sz=64`
    ];
  }

  async function probe(url){
    // Try to load image; resolve true on success, false on error
    try{
      const ok = await new Promise((resolve)=>{
        const img = new Image();
        img.onload = ()=>resolve(img.width>0);
        img.onerror = ()=>resolve(false);
        img.src = url;
      });
      return !!ok;
    }catch(_){ return false; }
  }

  async function resolveLogoFor(ticker){
    const T = (ticker||'').toUpperCase();
    if (logoCache.has(T)) return logoCache.get(T);
    const sources = [
  `logos/${T}.webp`, `Logos/${T}.webp`,
      ...fileCandidates(T),
      ...cdnCandidates(T),
      ...faviconCandidates(T)
    ];
    for (const src of sources){
      const ok = await probe(src);
      if (ok){ logoCache.set(T, src); return src; }
    }
    logoCache.set(T, null);
    return null;
  }

  async function hydrateAvatar(selector, ticker){
    const T = (ticker||'').toUpperCase();
    const slot = document.querySelector(selector);
    if (!slot) return;
    const found = await resolveLogoFor(T);
    if (!found) return; // keep initials
    const img = document.createElement('img');
    img.src = found;
    img.alt = T;
    img.style.width = '100%';
    img.style.height = '100%';
    img.style.objectFit = 'cover';
    slot.innerHTML = '';
    slot.appendChild(img);
  }

  // Expose minimal API
  window.__logoResolver = { resolveLogoFor, hydrateAvatar };
})();

  
// Bind click for Open Google Finance icon (robust)
(function(){
  function bindGF(){
    var btn = document.getElementById('openGFBtn');
    if(!btn) return;
    btn.onclick = function(){
      if(!window.focusTicker) return;
      var url = (typeof googleFinanceURL==='function')
        ? googleFinanceURL(focusTicker)
        : ('https://www.google.com/finance/quote/'+focusTicker+':NASDAQ');
      window.open(url, '_blank', 'noopener');
    };
  }
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', bindGF);
  } else {
    bindGF();
  }
})();
  
// === V15 mount & stats ===
(function(){
  function move(id, slotId){
    const el = document.getElementById(id);
    const slot = document.getElementById(slotId);
    if (el && slot) slot.appendChild(el);
  }
  move('fromDate','slot-fromDate');
  move('toDate','slot-toDate');
  const sb = document.getElementById('searchBox');
  if (sb){
    const wrap = sb.closest('.search-inline') || sb;
    const slot = document.getElementById('slot-search'); if (wrap && slot) slot.appendChild(wrap);
  }
  move('fundsChips','slot-fundsChips');
  
  move('fetchBtn','slot-fetchBtn');
  move('csvBtn','slot-csvBtn');

  // Make entire date chip clickable
  try{
    const fromSlot = document.getElementById('slot-fromDate');
    const toSlot = document.getElementById('slot-toDate');
    if (fromSlot && fromDate){
      fromSlot.addEventListener('click', () => {
        if (typeof fromDate.showPicker === 'function') {
          fromDate.showPicker();
        } else {
          fromDate.focus();
        }
      });
    }
    if (toSlot && toDate){
      toSlot.addEventListener('click', () => {
        if (typeof toDate.showPicker === 'function') {
          toDate.showPicker();
        } else {
          toDate.focus();
        }
      });
    }
  }catch(e){}

  // === v4.18 ‚Äî Arrange search actions + Clear behavior ===
  (function(){
    const $ = (id)=>document.getElementById(id);
    const slotSearch = $('slot-search');
    const slotCSV    = $('slot-csvBtn');
    const fetchBtn   = $('fetchBtn');
    const clearBtn   = $('clearBtn');
    const csvBtn     = $('csvBtn');
    const searchBox  = $('searchBox');

    // Place input + [Enter][X] inline in slot-search
    if (slotSearch && searchBox){
      const wrap = searchBox.closest('.search-inline') || searchBox;
      if (wrap && !slotSearch.contains(wrap)) slotSearch.appendChild(wrap);
      // ensure order: input, fetch, clear
      if (fetchBtn && !slotSearch.contains(fetchBtn)) slotSearch.appendChild(fetchBtn);
      if (clearBtn && !slotSearch.contains(clearBtn)) { /* already inside search-wrap */ }
      // if csv accidentally sits here, move it out
      if (csvBtn && slotSearch.contains(csvBtn) && slotCSV){ slotCSV.appendChild(csvBtn); }
    }
    // CSV stays below in its own slot
    if (csvBtn && slotCSV && !slotCSV.contains(csvBtn)) slotCSV.appendChild(csvBtn);

    // Placeholder simplified
    if (searchBox) searchBox.placeholder = 'Search ticker‚Ä¶';

    // Clear should emulate manual clearing (no refetch): empty + dispatch input
    if (clearBtn && searchBox){
      clearBtn.addEventListener('click', ()=>{
        searchBox.value = '';
        // Dispatch input event to trigger same filtering/render of key typing
        try{
          const evt = new Event('input', { bubbles: true });
          searchBox.dispatchEvent(evt);
        }catch(e){
          // Fallback for older browsers
          const evt2 = document.createEvent('Event');
          evt2.initEvent('input', true, true);
          searchBox.dispatchEvent(evt2);
        }
        searchBox.focus();
      });
    }
  })();



  // v4.19.1 ‚Äî remove duplicate Clear buttons outside search-wrap (keep only the inside one)
  (function(){
    const all = Array.from(document.querySelectorAll('#clearBtn'));
    if (all.length > 1){
      all.forEach(btn => {
        if (!btn.closest('.search-wrap')) {
          btn.remove();
        }
      });
    }
  })();


  // v4.19.2 ‚Äî Remove Export CSV button entirely
  (function(){
    const csv = document.getElementById('csvBtn');
    if (csv) csv.remove();
    const slot = document.getElementById('slot-csvBtn');
    if (slot) slot.remove();
  })();

  // Move Results section into resultsSlot
  const resultsSlot = document.getElementById('resultsSlot');
  const tbl = document.getElementById('table');
  if (tbl && resultsSlot){
    const section = tbl.closest('section.card.pad') || tbl.closest('section') || tbl.parentElement;
    if (section) resultsSlot.appendChild(section);
  }

  // Stats update: wrap render()
  if (typeof render === 'function'){
    const _render = render;
    window.render = function(){
      _render();
      try{
        const list = (typeof getFiltered==='function') ? getFiltered() : [];
        const total = list.length;
        const buys  = list.filter(r => String(r.direction||'').toUpperCase()==='BUY').length;
        const sells = list.filter(r => String(r.direction||'').toUpperCase()==='SELL').length;
        const pct = (n)=> total? Math.round((n/total)*1000)/10 : 0;
        const $ = (id)=> document.getElementById(id);
        if($('statTotalN')) $('statTotalN').textContent = (total||0).toLocaleString('it-IT');
        if($('statBuyN'))   $('statBuyN').textContent   = (buys||0).toLocaleString('it-IT');
        if($('statSellN'))  $('statSellN').textContent  = (sells||0).toLocaleString('it-IT');
        if($('statBuyPct'))  $('statBuyPct').textContent  = (pct(buys)).toFixed(1).replace('.0','') + '%';
        if($('statSellPct')) $('statSellPct').textContent = (pct(sells)).toFixed(1).replace('.0','') + '%';
      }catch(e){}
    };
    try{ render(); }catch(e){}
  }
})();

  
// === V16: bookmark toggle + robust stats updater ===
(function(){
  // Recreate hidden onlyMine checkbox if missing (keeps existing filtering logic)
  var onlyMine = document.getElementById('onlyMine');
  if (!onlyMine){
    onlyMine = document.createElement('input');
    onlyMine.type='checkbox'; onlyMine.id='onlyMine'; onlyMine.style.display='none';
    document.body.appendChild(onlyMine);
  }

  // Wire bookmark toggle
  var toggleBtn = document.getElementById('toggleMineBtn');
  function syncToggleUI(){
    if(!toggleBtn) return;
    var on = !!onlyMine.checked;
    toggleBtn.classList.toggle('on', on);
    toggleBtn.title = on ? 'Showing only my tickers' : 'Only my tickers';
  }
  if (toggleBtn){
    toggleBtn.addEventListener('click', function(){
      onlyMine.checked = !onlyMine.checked;
      syncToggleUI();
      try{ render(); }catch(e){}
    });
    syncToggleUI();
  }

  // Stats updater
  function updateStats(){
    try{
      var list = (typeof getFiltered==='function') ? getFiltered() : (window.allRows || []);
      var total = list.length;
      var buys  = list.filter(function(r){ return String(r.direction||'').toUpperCase()==='BUY'; }).length;
      var sells = list.filter(function(r){ return String(r.direction||'').toUpperCase()==='SELL'; }).length;
      var pct = function(n){ return total ? Math.round((n/total)*1000)/10 : 0; };
      var $ = function(id){ return document.getElementById(id); };
      if($('statTotalN')) $('statTotalN').textContent = (total||0).toLocaleString('it-IT');
      if($('statBuyN'))   $('statBuyN').textContent   = (buys||0).toLocaleString('it-IT');
      if($('statSellN'))  $('statSellN').textContent  = (sells||0).toLocaleString('it-IT');
      if($('statBuyPct'))  $('statBuyPct').textContent  = (pct(buys)).toFixed(1).replace('.0','') + '%';
      if($('statSellPct')) $('statSellPct').textContent = (pct(sells)).toFixed(1).replace('.0','') + '%';
    }catch(e){}
  }

  // Wrap render() so every change updates stats
  if (typeof render === 'function'){
    var _render = render;
    window.render = function(){
      _render();
      updateStats();
    };
  }

  // Also observe table body changes to refresh stats when data loads
  var tbody = document.querySelector('#table tbody');
  if (tbody && 'MutationObserver' in window){
    var obs = new MutationObserver(updateStats);
    obs.observe(tbody, {childList:true, subtree:false});
  }

  // Initial attempt (in case data is already there)
  setTimeout(updateStats, 50);
  setTimeout(updateStats, 400);
  setTimeout(updateStats, 1200);
})();

  
// === V25: mount into two fixed columns (left: filters+stats, right: results) ===
document.addEventListener('DOMContentLoaded', function(){
  function byId(id){ return document.getElementById(id); }
  var twoCol   = byId('twoCol');
  var leftCol  = byId('leftCol');
  var rightCol = byId('rightCol');
  if (!twoCol || !leftCol || !rightCol) return;

  // Move Search Filters card into leftCol
  var filterCard = byId('filterCard');
  if (!filterCard){
    // If it's still inside the hidden controls section, move that first
    var controls = document.querySelector('section.controls.grid.fit-240');
    if (controls){
      // try to find filter card inside; fallback: build a new left card from existing slots
      filterCard = controls.querySelector('#filterCard') || null;
    }
  }
  if (filterCard){ leftCol.appendChild(filterCard); }

  // Move stats row under filters (left column)
  var stats = byId('statsRow');
  if (stats){ leftCol.appendChild(stats); }

  // Move the Results section into rightCol
  var tbl = byId('table');
  var resultsSection = tbl ? (tbl.closest('section.card.pad') || tbl.closest('section') || tbl.parentElement) : null;
  if (resultsSection){ rightCol.appendChild(resultsSection); }

  // Bookmark toggle -> hidden checkbox
  var only = byId('onlyMine');
  if(!only){ only = document.createElement('input'); only.type='checkbox'; only.id='onlyMine'; only.style.display='none'; document.body.appendChild(only); }
  var btn = byId('toggleMineBtn');
  function sync(){ if(btn) btn.classList.toggle('on', !!only.checked); }
  if (btn){
    btn.addEventListener('click', function(){ only.checked = !only.checked; sync(); try{ render(); }catch(e){}; });
    sync();
  }

  // Funds "Selected: N" mirror from chip states
  function updateFundMirror(){
    try{
      var root = byId('slot-fundsChips') || byId('fundsChips');
      var mirror = byId('fundCountMirror');
      if (!root || !mirror) return;
      var n = root.querySelectorAll('.chip.on').length;
      mirror.textContent = String(n);
    }catch(e){}
  }
  updateFundMirror();
  document.body.addEventListener('click', function(ev){
    var t = ev.target;
    if (t && t.closest && (t.closest('#slot-fundsChips') || t.closest('#fundsChips'))){
      setTimeout(updateFundMirror, 10);
    }
  });
  if (typeof render === 'function'){
    var _render = render;
    window.render = function(){
      _render();
      updateFundMirror();
      try{
        var list = (typeof getFiltered==='function') ? getFiltered() : [];
        var total = list.length;
        var buys  = list.filter(r => String(r.direction||'').toUpperCase()==='BUY').length;
        var sells = list.filter(r => String(r.direction||'').toUpperCase()==='SELL').length;
        var pct   = function(n){ return total? Math.round((n/total)*1000)/10 : 0; };
        var $ = function(id){ return document.getElementById(id); };
        if($('statTotalN')) $('statTotalN').textContent = (total||0).toLocaleString('it-IT');
        if($('statBuyN'))   $('statBuyN').textContent   = (buys||0).toLocaleString('it-IT');
        if($('statSellN'))  $('statSellN').textContent  = (sells||0).toLocaleString('it-IT');
        if($('statBuyPct'))  $('statBuyPct').textContent  = (pct(buys)).toFixed(1).replace('.0','') + '%';
        if($('statSellPct')) $('statSellPct').textContent = (pct(sells)).toFixed(1).replace('.0','') + '%';
      }catch(e){}
    };
  }
});

  
// === V28 runtime: disable funds filtering & keep everything else working ===
document.addEventListener('DOMContentLoaded', function(){
  // If there's any funds chips container, remove it from DOM
  var fc = document.getElementById('fundsChips') || document.getElementById('slot-fundsChips');
  if (fc){ var parent = fc.closest('.card') || fc.parentElement; if (parent) parent.remove(); else fc.remove(); }

  // Create/override a helper that always returns ALL funds present in data
  window.getEnabledFunds = function(){
    try{
      var all = (window.allRows||[]).map(r=>r.fund);
      return Array.from(new Set(all));
    }catch(e){ return []; }
  };

  // Monkey-patch getFiltered to ignore any fund selection it might use
  if (typeof getFiltered === 'function'){
    const _getFiltered = getFiltered;
    window.getFiltered = function(){
      // call original
      const out = _getFiltered();
      // If the original already ignores funds, return as-is.
      // Otherwise, if it filtered by a subset of funds, we can't easily detect here;
      // but we can ensure that a global set isn't restricting future renders by resetting it if present.
      try{
        if (window.selectedFunds && typeof window.selectedFunds.clear === 'function'){
          // rebuild as "all funds"
          window.selectedFunds.clear();
          (window.allRows||[]).forEach(r => window.selectedFunds.add(r.fund));
        }
      }catch(_){}
      return out;
    };
  }

  // Also ensure chip count/mirror is gone
  var mirror = document.getElementById('fundCountMirror'); if (mirror) mirror.parentElement && mirror.parentElement.remove();
});

  // Auto-caricamento all'apertura
  window.addEventListener('DOMContentLoaded', fetchAll);

  // Ticker color helper (placed last so it's defined when sidebar uses it)
  function tickerColorExample(){ return null; }
})();

</script>

<script>
// === Auto-resolve exchange with persistent overrides ===
(function(){
  // Hardcoded seeds (best-effort) for first-run guesses
  const SEED = {
    // Likely NASDAQ
    AMD:'NASDAQ', GOOGL:'NASDAQ', GOOG:'NASDAQ', AMZN:'NASDAQ', META:'NASDAQ',
    NVDA:'NASDAQ', INTC:'NASDAQ', ROKU:'NASDAQ', CRSP:'NASDAQ', NTLA:'NASDAQ',
    SNPS:'NASDAQ', MSFT:'NASDAQ', TSLA:'NASDAQ', PLUG:'NASDAQ', ABSI:'NASDAQ',
    TEM:'NASDAQ', REKR:'NASDAQ', HYMC:'NASDAQ', QSI:'NASDAQ', ISRG:'NASDAQ',
    ARCT:'NASDAQ', PACB:'NASDAQ', FCEL:'NASDAQ', AAPL:'NASDAQ', NFLX:'NASDAQ',
    // Known NYSE from your list
    PATH:'NYSE', ORCL:'NYSE', PLTR:'NYSE', UNH:'NYSE', TDY:'NYSE',
    // Specific fixes
    LHX:'NYSE', BABA:'NYSE', RBLX:'NYSE', SHOP:'NASDAQ', ENI:'NYSE'
  };
  const KEY = 'exchange_overrides_v1';

  function loadMap(){
    try{ return JSON.parse(localStorage.getItem(KEY) || '{}'); }catch(_){ return {}; }
  }
  function saveMap(m){ localStorage.setItem(KEY, JSON.stringify(m)); }
  function setExchange(t, ex){
    const T = (t||'').toUpperCase();
    const m = loadMap();
    m[T] = ex;
    saveMap(m);
  }
  window.__setExchangeOverride = setExchange;

  function resolveExchange(t){
    const T = (t||'').toUpperCase();
    const m = loadMap();
    if (m[T]) return m[T];
    if (SEED[T]) return SEED[T];
    return 'NASDAQ'; // fallback
  }
  // Patch/define googleFinanceURL to use the resolver
  const _oldGF = (typeof googleFinanceURL === 'function') ? googleFinanceURL : null;
  window.googleFinanceURL = function(t){
    const T = (t||'').toUpperCase();
    const exch = resolveExchange(T);
    const enc = encodeURIComponent(T);
    return `https://www.google.com/finance/quote/${enc}:${exch}`;
  };

  // Add a small dropdown in the overlay header next to "Go to stock" to change exchange quickly
  function enhanceOverlay(){
    const hdr = document.querySelector('#focusHeader') || document.querySelector('.focus-header') || document.querySelector('#focus .header, #focus header');
    if (!hdr || hdr.__exchEnhanced) return;
    hdr.__exchEnhanced = true;

    const wrap = document.createElement('span');
    wrap.style.marginLeft = '8px';
    wrap.innerHTML = `
      <select id="exchSelect" style="background:transparent;border:1px solid rgba(255,255,255,.15);border-radius:10px;padding:6px 8px;color:#ddd;outline:none">
        <option value="NASDAQ">NASDAQ</option>
        <option value="NYSE">NYSE</option>
        <option value="AMEX">AMEX</option>
        <option value="OTC">OTC</option>
      </select>`;
    hdr.appendChild(wrap);

    // When overlay opens, set select to current ticker's exch
    const setForTicker = (t)=>{
      const sel = document.getElementById('exchSelect'); if (!sel) return;
      sel.value = resolveExchange(t);
      sel.onchange = ()=>{
        __setExchangeOverride(t, sel.value);
      };
    };

    // Hook into openFocus to update dropdown
    if (!window.__openFocusPatched){
      window.__openFocusPatched = true;
      const __oldOpen = window.openFocus;
      window.openFocus = function(t){
        const res = __oldOpen ? __oldOpen.apply(this, arguments) : undefined;
        setTimeout(()=> setForTicker(t), 0);
        return res;
      };
    }
  }

  // Try now and observe DOM changes
  function run(){
    enhanceOverlay();
  }
  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', run);
  } else {
    run();
  }
  const mo = new MutationObserver(run);
  mo.observe(document.documentElement, {childList:true, subtree:true});
})();
</script>

<script>

// === v4.12 ‚Äî Ticker avatar helpers (hybrid: local -> clearbit -> monogram) ===
(function(){
  const DOMAIN_MAP = {
    AMD:'amd.com', NVDA:'nvidia.com', INTC:'intel.com', MSFT:'microsoft.com',
    META:'meta.com', GOOGL:'abc.xyz', GOOG:'abc.xyz', AMZN:'amazon.com',
    AAPL:'apple.com', TSLA:'tesla.com', ORCL:'oracle.com', SNPS:'synopsys.com',
    UNH:'unitedhealthgroup.com', ENI:'eni.com', PLUG:'plugpower.com',
    RBLX:'roblox.com', ROKU:'roku.com', BABA:'alibaba.com', SHOP:'shopify.com',
    PLTR:'palantir.com', PATH:'uipath.com', ARCT:'arcturusrx.com',
    CRSP:'crisprtx.com', NTLA:'intelliatx.com', ABSI:'absci.com',
    TEM:'tempus.com', BBAI:'bigbear.ai', REKR:'rekor.ai',
    HIVE:'hivedigitaltechnologies.com', HYMC:'hycroftmining.com',
    QSI:'quantum-si.com', ISRG:'intuitive.com', TDY:'teledyne.com',
    FCEL:'fce.com', PACB:'pacb.com'
  };

  function createAvatar(ticker){
  const T = (ticker||'').toUpperCase();
  const span = document.createElement('span');
  span.className = 'avatar';
  const img = document.createElement('img');

  // Try multiple local candidates (folder case + extensions)
  const candidates = [
    `logos/${T}.webp`, `Logos/${T}.webp`,
    `logos/${T}.svg`, `Logos/${T}.svg`,
    `logos/${T}.png`, `Logos/${T}.png`,
    `logos/${T}.jpg`, `Logos/${T}.jpg`,
    `logos/${T}.jpeg`, `Logos/${T}.jpeg`
  ];

  // If we have a domain, add Clearbit fallback at the end
  const clearbitURL = DOMAIN_MAP[T] ? `https://logo.clearbit.com/${DOMAIN_MAP[T]}?size=64` : null;
  if (clearbitURL) candidates.push(clearbitURL);

  let idx = 0;
  img.onerror = () => {
    idx++;
    if (idx < candidates.length){
      img.src = candidates[idx];
    } else {
      span.innerHTML = `<span class="mono">${T.slice(0,2)}</span>`;
    }
  };
  img.src = candidates[idx];
  span.appendChild(img);
  return span;
}

  function enhanceRow(tr){
    if (!tr || tr.__avatarEnhanced) return;
    tr.__avatarEnhanced = true;
    try{
      const t = tr.getAttribute('data-ticker') || '';
      if (!t) return;
      const tds = tr.querySelectorAll('td');
      if (tds.length < 3) return;
      const nameCell = tds[2];
      nameCell.classList.add('td-name');
      if (nameCell.querySelector('.avatar')) return;
      const avatar = createAvatar(t);
      nameCell.insertBefore(avatar, nameCell.firstChild);
      if (!nameCell.querySelector('.ticker-wrap')){
        const wrap = document.createElement('span');
        wrap.className = 'ticker-wrap';
        while (avatar.nextSibling) wrap.appendChild(avatar.nextSibling);
        nameCell.appendChild(wrap);
      }
    }catch(e){}
  }

  function enhanceTable(){
    const tbody = document.querySelector('#table tbody');
    if (!tbody) return;
    tbody.querySelectorAll('tr').forEach(enhanceRow);
  }

  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', enhanceTable);
  } else {
    enhanceTable();
  }
  const mo = new MutationObserver(muts=>{
    for (const m of muts){
      m.addedNodes && m.addedNodes.forEach(n=>{
        if (n.nodeType===1 && n.matches && n.matches('#table tbody tr')) enhanceRow(n);
        if (n.querySelectorAll){
          n.querySelectorAll('#table tbody tr').forEach(enhanceRow);
        }
      });
    }
  });
  mo.observe(document.body, {childList:true, subtree:true});
// === Lightweight DOM-side filter & pagination (non-invasive) ===
try{
  const typeFilter = document.getElementById('typeFilter');
  const pageSizeSel = document.getElementById('pageSize');
  const prevPageBtn = document.getElementById('prevPage');
  const nextPageBtn = document.getElementById('nextPage');
  const pageInfoEl  = document.getElementById('pageInfo');
  const countBoxEl  = document.getElementById('countBox');
  const tbodyEl     = document.getElementById('tbody');
  let currentPage = 1;
  let pageSize = pageSizeSel ? parseInt(pageSizeSel.value,10) : 100;

  function rowDir(tr){
    // dir inferred from last cell class (has 'buy' or 'sell')
    const td = tr.querySelector('td:last-child');
    if (!td) return 'ALL';
    return td.classList.contains('buy') ? 'BUY' : (td.classList.contains('sell') ? 'SELL' : 'ALL');
  }

  function visibleRows(){
    const tSel = (typeFilter && typeFilter.value) ? typeFilter.value.toUpperCase() : 'ALL';
    const rows = Array.from(tbodyEl.querySelectorAll('tr'));
    const filt = rows.filter(tr => {
      const d = rowDir(tr);
      return (tSel==='ALL' || d===tSel);
    });
    // update count to visible rows
    if (countBoxEl) countBoxEl.textContent = filt.length.toLocaleString('it-IT');
    return filt;
  }

  function applyPager(){
    if (!tbodyEl) return;
    const rows = visibleRows();
    const pages = Math.max(1, Math.ceil(rows.length / pageSize));
    if (currentPage > pages) currentPage = pages;
    const start = (currentPage-1)*pageSize;
    const end   = start + pageSize;

    // First hide all
    Array.from(tbodyEl.querySelectorAll('tr')).forEach(tr => tr.style.display = 'none');
    // Then show filtered slice
    rows.slice(start, end).forEach(tr => tr.style.display = '');

        if (pageInfoEl || document.getElementById('pageInfoBottom')) {
      const maxPages = Math.max(pages,1);
      const current = pages ? currentPage : 1;
      let dots = "";
      const visible = Math.min(maxPages, 10);
      for (let i = 1; i <= visible; i++){
        dots += (i === current ? "‚óè" : "‚óã");
        if (i < visible) dots += " ";
      }
      const infoBottom = document.getElementById('pageInfoBottom');
      if (pageInfoEl) pageInfoEl.textContent = dots;
      if (infoBottom) infoBottom.textContent = dots;
    }
    if (prevPageBtn) prevPageBtn.disabled = (currentPage<=1);
    if (nextPageBtn) nextPageBtn.disabled = (currentPage>=pages);
  }

  if (typeFilter) typeFilter.addEventListener('change', ()=>{ currentPage=1; applyPager(); });
  if (pageSizeSel) pageSizeSel.addEventListener('change', ()=>{ pageSize=parseInt(pageSizeSel.value,10)||100; currentPage=1; applyPager(); });
  if (prevPageBtn) prevPageBtn.addEventListener('click', ()=>{ currentPage=Math.max(1,currentPage-1); applyPager(); });
  if (nextPageBtn) nextPageBtn.addEventListener('click', ()=>{ currentPage=currentPage+1; applyPager(); });

  // Re-apply after any table re-render
  const mo = new MutationObserver(()=>{ currentPage=1; applyPager(); });
  if (tbodyEl) mo.observe(tbodyEl, {childList:true, subtree:false});

  // Initial
  setTimeout(applyPager, 0);
}catch(e){ console.error('Pager init error', e); }
// === Bottom pager wiring (duplicate controls) ===
try{
  const prevTop = document.getElementById('prevPage');
  const nextTop = document.getElementById('nextPage');
  const infoTop = document.getElementById('pageInfo');
  const prevBottom = document.getElementById('prevPageBottom');
  const nextBottom = document.getElementById('nextPageBottom');
  const infoBottom = document.getElementById('pageInfoBottom');

  if (prevBottom && prevTop) prevBottom.addEventListener('click', ()=> prevTop.click());
  if (nextBottom && nextTop) nextBottom.addEventListener('click', ()=> nextTop.click());

  // Keep bottom info mirrored with top info
  if (infoTop && infoBottom){
    const mo = new MutationObserver(()=>{ infoBottom.textContent = infoTop.textContent; });
    mo.observe(infoTop, {characterData:true, subtree:true, childList:true});
    // initial sync
    infoBottom.textContent = infoTop.textContent;
  }
}catch(e){ console.error('Bottom pager sync error', e); }
// === Stat-cards drive Trade filter (Total / Buy / Sell) ===
try{
  const typeSel = document.getElementById('typeFilter');

  // Sidebar chips
  const chipAll  = document.querySelector('.type-chip[data-type-chip="ALL"]');
  const chipBuy  = document.querySelector('.type-chip[data-type-chip="BUY"]');
  const chipSell = document.querySelector('.type-chip[data-type-chip="SELL"]');

  function setActive(mode){
    const chips = [chipAll, chipBuy, chipSell];
    chips.forEach(c => c && c.classList.remove('active'));
    if (mode === 'ALL' && chipAll)  chipAll.classList.add('active');
    if (mode === 'BUY' && chipBuy)  chipBuy.classList.add('active');
    if (mode === 'SELL' && chipSell) chipSell.classList.add('active');
  }

  function setMode(mode){
    if (typeSel){
      typeSel.value = mode;
      typeSel.dispatchEvent(new Event('change'));
    } else {
      if (typeof applyPager === 'function') applyPager();
      else if (typeof render === 'function') render();
    }
    setActive(mode);
  }

  if (chipAll)  chipAll.addEventListener('click', () => setMode('ALL'));
  if (chipBuy)  chipBuy.addEventListener('click', () => setMode('BUY'));
  if (chipSell) chipSell.addEventListener('click', () => setMode('SELL'));

  // initial: reflect current select value
  setActive(typeSel && typeSel.value ? typeSel.value.toUpperCase() : 'ALL');
}catch(e){ console.error('Type-chip filter binding error', e); }
})();;

</script>



<script>
/* === Close & Total Column Enhancer v2.2 (stable) ===
   - Inserisce le colonne Close e Total PRIMA di Shares senza spostare i dati esistenti
   - Usa mappa INDICI "pre-inserimento" per allineare correttamente le nuove celle
   - Close 70px con simbolo $, Total 90px con formato compatto (K/M/B/T) e punto decimale
*/
(function(){
  const TABLE_ID = 'table';
  const TBODY_ID = 'tbody';
  const MAX_CONCURRENCY = 3;

  // Snapshot degli indici PRIMA di qualsiasi modifica
  let originalIndexMap = null; // {dateIdx, sharesIdx, tickerIdx, thEls, theadRow}

  // Utils
  const DAY = 24*60*60*1000;
  const pad = (n)=> String(n).padStart(2,'0');
  const toISO = (y,m,d)=> `${y}-${pad(m)}-${pad(d)}`;

  function parseDDMMYY(s){
    if(!s) return null;
    const m = s.trim().match(/^(\d{1,2})\/(\d{1,2})\/(\d{2,4})$/);
    if(!m) return null;
    let [_, dd, mm, yy] = m;
    dd = parseInt(dd,10);
    mm = parseInt(mm,10);
    yy = parseInt(yy,10);
    if(yy < 100){ yy += 2000; }
    return toISO(yy,mm,dd);
  }

  function parseShares(text){
    if(!text) return null;
    let s = text.replace(/[^0-9,\.\-]/g,'');
    if (s.includes(',') && s.includes('.')) {
      s = s.replace(/\./g,'').replace(',', '.');
    } else if (s.includes(',') && !s.includes('.')) {
      s = s.replace(/,/g, '');
    }
    const v = parseFloat(s);
    return Number.isFinite(v) ? v : null;
  }

  function formatCompact(n){
    if(n==null || !Number.isFinite(n)) return '‚Äì';
    const abs = Math.abs(n);
    const sign = n < 0 ? '-' : '';
    const units = [
      {v:1e12, s:'T'},
      {v:1e9,  s:'B'},
      {v:1e6,  s:'M'},
      {v:1e3,  s:'K'}
    ];
    for(const u of units){
      if(abs >= u.v){
        return sign + (abs/u.v).toFixed(2) + ' ' + u.s;
      }
    }
    return sign + Math.round(abs).toString();
  }

  // Yahoo helpers
  function buildYahooURL(symbol, startMs, endMs){
    const p1 = Math.floor(startMs/1000);
    const p2 = Math.floor(endMs/1000) + 86400;
    return `https://query1.finance.yahoo.com/v8/finance/chart/${encodeURIComponent(symbol)}?period1=${p1}&period2=${p2}&interval=1d&events=history&includeAdjustedClose=true`;
  }
  async function fetchWithFallback(rawUrl){
    const urls = [
      rawUrl,
      `https://corsproxy.io/?${encodeURIComponent(rawUrl)}`,
      `https://api.allorigins.win/raw?url=${encodeURIComponent(rawUrl)}`
    ];
    let lastErr;
    for(const u of urls){
      try{
        const res = await fetch(u, {cache:'no-store'});
        if(!res.ok) throw new Error(`HTTP ${res.status}`);
        return await res.json();
      }catch(e){ lastErr = e; }
    }
    throw lastErr || new Error('Fetch fallito su tutte le rotte');
  }

  const priceCache = new Map();
  const queue = [];
  let running = 0;
  function enqueue(task){ queue.push(task); pump(); }
  async function pump(){
    while(running < MAX_CONCURRENCY && queue.length){
      const t = queue.shift();
      running++;
      try{ await t(); }finally{ running--; }
    }
  }

  async function getClosePrice(symbol, isoDate){
    const key = `${symbol}|${isoDate}`;
    if(priceCache.has(key)) return priceCache.get(key);
    const end = new Date(isoDate);
    const start = new Date(end.getTime() - 10*DAY);
    try{
      const data = await fetchWithFallback(buildYahooURL(symbol, start.getTime(), end.getTime()));
      const r = data?.chart?.result?.[0];
      const ts = r?.timestamp || [];
      const closes = r?.indicators?.adjclose?.[0]?.adjclose || r?.indicators?.quote?.[0]?.close || [];
      let last = null;
      for(let i=0;i<ts.length;i++){
        const t = new Date(ts[i]*1000);
        if (t <= end && Number.isFinite(closes[i])) last = closes[i];
      }
      if(last!=null) priceCache.set(key, last);
      return last;
    }catch(e){ return null; }
  }

  // === Header mapping (snapshot BEFORE insertion) ===
  function mapHeaderIndices(){
    const theadRow = document.querySelector('#' + TABLE_ID + ' thead tr');
    if(!theadRow) return {};
    const thEls = [...theadRow.querySelectorAll('th')];
    const labels = thEls.map(th=> (th.textContent||'').trim().toLowerCase());
    const dateIdx = labels.findIndex(t=> t.startsWith('date'));
    const sharesIdx = labels.findIndex(t=> t.includes('shares'));
    let tickerIdx = labels.findIndex(t=> t.includes('ticker'));
    if (tickerIdx === -1) { tickerIdx = labels.findIndex(t=> t.includes('name') || t.includes('company')); }
    return { dateIdx, sharesIdx, tickerIdx, thEls, theadRow };
  }

  // Insert headers BEFORE Shares using ORIGINAL sharesIdx
  function ensureHeader(){
    const table = document.getElementById(TABLE_ID);
    if(!table) return;
    const colgroup = table.querySelector('colgroup');

    if(!originalIndexMap){
      originalIndexMap = mapHeaderIndices(); // snapshot
    }
    const { sharesIdx, theadRow, thEls } = originalIndexMap;
    if(!theadRow || sharesIdx === -1) return;

    // Already present?
    const existsClose = theadRow.querySelector('th.close-col');
    const existsTotal = theadRow.querySelector('th.total-col');
    if (existsClose && existsTotal) return;

    const thClose = document.createElement('th');
    thClose.textContent = 'Close';
    thClose.className = 'num close-col';
    const thTotal = document.createElement('th');
    thTotal.textContent = 'Total';
    thTotal.className = 'num total-col';

    const refNode = thEls[sharesIdx] || null; // BEFORE original Shares
    theadRow.insertBefore(thTotal, refNode);
    theadRow.insertBefore(thClose, thTotal);

    if(colgroup){
      const cols = [...colgroup.querySelectorAll('col')];
      const colClose = document.createElement('col'); colClose.setAttribute('style','width:70px');
      const colTotal = document.createElement('col'); colTotal.setAttribute('style','width:90px');
      const cgRef = cols[sharesIdx] || null;
      colgroup.insertBefore(colTotal, cgRef);
      colgroup.insertBefore(colClose, colTotal);
    }
  }

  // Extract info using ORIGINAL indices (robusto a riordino)
  function extractRowInfo(tr){
    if(!originalIndexMap){ originalIndexMap = mapHeaderIndices(); }
    const { dateIdx, sharesIdx, tickerIdx } = originalIndexMap;
    if(dateIdx === -1) return null;
    const tds = tr.cells;
    if(!tds || tds.length === 0) return null;

    const isoDate = parseDDMMYY(tds[dateIdx]?.textContent?.trim() || '');
    const shares = (sharesIdx !== -1 && tds[sharesIdx]) ? parseShares(tds[sharesIdx].textContent || '') : null;

    // Ticker
    let ticker = null;
    const nameCell = (tickerIdx >=0 && tds[tickerIdx]) ? tds[tickerIdx] : tds[Math.min(tds.length-1, 2)];
    if(nameCell){
      const pill = nameCell.querySelector('.ticker-pill');
      if(pill){
        const txt = (pill.textContent || '').trim();
        if(txt) ticker = txt.replace(/[^A-Z0-9\.-]/g,'').toUpperCase();
      }
      if(!ticker){
        const txt = (nameCell.textContent || '').trim();
        const m = txt.match(/\b[A-Z]{1,6}(?:\.[A-Z]{1,2}|-[A-Z]{1,3})?\b/);
        if(m) ticker = m[0].toUpperCase();
      }
    }
    if(!isoDate || !ticker) return null;
    return { isoDate, shares, ticker };
  }

  // Ensure new cells exist BEFORE the ORIGINAL Shares cell
  function ensureCells(tr){
    if(tr.querySelector('td.close-cell') && tr.querySelector('td.total-cell')) return;
    if(!originalIndexMap){ originalIndexMap = mapHeaderIndices(); }
    const { sharesIdx } = originalIndexMap;
    const tds = tr.cells;
    const insertPos = (sharesIdx === -1) ? tds.length : sharesIdx; // before original Shares
    const refNode = tds[insertPos] || null;

    const tdClose = document.createElement('td');
    tdClose.className = 'num close-cell';
    tdClose.textContent = '‚Ä¶';
    const tdTotal = document.createElement('td');
    tdTotal.className = 'num total-cell';
    tdTotal.textContent = '‚Ä¶';

    tr.insertBefore(tdTotal, refNode);
    tr.insertBefore(tdClose, tdTotal);
  }

  function populate(tr){
    ensureCells(tr);
    const info = extractRowInfo(tr);
    const tdClose = tr.querySelector('td.close-cell');
    const tdTotal = tr.querySelector('td.total-cell');
    if(!info){
      if(tdClose) tdClose.textContent = '‚Äì';
      if(tdTotal) tdTotal.textContent = '‚Äì';
      return;
    }
    enqueue(async () => {
      const px = await getClosePrice(info.ticker, info.isoDate);
      if(tdClose) tdClose.textContent = (px!=null) ? ('$' + Number(px).toFixed(2)) : '‚Äì';
      if(tdTotal){
        if(px!=null && Number.isFinite(info.shares)){
          tdTotal.textContent = formatCompact(px * info.shares);
        }else{
          tdTotal.textContent = '‚Äì';
        }
      }
    });
  }

  function processAll(){
    ensureHeader();
    const tbody = document.getElementById(TBODY_ID);
    if(!tbody) return;
    [...tbody.querySelectorAll('tr')].forEach(populate);
  }

  function observe(){
    const tbody = document.getElementById(TBODY_ID);
    if(!tbody) return;
    const obs = new MutationObserver((mutations)=>{
      for(const m of mutations){
        if(m.type === 'childList' && m.addedNodes?.length){
          m.addedNodes.forEach(n=>{
            if(n.nodeType===1 && n.tagName==='TR') populate(n);
          });
        }
      }
    });
    obs.observe(tbody, { childList:true });
  }

  window.addEventListener('load', function(){
    try{
      // snapshot header before touching it
      originalIndexMap = mapHeaderIndices();
      ensureHeader();
      processAll();
      observe();
    }catch(e){ /* no-op */ }
  });
})();
</script>


<script>
/* === Totals Calculator v1.2 (fixed) ‚Äî non‚Äëdestructive ===
   - NON sposta/aggiunge colonne.
   - Calcola: Total = (Close √ó Shares)
   - Importante: la formattazione compatta (K/M/B/T) avviene SOLO dopo il calcolo.
   - Shares viene sempre interpretato come intero (gestisce separatori migliaia "." o ",").
*/
(function(){
  const TABLE_ID = 'table';
  const TBODY_ID = 'tbody';

  function headerMap(){
    const thead = document.querySelector('#'+TABLE_ID+' thead');
    const row = thead ? thead.querySelector('tr') : null;
    const ths = row ? Array.from(row.children) : [];
    const labels = ths.map(th => (th.textContent || '').trim().toLowerCase());
    const idx = {
      close:  labels.findIndex(t => t === 'close'),
      total:  labels.findIndex(t => t === 'total'),
      shares: labels.findIndex(t => t.includes('shares')), // "Shares | %"
    };
    return { row, ths, labels, ...idx };
  }

  function parseClose(text){
    if(!text) return null;
    // Close: pu√≤ contenere "$", spazi, separatori migliaia
    let s = String(text).replace(/\$/g,'').replace(/[ \u00A0,]/g,'');
    s = s.replace(/[^0-9.\-]/g,'');
    if(!s || s==='.' || s==='-' || s==='-.') return null;
    const v = parseFloat(s);
    return Number.isFinite(v) ? v : null;
  }

  function parseShares(text){
    if(!text) return null;
    // Usa solo la parte a sinistra di '|'
    let s = String(text).split('|')[0].trim();
    if(!s) return null;

    // Shares NON ha decimali: rimuovi separatori migliaia e qualsiasi cosa non numerica
    const neg = s.includes('-');
    s = s.replace(/[^0-9]/g,''); // elimina "." "," spazi ecc.
    if(!s) return null;

    const v = parseInt(s, 10);
    if(!Number.isFinite(v)) return null;
    return neg ? -v : v;
  }

  function fmtCompact(n){
    if(n==null || !Number.isFinite(n)) return '‚Äì';
    const abs = Math.abs(n);
    const sign = n < 0 ? '-' : '';
    const units = [{v:1e12,s:'T'},{v:1e9,s:'B'},{v:1e6,s:'M'},{v:1e3,s:'K'}];
    for(const u of units){
      if(abs >= u.v) return sign + (abs/u.v).toFixed(2) + ' ' + u.s;
    }
    return sign + Math.round(abs).toString();
  }

  function computeOnce(){
    const map = headerMap();
    if(!map.row) return;
    const {close, total, shares} = map;
    if(close===-1 || total===-1 || shares===-1) return;

    const tbody = document.getElementById(TBODY_ID);
    if(!tbody) return;

    Array.from(tbody.rows).forEach(tr => {
      const cClose  = tr.children[close];
      const cTotal  = tr.children[total];
      const cShares = tr.children[shares];
      if(!cClose || !cTotal || !cShares) return;

      const vClose  = parseClose(cClose.textContent);
      const vShares = parseShares(cShares.textContent);

      if(vClose!=null && vShares!=null){
        const totalVal = (vClose * vShares); // ‚úÖ niente x1000
        cTotal.textContent = fmtCompact(totalVal);
      } else {
        cTotal.textContent = '‚Äì';
      }
    });
  }

  function boot(){
    computeOnce();
    let n=0;
    const iv = setInterval(() => {
      computeOnce();
      if(++n > 30) clearInterval(iv);
    }, 500);

    const tbody = document.getElementById(TBODY_ID);
    if(tbody){
      const obs = new MutationObserver(() => computeOnce());
      obs.observe(tbody, {childList:true});
    }
  }

  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', boot);
  } else {
    boot();
  }
})();
</script>


<script>
/* === Rate Limit Helper v1.0 (non-invasive) ===
   - Se esistono funzioni di fetch prezzi (getClosePrice/fetchWithFallback/enqueue) le "avvolge" con:
     ‚Ä¢ Limite globale: 1 richiesta ogni 600ms
     ‚Ä¢ Retry con backoff (429/503): 300ms, 600ms, 1200ms, 2400ms
     ‚Ä¢ Cache localStorage 24h per chiave "closepx:v1:TICK|YYYY-MM-DD"
   - Non sposta/rompe nulla; se le funzioni non esistono, non fa niente.
*/
(function(){
  const RATE_MS = 600;
  const MAX_RETRIES = 4;
  const BACKOFFS = [300, 600, 1200, 2400];
  const LS_PREFIX = 'closepx:v1:';
  const TTL_MS = 24*60*60*1000;
  let lastAt = 0;

  function sleep(ms){ return new Promise(r=>setTimeout(r, ms)); }

  function lsGet(key){
    try{
      const raw = localStorage.getItem(LS_PREFIX + key);
      if(!raw) return null;
      const obj = JSON.parse(raw);
      if(!obj || !obj.t || !('v' in obj)) return null;
      if(Date.now() - obj.t > TTL_MS){ localStorage.removeItem(LS_PREFIX + key); return null; }
      return obj.v;
    }catch(e){ return null; }
  }
  function lsSet(key, val){
    try{ localStorage.setItem(LS_PREFIX + key, JSON.stringify({t:Date.now(), v:val})); }catch(e){}
  }

  function rateGate(){
    const now = Date.now();
    const elapsed = now - lastAt;
    const wait = Math.max(0, RATE_MS - elapsed);
    return sleep(wait).then(()=>{ lastAt = Date.now(); });
  }

  // Wrap only if functions exist
  if(typeof window.getClosePrice === 'function'){
    const _orig_getClosePrice = window.getClosePrice;
    window.getClosePrice = async function(symbol, isoDate){
      const key = `${symbol}|${isoDate}`;

      // localStorage cache first
      const cached = lsGet(key);
      if(cached != null) return cached;

      let attempt = 0, lastErr = null;
      while(attempt <= MAX_RETRIES){
        try{
          await rateGate();
          const val = await _orig_getClosePrice(symbol, isoDate);
          if(val != null){ lsSet(key, val); }
          return val;
        }catch(e){
          lastErr = e;
          // Exponential backoff for 429/503 or generic network errors
          const delay = BACKOFFS[Math.min(attempt, BACKOFFS.length-1)];
          await sleep(delay);
          attempt++;
        }
      }
      if(lastErr) throw lastErr;
      return null;
    };
  }

  // Also wrap fetchWithFallback if present to catch HTTP codes
  if(typeof window.fetchWithFallback === 'function'){
    const _orig_fetchWithFallback = window.fetchWithFallback;
    window.fetchWithFallback = async function(url){
      let attempt = 0;
      while(attempt <= MAX_RETRIES){
        try{
          await rateGate();
          const res = await _orig_fetchWithFallback(url);
          return res;
        }catch(e){
          const delay = BACKOFFS[Math.min(attempt, BACKOFFS.length-1)];
          await sleep(delay);
          attempt++;
        }
      }
      // final try
      return _orig_fetchWithFallback(url);
    };
  }

  // If there's a global enqueue, we can throttle it (optional)
  if(typeof window.enqueue === 'function'){
    const _orig_enqueue = window.enqueue;
    window.enqueue = function(task){
      const wrapped = async () => { await rateGate(); return task(); };
      return _orig_enqueue(wrapped);
    };
  }
})();
</script>

<script>
// Date range pill: default last 2 days + sequential picker
(function(){
  function pad(n){ return n < 10 ? '0' + n : '' + n; }
  function toISO(d){
    return d.getFullYear() + '-' + pad(d.getMonth()+1) + '-' + pad(d.getDate());
  }
  function toDisplay(d){
    var year = ('' + d.getFullYear()).slice(-2);
    return pad(d.getDate()) + '/' + pad(d.getMonth()+1) + '/' + year;
  }
  function initDateRange(){
    var fromInput = document.getElementById('fromDate');
    var toInput   = document.getElementById('toDate');
    var pill      = document.getElementById('dateRangePill');
    var valueEl   = document.getElementById('dateRangeValue');
    if (!fromInput || !toInput || !pill || !valueEl) return;

    // Default: last 2 days (yesterday ‚Üí today) only if no existing values
    if (!fromInput.value && !toInput.value){
      var today = new Date();
      var start = new Date(today);
      start.setDate(start.getDate() - 1);
      fromInput.value = toISO(start);
      toInput.value   = toISO(today);
    }

    function syncLabel(){
      if (fromInput.value && toInput.value){
        var fromDate = new Date(fromInput.value);
        var toDate   = new Date(toInput.value);
        valueEl.textContent = toDisplay(fromDate) + ' ‚Äì ' + toDisplay(toDate);
      }
    }
    syncLabel();

    // When clicking the pill, start from the FROM date picker
    pill.addEventListener('click', function(){
      if (typeof fromInput.showPicker === 'function'){
        fromInput.showPicker();
      } else {
        fromInput.focus();
      }
    });

    // After choosing FROM, immediately open TO, then sync label
    fromInput.addEventListener('change', function(){
      if (typeof toInput.showPicker === 'function'){
        toInput.showPicker();
      } else {
        toInput.focus();
      }
      syncLabel();
    });
    toInput.addEventListener('change', syncLabel);
  }

  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', initDateRange);
  } else {
    initDateRange();
  }
})();
</script>

<script>
// === v7: sidebar routing (Overview / Favorites) ===
(function(){
  function initRouting(){
    var navButtons = document.querySelectorAll('.nav-item[data-view-target]');
    if (!navButtons.length) return;
    var titleEl = document.querySelector('h1');
    var statusEl = document.getElementById('status');
    var onlyMine = document.getElementById('onlyMine');
    var toggleMineBtn = document.getElementById('toggleMineBtn');
    var sidebarLabel = document.getElementById('sidebarViewLabel');

    // Move filter card into sidebar, if mount exists
    var sidebarMount = document.getElementById('sidebarFiltersMount');
    var filterCard = document.getElementById('filterCard');
    if (sidebarMount && filterCard){
      sidebarMount.appendChild(filterCard);
      filterCard.classList.add('sidebar-filters');
      var layout = document.getElementById('layoutTwoCol');
      if (layout){
        layout.style.gridTemplateColumns = '1fr';
      }
    }


    function applyOnlyMine(on){
      if (!onlyMine) return;
      onlyMine.checked = !!on;
      if (toggleMineBtn){
        toggleMineBtn.classList.toggle('on', !!on);
        toggleMineBtn.title = on ? 'Showing only my tickers' : 'Only my tickers';
      }
      if (typeof render === 'function'){
        try{ render(); }catch(e){}
      }
      if (statusEl){
        statusEl.style.display = 'block';
        statusEl.textContent = on ? 'View: Favorites (only your followed tickers).' : 'View: All trades.';
      }
    }

    function setView(view){
      navButtons.forEach(function(btn){
        btn.classList.toggle('active', btn.getAttribute('data-view-target') === view);
      });
      document.documentElement.setAttribute('data-view', view);
      if (sidebarLabel){
        if (view === 'favorites'){
          sidebarLabel.textContent = 'Favorites';
        } else if (view === 'news'){
          sidebarLabel.textContent = 'News';
        } else if (view === 'holdings'){
          sidebarLabel.textContent = 'Holdings';
        } else {
          sidebarLabel.textContent = 'Overview';
        }
      }
      if (titleEl){
        if (view === 'favorites'){
          titleEl.textContent = 'ARK Trades ‚Äì Favorites';
        } else if (view === 'news'){
          titleEl.textContent = 'ARK Trades ‚Äì News';
        } else if (view === 'holdings'){
          titleEl.textContent = 'ARK Trades ‚Äì Holdings';
        } else {
          titleEl.textContent = 'ARK Trades ‚Äì Dashboard (Dark v7)';
        }
      }
      if (view === 'favorites'){
        applyOnlyMine(true);
      } else {
        applyOnlyMine(false);
      }
    }


function initFromHash(){
      var hash = (location.hash || '').replace('#','');
      if (hash === 'favorites'){
        setView('favorites');
      } else if (hash === 'news'){
        setView('news');
      } else if (hash === 'holdings'){
        setView('holdings');
      } else {
        setView('home');
      }
    }


navButtons.forEach(function(btn){
      btn.addEventListener('click', function(){
        var view = btn.getAttribute('data-view-target') || 'home';
        if (view === 'favorites'){
          history.replaceState(null, '', '#favorites');
        } else if (view === 'news'){
          history.replaceState(null, '', '#news');
        } else if (view === 'holdings'){
          history.replaceState(null, '', '#holdings');
        } else {
          history.replaceState(null, '', '#home');
        }
        setView(view);
      });
    });

    window.addEventListener('hashchange', initFromHash);
    initFromHash();
  }

  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', initRouting);
  } else {
    initRouting();
  }
})();
</script>


<script>
// === ARK ETF News loader (stable + Show more 5-by-5) ‚Äî uses /v2/etf/news ===
(function(){
  const PAGE = 5;
  const MAX_FETCH = 40;
  const NEWS_ENDPOINT = 'https://arkfunds.io/api/v2/etf/news';
  const NEWS_SYMBOLS = 'ARKK,ARKQ,ARKW,ARKG,ARKF,ARKX,PRNT,IZRL';

  function setup(){
    const statusEl  = document.getElementById('newsStatus');
    const listEl    = document.getElementById('newsList');
    const updatedEl = document.getElementById('newsUpdated');
    const bodyEl    = listEl ? listEl.parentElement : null;
    if (!statusEl || !listEl || !bodyEl) return;

    function coerceNews(json){
      if (Array.isArray(json)) return json;
      if (json && Array.isArray(json.news)) return json.news;
      if (json && Array.isArray(json.data)) return json.data;
      if (json && Array.isArray(json.items)) return json.items;
      return [];
    }

    function timeAgo(iso){
      try{
        const d = new Date(iso);
        const ms = Date.now() - d.getTime();
        const m = Math.round(ms/60000);
        if (m < 60) return (m<=1?'just now':m+' min ago');
        const h = Math.round(m/60);
        if (h < 24) return (h===1?'1 hour ago':h+' hours ago');
        const dys = Math.round(h/24);
        return (dys===1?'1 day ago':dys+' days ago');
      }catch(e){ return ''; }
    }

    let all = [];
    let shown = 0;
    let moreWrap = null, moreBtn = null;

    function ensureMore(){
      if (!moreWrap){
        moreWrap = document.createElement('div');
        moreWrap.className = 'news-more-wrap';
        moreBtn = document.createElement('button');
        moreBtn.type = 'button';
        moreBtn.className = 'news-more-btn';
        moreBtn.id = 'newsMoreBtn';
        moreBtn.textContent = 'Show more';
        moreWrap.appendChild(moreBtn);
        bodyEl.appendChild(moreWrap);
        moreBtn.addEventListener('click', ()=>{
          shown = Math.min(all.length, shown + PAGE);
          renderSlice();
        });
      }
    }

    function renderSlice(){
      listEl.innerHTML = '';
      const slice = all.slice(0, shown);
      if (!slice.length){
        statusEl.textContent = 'No recent headlines from arkfunds.io';
      } else {
        statusEl.textContent = '';
      }

      slice.forEach(item => {
        const title = item.title || item.headline || 'Untitled';
        const url = item.url || item.link || '#';
        const src = item.source || item.publisher || '';
        const ts = item.published_at || item.date || item.publishedAt || '';
        const when = timeAgo(ts);
        const summaryRaw = item.summary || item.description || item.excerpt || '';
        const summary = summaryRaw ? (summaryRaw.length>220?summaryRaw.slice(0,217)+'‚Ä¶':summaryRaw) : '';
        const thumb = item.image_url || item.image || item.thumbnail || item.thumb || '';

        const li = document.createElement('li');
        li.className = 'news-item';
        li.innerHTML =
          (thumb?('<div class="news-thumb"><img src="'+thumb+'" alt=""/></div>'):'')+
          '<div class="news-text">'+
            '<div class="news-item-header">'+
              '<span class="news-dot"></span>'+
              '<div class="news-item-title">'+
                (url && url!="#"
                  ? '<a href="'+url+'" target="_blank" rel="noopener">'+title+'</a>'
                  : title)+
              '</div>'+
            '</div>'+
            (summary?'<div class="news-item-summary">'+summary+'</div>':'')+
            '<div class="news-item-meta">'+
              (src?'<span>'+src+'</span>':'')+
              (src&&when?' ¬∑ ':'')+
              (when?'<span>'+when+'</span>':'')+
            '</div>'+
          '</div>';
        listEl.appendChild(li);
      });

      // toggle button
      if (moreWrap){
        if (shown >= all.length){ moreWrap.style.display='none'; }
        else { moreWrap.style.display='flex'; }
      }
    }

    async function loadNews(){
      try{
        statusEl.textContent = 'Loading latest headlines‚Ä¶';
        const url = new URL(NEWS_ENDPOINT);
        if (NEWS_SYMBOLS) url.searchParams.set('symbol', NEWS_SYMBOLS);
        url.searchParams.set('limit', String(MAX_FETCH));
        const res = await fetch(url.toString());
        if (!res.ok) throw new Error('HTTP '+res.status);
        const json = await res.json();
        all = coerceNews(json);
        if (!Array.isArray(all)) all = [];
        ensureMore();
        shown = Math.min(all.length, PAGE);
        renderSlice();

        if (updatedEl && all[0]){
          const ts = all[0].published_at || all[0].date || all[0].publishedAt;
          if (ts){
            try{
              const d = new Date(ts);
              updatedEl.textContent = 'Last update: ' + d.toLocaleString('en-US', {
                month:'short', day:'numeric', hour:'2-digit', minute:'2-digit'
              });
            }catch(e){ updatedEl.textContent = ''; }
          }
        }
      }catch(e){
        statusEl.textContent = 'Unable to load news from arkfunds.io';
        console.error('News load error', e);
      }
    }

    loadNews();
  }

  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', setup);
  }else{
    setup();
  }
})();
</script>

<script>
(function(){
  const FUNDS = ['ARKK','ARKQ','ARKW','ARKG','ARKF','ARKX','PRNT','IZRL'];
  const ENDPOINT = 'https://arkfunds.io/api/v2/etf/holdings';

  async function loadTop10(){
    const status = document.getElementById('arkTop10Status');
    const list = document.getElementById('arkTop10List');
    const updated = document.getElementById('arkTop10Updated');

    // elements for full holdings tab
    const holdingsBody    = document.getElementById('holdingsBody');
    const holdingsStatus  = document.getElementById('holdingsStatus');
    const holdingsUpdated = document.getElementById('holdingsUpdated');
    const holdingsCount   = document.getElementById('holdingsCount');

    if(holdingsBody){
      holdingsBody.addEventListener('click', function(e){
        const row = e.target.closest('.holdings-row');
        if(!row) return;
        // evita conflitti con eventuali link gf-open/esterni
        if(e.target.closest('.gf-open')) return;
        if(typeof openHoldingOverlayFromRow === 'function'){
          openHoldingOverlayFromRow(row);
        }
      });
    }


    if (!status || !list) return;

    try{
      status.textContent = 'Loading ARK aggregated holdings‚Ä¶';
      if (holdingsStatus) holdingsStatus.textContent = 'Loading aggregated holdings‚Ä¶';

      const url = new URL(ENDPOINT);
      url.searchParams.set('symbol', FUNDS.join(','));

      const res = await fetch(url);
      if (!res.ok) throw new Error('HTTP ' + res.status);
      const json = await res.json();

      const holdings = Array.isArray(json.holdings) ? json.holdings : [];
      const grouped = {};

      holdings.forEach(h => {
        const t = h.ticker;
        if (!t) return;
        const nameField = h.company || h.name || h.security_name || h.full_name || '';
        if (!grouped[t]){
          grouped[t] = { ticker: t, mv: 0, shares: 0, name: nameField };
        } else if (!grouped[t].name && nameField){
          grouped[t].name = nameField;
        }
        grouped[t].mv     += h.market_value || 0;
        grouped[t].shares += h.shares || 0;
      });

      const values = Object.values(grouped);
      if (!values.length){
        status.textContent = 'No holdings data available.';
        if (holdingsStatus) holdingsStatus.textContent = 'No holdings data available.';
        return;
      }

      // total market value for weight%
      const totalMv = values.reduce((sum, x) => sum + (x.mv || 0), 0);

      const formatMV = (mv) => {
        if (mv >= 1e9){
          const b = mv / 1e9;
          return '$ ' + b.toLocaleString('it-IT',{ maximumFractionDigits: 2 }) + 'B';
        } else if (mv >= 1e6){
          const m = mv / 1e6;
          return '$ ' + Math.round(m).toLocaleString('it-IT',{ maximumFractionDigits: 0 }) + 'M';
        } else {
          return '$ ' + mv.toLocaleString('it-IT',{ maximumFractionDigits: 0 });
        }
      };

      // === TOP 10 by market value ===
      const top10 = values.slice().sort((a,b) => (b.mv || 0) - (a.mv || 0)).slice(0, 10);

      list.innerHTML = '';
      top10.forEach((item, i) => {
        const li = document.createElement('li');
        const sym = (item.ticker || '').trim().toUpperCase();
        const name = item.name || ((typeof NAME_MAP !== 'undefined' && NAME_MAP[sym]) ? NAME_MAP[sym] : '');
        const mv = item.mv || 0;

        const label = formatMV(mv);

        li.className = 'ark-top10-item';
        li.innerHTML =
          '<div class="ark-top10-row">' +
            '<div class="ark-top10-left">' +
              '<span class="ark-top10-rank">' + (i+1) + '.</span>' +
              '<span class="ticker-pill gf-open" data-ticker="' + sym + '">' + sym + '</span>' +
            '</div>' +
            '<div class="ark-top10-mv">' + label + '</div>' +
          '</div>';

        const chip = li.querySelector('.gf-open');
        if (chip){
          chip.addEventListener('click', (e)=>{
            e.preventDefault();
            e.stopPropagation();
            const t = chip.getAttribute('data-ticker') || sym;
            const url = (typeof googleFinanceURL === 'function')
              ? googleFinanceURL(t)
              : `https://www.google.com/finance/quote/${encodeURIComponent(t)}:NASDAQ`;
            window.open(url, '_blank', 'noopener');
          });
        }

        list.appendChild(li);
      });

      const now = new Date();
      if (updated){
        updated.textContent = 'Updated: ' + now.toLocaleString('en-US',{hour:'2-digit',minute:'2-digit'});
      }
      status.textContent = '';

      // === FULL HOLDINGS TAB (sorted by total market value) ===
      if (holdingsBody && holdingsStatus){
        const sortedByMv = values.slice().sort((a,b) => (b.mv || 0) - (a.mv || 0));

        holdingsBody.innerHTML = '';
        sortedByMv.forEach((item, idx) => {
          const sym = (item.ticker || '').trim().toUpperCase();
          const name = item.name || ((typeof NAME_MAP !== 'undefined' && NAME_MAP[sym]) ? NAME_MAP[sym] : '');
          const shares = item.shares || 0;
          const mv = item.mv || 0;
          const weight = totalMv ? (item.mv / totalMv) * 100 : 0;
          const lastClose = (shares > 0 && mv > 0) ? (mv / shares) : 0;
          const lastCloseLabel = lastClose
            ? '$ ' + lastClose.toLocaleString('en-US',{minimumFractionDigits:2, maximumFractionDigits:2})
            : '‚Äî';

          const tr = document.createElement('tr');
          tr.className = 'holdings-row';
          tr.dataset.ticker = sym;
          tr.dataset.name = name || '';
          tr.dataset.lastClose = lastCloseLabel;
          tr.dataset.mvLabel = formatMV(mv);
          tr.dataset.sharesLabel = shares.toLocaleString('it-IT');
          tr.dataset.weightLabel = weight.toFixed(2).replace(".", ",") + '%';
          tr.innerHTML =
            '<td class="num holdings-rank">' + (idx+1) + '.</td>' +
            '<td class="holdings-main">' +
              '<span class="avatar" data-ticker="' + sym + '"><span class="mono">' + sym.slice(0,2) + '</span></span>' +
              '<span class="ticker-pill gf-open" data-ticker="' + sym + '">' + sym + '</span>' +
              (name ? '<span class="holdings-name">' + name + '</span>' : '') +
            '</td>' +
            '<td class="num holdings-last">' + lastCloseLabel + '</td>' +
            '<td class="num holdings-value">' + formatMV(mv) + '</td>' +
            '<td class="num holdings-shares">' + shares.toLocaleString('it-IT') + '</td>' +
            '<td class="num holdings-weight">' + weight.toFixed(2).replace(".", ",") + '%</td>';

          tr.addEventListener('click', ()=>{
            if(typeof openHoldingOverlayFromRow === 'function'){
              openHoldingOverlayFromRow(tr);
            }
          });

          holdingsBody.appendChild(tr);
        });

        if (holdingsCount){
          holdingsCount.textContent = sortedByMv.length.toLocaleString('it-IT');
        }
        if (holdingsUpdated){
          const now2 = new Date();
          holdingsUpdated.textContent = 'Updated: ' + now2.toLocaleString('en-US',{hour:'2-digit',minute:'2-digit'});
        }
        holdingsStatus.textContent = '';

        // hydrate ticker avatars if resolver is available
        try{
          if (window.__logoResolver && typeof __logoResolver.hydrateAvatar === 'function'){
            sortedByMv.forEach(item => {
              const T = (item.ticker || '').toUpperCase();
              __logoResolver.hydrateAvatar('#holdingsCard .avatar[data-ticker="'+T+'"]', T);
            });
          }
        }catch(_){}
      }
    }catch(e){
      console.error(e);
      status.textContent = 'Unable to compute ARK global holdings';
      if (holdingsStatus) holdingsStatus.textContent = 'Unable to compute ARK global holdings';
    }
  }



  function openHoldingOverlayFromRow(row){
    if(!row || !holdingOverlay) return;
    // show overlay immediately, we'll fill details below
    holdingOverlay.style.display = 'flex';
    try{
      const ticker = (row.dataset.ticker || '').toUpperCase();
      const name   = row.dataset.name || ticker;
      const last   = row.dataset.lastClose || '';
      const mv     = row.dataset.mvLabel || '';
      const shares = row.dataset.sharesLabel || '';
      const weight = row.dataset.weightLabel || '';

      holdingOverlayTicker = ticker;

      if(holdingFocusName)   holdingFocusName.textContent = name;
      if(holdingFocusTicker) holdingFocusTicker.textContent = ticker;
      if(holdingMetricLast)  holdingMetricLast.textContent = last || '‚Äî';
      if(holdingMetricValue) holdingMetricValue.textContent = mv || '‚Äî';
      if(holdingMetricShares)holdingMetricShares.textContent = shares || '‚Äî';
      
      if(holdingMetricWeight){
        const valueText = weight || '‚Äî';
        holdingMetricWeight.textContent = valueText;
        holdingMetricWeight.classList.remove('heat-low','heat-mid','heat-high');
        const parsed = parseFloat(String(weight).replace('%','').replace(',','.'));
        if(!isNaN(parsed)){
          let cls = 'heat-low';
          if(parsed >= 5) cls = 'heat-high';
          else if(parsed >= 2) cls = 'heat-mid';
          holdingMetricWeight.classList.add(cls);
        }
      }

if(holdingCompanyInfo) holdingCompanyInfo.textContent = 'Loading company profile‚Ä¶';

      if(holdingFocusAvatar){
        holdingFocusAvatar.setAttribute('data-ticker', ticker);
        const inner = holdingFocusAvatar.querySelector('.mono');
        if(inner) inner.textContent = ticker.slice(0,2);
        try{
          if(window.__logoResolver && typeof window.__logoResolver.hydrateAvatar === 'function'){
            window.__logoResolver.hydrateAvatar('#holdingFocusAvatar', ticker);
          }
        }catch(e){}
      }

      const infoPlaceholder = holdingCompanyInfo;
      if(infoPlaceholder){
        infoPlaceholder.textContent = 'Loading company profile‚Ä¶';
        setTimeout(()=>{
          if(infoPlaceholder.textContent === 'Loading company profile‚Ä¶'){
            infoPlaceholder.textContent = 'No company profile available.';
          }
        }, 3500);
      }

      fetchStockProfile(ticker).then(info => {
        if(!holdingCompanyInfo) return;
        if(!info){
          holdingCompanyInfo.textContent = 'No company profile available.';
          return;
        }
        holdingCompanyInfo.innerHTML = renderCompanyInfo(info);
      }).catch(()=>{
        if(holdingCompanyInfo){
          holdingCompanyInfo.textContent = 'No company profile available.';
        }
      });

      updateHoldingFavBtn();
    }catch(e){
      console.error('openHoldingOverlayFromRow error', e);
    }
  }

      document.addEventListener('DOMContentLoaded', loadTop10);
})();
</script>
</body>
</html>
